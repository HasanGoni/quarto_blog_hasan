<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hasan Goni">
<meta name="dcterms.date" content="2023-10-21">

<title>Hasan’s Data Science &amp; AI Blog - How to Use Nougat to Read Scientific Paper</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: ['listing-categories',{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: ["listing-categories"],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>
<style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Hasan’s Data Science &amp; AI Blog - How to Use Nougat to Read Scientific Paper">
<meta property="og:description" content="Research paper working">
<meta property="og:image" content="https://hasangoni.quarto.pub/hasan-blog-post/posts/nougat-to-read-scientific-pdf-files/image.png">
<meta property="og:site-name" content="Hasan's Data Science &amp; AI Blog">
<meta property="og:image:height" content="697">
<meta property="og:image:width" content="1000">
<meta name="twitter:title" content="Hasan’s Data Science &amp; AI Blog - How to Use Nougat to Read Scientific Paper">
<meta name="twitter:description" content="Research paper working">
<meta name="twitter:image" content="https://hasangoni.quarto.pub/hasan-blog-post/posts/nougat-to-read-scientific-pdf-files/image.png">
<meta name="twitter:image-height" content="697">
<meta name="twitter:image-width" content="1000">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Hasan’s Data Science &amp; AI Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-series" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Series</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-series">    
        <li>
    <a class="dropdown-item" href="../../posts/series/command-line-mastery.html" rel="" target="">
 <span class="dropdown-text">Command Line Mastery for HPC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/series/data-science-steps.html" rel="" target="">
 <span class="dropdown-text">Data Science Steps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/series/computer-vision-foundations.html" rel="" target="">
 <span class="dropdown-text">Computer Vision Foundations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/series/vlm.html" rel="" target="">
 <span class="dropdown-text">VLM Series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/series/anomaly-detection/index.html" rel="" target="">
 <span class="dropdown-text">Anomaly Detection</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../categories.html" rel="" target="">
 <span class="menu-text">Categories</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tags.html" rel="" target="">
 <span class="menu-text">Tags</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/HasanGoni" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/hasangoni" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">How to Use Nougat to Read Scientific Paper</li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">How to Use Nougat to Read Scientific Paper</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
            <p class="subtitle lead">Research paper working</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Nlp</div>
                <div class="quarto-category">Research paper</div>
                <div class="quarto-category">Text</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Hasan Goni </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 21, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">August 13, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Command Line Mastery for HPC</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Command Line Mastery for HPC Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/01-digital-compass.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Digital Compass</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/02-file-detective.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. File Detective</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/03-file-manipulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. File Manipulation Magic</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/04-text-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Text Processing Power</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/05-permission-wizardry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Permission Wizardry</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/06-ssh-remote-access.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. SSH and Remote Access</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/07-file-transfer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. File Transfer Mastery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/08-environment-mastery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Environment Mastery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/09-hpc-job-scheduling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. HPC Job Scheduling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/10-parallel-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Parallel Processing Power</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/11-bash-scripting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Bash Scripting Essentials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/command-line-mastery/12-automation-excellence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Automation Excellence</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/data-science-steps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/data-science-steps-to-follow-part01/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/data-science-steps-to-follow-part02/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/data-science-steps-to-follow-part03/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 03</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/data-science-steps-to-follow-part04/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 04</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/data-science-steps-to-follow-part05/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 05</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/data-science-steps-to-follow-part06/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 06</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Computer Vision Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/computer-vision-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computer Vision Foundations Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/cv-foundations/01-why-computer-vision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Why Computer Vision?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/cv-foundations/02-images-as-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Images as Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/cv-foundations/03-opencv-essentials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. OpenCV Essentials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/cv-foundations/04-finding-patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Finding Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/cv-foundations/05-image-segmentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Image Segmentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/cv-foundations/06-feature-magic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Feature Magic</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/cv-foundations/07-why-deep-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Why Deep Learning?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/cv-foundations/08-modern-vision-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Modern Vision Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/cv-foundations/09-first-cv-project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. First CV Project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/cv-foundations/10-where-to-go-next.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Where to Go Next</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Anomaly Detection</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/anomaly-detection/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/anomaly-detection/finding-the-oddballs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finding the Oddballs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">VLM Series</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/vlm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/series/vlm-qwen3-14b/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Qwen3-14B</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#nougat-to-read-scientific-pdfs" id="toc-nougat-to-read-scientific-pdfs" class="nav-link active" data-scroll-target="#nougat-to-read-scientific-pdfs"><span class="header-section-number">1</span> Nougat to read scientific PDFs</a></li>
  <li><a href="#tl-dr" id="toc-tl-dr" class="nav-link" data-scroll-target="#tl-dr"><span class="header-section-number">2</span> TL-DR</a>
  <ul class="collapse">
  <li><a href="#jupter-notebook-is-the-following" id="toc-jupter-notebook-is-the-following" class="nav-link" data-scroll-target="#jupter-notebook-is-the-following"><span class="header-section-number">2.1</span> Jupter notebook is the following</a></li>
  </ul></li>
  </ul>
</nav>
    <h5 class="quarto-listing-category-title">Categories</h5><div class="quarto-listing-category category-default"><div class="category" data-category="">All <span class="quarto-category-count">(0)</span></div></div></div>
<!-- main -->
<main class="content quarto-banner-title-block column-body" id="quarto-document-content">




<section id="nougat-to-read-scientific-pdfs" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Nougat to read scientific PDFs</h1>
<ul>
<li>Copied from <a href="https://github.com/NielsRogge/Transformers-Tutorials/tree/master/Nougat">here</a></li>
</ul>
</section>
<section id="tl-dr" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> TL-DR</h1>
<p>Nougat is a Visual Transformer model designed to enhance accessibility of scientific knowledge in the digital age. It converts scientific documents from PDFs into a markup language, improving understanding, especially for mathematical expressions. The model’s effectiveness has been demonstrated on a new dataset of scientific documents. This innovation bridges the gap between human-readable and machine-readable text. The authors have shared their models and code to accelerate future research in scientific text recognition.</p>
<p>This is just notebook, to show how to use it.</p>
<ul>
<li>TODO
<ul>
<li>Write some more about the paper.</li>
<li>Add nbdev library to work with it, so that just entering name of the pdf is needed from user hand and then it will be automatically converted.
<ul>
<li>Create pip install documentation for it</li>
</ul></li>
</ul></li>
</ul>
<section id="jupter-notebook-is-the-following" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="jupter-notebook-is-the-following"><span class="header-section-number">2.1</span> Jupter notebook is the following</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#pip install -q pymupdf python-Levenshtein nltk</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoProcessor, VisionEncoderDecoderModel</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="im">import</span> torch</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="im">from</span> typing <span class="im">import</span> Optional, List, Dict, Tuple </span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="im">import</span> io</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="im">import</span> fitz</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="im">from</span> huggingface_hub <span class="im">import</span> hf_hub_download</span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="im">from</span> transformers <span class="im">import</span> StoppingCriteria, StoppingCriteriaList</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>processor <span class="op">=</span> AutoProcessor.from_pretrained(<span class="st">"facebook/nougat-small"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>model <span class="op">=</span> VisionEncoderDecoderModel.from_pretrained(<span class="st">"facebook/nougat-small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Downloading (…)rocessor_config.json:   0%|          | 0.00/479 [00:00&lt;?, ?B/s]



Downloading (…)okenizer_config.json:   0%|          | 0.00/4.49k [00:00&lt;?, ?B/s]



Downloading (…)/main/tokenizer.json:   0%|          | 0.00/2.14M [00:00&lt;?, ?B/s]



Downloading (…)cial_tokens_map.json:   0%|          | 0.00/96.0 [00:00&lt;?, ?B/s]


Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.



Downloading (…)lve/main/config.json:   0%|          | 0.00/4.77k [00:00&lt;?, ?B/s]



Downloading pytorch_model.bin:   0%|          | 0.00/990M [00:00&lt;?, ?B/s]



Downloading (…)neration_config.json:   0%|          | 0.00/165 [00:00&lt;?, ?B/s]</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="op">%%</span>capture</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">#device = "cuda" if torch.cuda.is_available() else "cpu"</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>device <span class="op">=</span> <span class="st">"cpu"</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>model.to(device)</span>
<span id="cb5-5"><a href="#cb5-5"></a>     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>filepath <span class="op">=</span> hf_hub_download(repo_id<span class="op">=</span><span class="st">"ysharma/nougat"</span>, filename<span class="op">=</span><span class="st">"input/nougat.pdf"</span>, repo_type<span class="op">=</span><span class="st">"space"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Downloading nougat.pdf:   0%|          | 0.00/4.13M [00:00&lt;?, ?B/s]</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">def</span> rasterize_paper(</span>
<span id="cb8-2"><a href="#cb8-2"></a>    pdf: Path,</span>
<span id="cb8-3"><a href="#cb8-3"></a>    outpath: Optional[Path] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb8-4"><a href="#cb8-4"></a>    dpi: <span class="bu">int</span> <span class="op">=</span> <span class="dv">96</span>,</span>
<span id="cb8-5"><a href="#cb8-5"></a>    return_pil<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb8-6"><a href="#cb8-6"></a>    pages<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb8-7"><a href="#cb8-7"></a>) <span class="op">-&gt;</span> Optional[List[io.BytesIO]]:</span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="co">"""</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">    Rasterize a PDF file to PNG images.</span></span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">    Args:</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">        pdf (Path): The path to the PDF file.</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">        outpath (Optional[Path], optional): The output directory. If None, the PIL images will be returned instead. Defaults to None.</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">        dpi (int, optional): The output DPI. Defaults to 96.</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">        return_pil (bool, optional): Whether to return the PIL images instead of writing them to disk. Defaults to False.</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">        pages (Optional[List[int]], optional): The pages to rasterize. If None, all pages will be rasterized. Defaults to None.</span></span>
<span id="cb8-17"><a href="#cb8-17"></a></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co">    Returns:</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co">        Optional[List[io.BytesIO]]: The PIL images if `return_pil` is True, otherwise None.</span></span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="co">    """</span></span>
<span id="cb8-21"><a href="#cb8-21"></a></span>
<span id="cb8-22"><a href="#cb8-22"></a>    pillow_images <span class="op">=</span> []</span>
<span id="cb8-23"><a href="#cb8-23"></a>    <span class="cf">if</span> outpath <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb8-24"><a href="#cb8-24"></a>        return_pil <span class="op">=</span> <span class="va">True</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>    <span class="cf">try</span>:</span>
<span id="cb8-26"><a href="#cb8-26"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(pdf, (<span class="bu">str</span>, Path)):</span>
<span id="cb8-27"><a href="#cb8-27"></a>            pdf <span class="op">=</span> fitz.<span class="bu">open</span>(pdf)</span>
<span id="cb8-28"><a href="#cb8-28"></a>        <span class="cf">if</span> pages <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb8-29"><a href="#cb8-29"></a>            pages <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(pdf))</span>
<span id="cb8-30"><a href="#cb8-30"></a>        <span class="cf">for</span> i <span class="kw">in</span> pages:</span>
<span id="cb8-31"><a href="#cb8-31"></a>            page_bytes: <span class="bu">bytes</span> <span class="op">=</span> pdf[i].get_pixmap(dpi<span class="op">=</span>dpi).pil_tobytes(<span class="bu">format</span><span class="op">=</span><span class="st">"PNG"</span>)</span>
<span id="cb8-32"><a href="#cb8-32"></a>            <span class="cf">if</span> return_pil:</span>
<span id="cb8-33"><a href="#cb8-33"></a>                pillow_images.append(io.BytesIO(page_bytes))</span>
<span id="cb8-34"><a href="#cb8-34"></a>            <span class="cf">else</span>:</span>
<span id="cb8-35"><a href="#cb8-35"></a>                <span class="cf">with</span> (outpath <span class="op">/</span> (<span class="st">"</span><span class="sc">%02d</span><span class="st">.png"</span> <span class="op">%</span> (i <span class="op">+</span> <span class="dv">1</span>))).<span class="bu">open</span>(<span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb8-36"><a href="#cb8-36"></a>                    f.write(page_bytes)</span>
<span id="cb8-37"><a href="#cb8-37"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb8-38"><a href="#cb8-38"></a>        <span class="cf">pass</span></span>
<span id="cb8-39"><a href="#cb8-39"></a>    <span class="cf">if</span> return_pil:</span>
<span id="cb8-40"><a href="#cb8-40"></a>        <span class="cf">return</span> pillow_images</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>images <span class="op">=</span> rasterize_paper(pdf<span class="op">=</span>filepath, return_pil<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="bu">len</span>(images)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>17</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>image <span class="op">=</span> Image.<span class="bu">open</span>(images[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># prepare image for the model</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>pixel_values <span class="op">=</span> processor(images<span class="op">=</span>image, return_tensors<span class="op">=</span><span class="st">"pt"</span>).pixel_values</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="bu">print</span>(pixel_values.shape)</span>
<span id="cb14-4"><a href="#cb14-4"></a>     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>torch.Size([1, 3, 896, 672])</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">class</span> RunningVarTorch:</span>
<span id="cb16-2"><a href="#cb16-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, L<span class="op">=</span><span class="dv">15</span>, norm<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb16-3"><a href="#cb16-3"></a>        <span class="va">self</span>.values <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>        <span class="va">self</span>.L <span class="op">=</span> L</span>
<span id="cb16-5"><a href="#cb16-5"></a>        <span class="va">self</span>.norm <span class="op">=</span> norm</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a>    <span class="kw">def</span> push(<span class="va">self</span>, x: torch.Tensor):</span>
<span id="cb16-8"><a href="#cb16-8"></a>        <span class="cf">assert</span> x.dim() <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>        <span class="cf">if</span> <span class="va">self</span>.values <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-10"><a href="#cb16-10"></a>            <span class="va">self</span>.values <span class="op">=</span> x[:, <span class="va">None</span>]</span>
<span id="cb16-11"><a href="#cb16-11"></a>        <span class="cf">elif</span> <span class="va">self</span>.values.shape[<span class="dv">1</span>] <span class="op">&lt;</span> <span class="va">self</span>.L:</span>
<span id="cb16-12"><a href="#cb16-12"></a>            <span class="va">self</span>.values <span class="op">=</span> torch.cat((<span class="va">self</span>.values, x[:, <span class="va">None</span>]), <span class="dv">1</span>)</span>
<span id="cb16-13"><a href="#cb16-13"></a>        <span class="cf">else</span>:</span>
<span id="cb16-14"><a href="#cb16-14"></a>            <span class="va">self</span>.values <span class="op">=</span> torch.cat((<span class="va">self</span>.values[:, <span class="dv">1</span>:], x[:, <span class="va">None</span>]), <span class="dv">1</span>)</span>
<span id="cb16-15"><a href="#cb16-15"></a></span>
<span id="cb16-16"><a href="#cb16-16"></a>    <span class="kw">def</span> variance(<span class="va">self</span>):</span>
<span id="cb16-17"><a href="#cb16-17"></a>        <span class="cf">if</span> <span class="va">self</span>.values <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-18"><a href="#cb16-18"></a>            <span class="cf">return</span></span>
<span id="cb16-19"><a href="#cb16-19"></a>        <span class="cf">if</span> <span class="va">self</span>.norm:</span>
<span id="cb16-20"><a href="#cb16-20"></a>            <span class="cf">return</span> torch.var(<span class="va">self</span>.values, <span class="dv">1</span>) <span class="op">/</span> <span class="va">self</span>.values.shape[<span class="dv">1</span>]</span>
<span id="cb16-21"><a href="#cb16-21"></a>        <span class="cf">else</span>:</span>
<span id="cb16-22"><a href="#cb16-22"></a>            <span class="cf">return</span> torch.var(<span class="va">self</span>.values, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">class</span> StoppingCriteriaScores(StoppingCriteria):</span>
<span id="cb17-2"><a href="#cb17-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, threshold: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.015</span>, window_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">200</span>):</span>
<span id="cb17-3"><a href="#cb17-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb17-4"><a href="#cb17-4"></a>        <span class="va">self</span>.threshold <span class="op">=</span> threshold</span>
<span id="cb17-5"><a href="#cb17-5"></a>        <span class="va">self</span>.<span class="bu">vars</span> <span class="op">=</span> RunningVarTorch(norm<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-6"><a href="#cb17-6"></a>        <span class="va">self</span>.varvars <span class="op">=</span> RunningVarTorch(L<span class="op">=</span>window_size)</span>
<span id="cb17-7"><a href="#cb17-7"></a>        <span class="va">self</span>.stop_inds <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb17-8"><a href="#cb17-8"></a>        <span class="va">self</span>.stopped <span class="op">=</span> defaultdict(<span class="bu">bool</span>)</span>
<span id="cb17-9"><a href="#cb17-9"></a>        <span class="va">self</span>.size <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>        <span class="va">self</span>.window_size <span class="op">=</span> window_size</span>
<span id="cb17-11"><a href="#cb17-11"></a></span>
<span id="cb17-12"><a href="#cb17-12"></a>    <span class="at">@torch.no_grad</span>()</span>
<span id="cb17-13"><a href="#cb17-13"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, input_ids: torch.LongTensor, scores: torch.FloatTensor):</span>
<span id="cb17-14"><a href="#cb17-14"></a>        last_scores <span class="op">=</span> scores[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb17-15"><a href="#cb17-15"></a>        <span class="va">self</span>.<span class="bu">vars</span>.push(last_scores.<span class="bu">max</span>(<span class="dv">1</span>)[<span class="dv">0</span>].<span class="bu">float</span>().cpu())</span>
<span id="cb17-16"><a href="#cb17-16"></a>        <span class="va">self</span>.varvars.push(<span class="va">self</span>.<span class="bu">vars</span>.variance())</span>
<span id="cb17-17"><a href="#cb17-17"></a>        <span class="va">self</span>.size <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb17-18"><a href="#cb17-18"></a>        <span class="cf">if</span> <span class="va">self</span>.size <span class="op">&lt;</span> <span class="va">self</span>.window_size:</span>
<span id="cb17-19"><a href="#cb17-19"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb17-20"><a href="#cb17-20"></a></span>
<span id="cb17-21"><a href="#cb17-21"></a>        varvar <span class="op">=</span> <span class="va">self</span>.varvars.variance()</span>
<span id="cb17-22"><a href="#cb17-22"></a>        <span class="cf">for</span> b <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(last_scores)):</span>
<span id="cb17-23"><a href="#cb17-23"></a>            <span class="cf">if</span> varvar[b] <span class="op">&lt;</span> <span class="va">self</span>.threshold:</span>
<span id="cb17-24"><a href="#cb17-24"></a>                <span class="cf">if</span> <span class="va">self</span>.stop_inds[b] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="kw">not</span> <span class="va">self</span>.stopped[b]:</span>
<span id="cb17-25"><a href="#cb17-25"></a>                    <span class="va">self</span>.stopped[b] <span class="op">=</span> <span class="va">self</span>.stop_inds[b] <span class="op">&gt;=</span> <span class="va">self</span>.size</span>
<span id="cb17-26"><a href="#cb17-26"></a>                <span class="cf">else</span>:</span>
<span id="cb17-27"><a href="#cb17-27"></a>                    <span class="va">self</span>.stop_inds[b] <span class="op">=</span> <span class="bu">int</span>(</span>
<span id="cb17-28"><a href="#cb17-28"></a>                        <span class="bu">min</span>(<span class="bu">max</span>(<span class="va">self</span>.size, <span class="dv">1</span>) <span class="op">*</span> <span class="fl">1.15</span> <span class="op">+</span> <span class="dv">150</span> <span class="op">+</span> <span class="va">self</span>.window_size, <span class="dv">4095</span>)</span>
<span id="cb17-29"><a href="#cb17-29"></a>                    )</span>
<span id="cb17-30"><a href="#cb17-30"></a>            <span class="cf">else</span>:</span>
<span id="cb17-31"><a href="#cb17-31"></a>                <span class="va">self</span>.stop_inds[b] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-32"><a href="#cb17-32"></a>                <span class="va">self</span>.stopped[b] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb17-33"><a href="#cb17-33"></a>        <span class="cf">return</span> <span class="bu">all</span>(<span class="va">self</span>.stopped.values()) <span class="kw">and</span> <span class="bu">len</span>(<span class="va">self</span>.stopped) <span class="op">&gt;</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># autoregressively generate tokens, with custom stopping criteria (as defined by the Nougat authors)</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>outputs <span class="op">=</span> model.generate(pixel_values.to(device),</span>
<span id="cb18-4"><a href="#cb18-4"></a>                          min_length<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>                          max_length<span class="op">=</span><span class="dv">3584</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>                          bad_words_ids<span class="op">=</span>[[processor.tokenizer.unk_token_id]],</span>
<span id="cb18-7"><a href="#cb18-7"></a>                          return_dict_in_generate<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb18-8"><a href="#cb18-8"></a>                          output_scores<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb18-9"><a href="#cb18-9"></a>                          stopping_criteria<span class="op">=</span>StoppingCriteriaList([StoppingCriteriaScores()]),</span>
<span id="cb18-10"><a href="#cb18-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>generated <span class="op">=</span> processor.batch_decode(outputs[<span class="dv">0</span>], skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb19-2"><a href="#cb19-2"></a>generated <span class="op">=</span> processor.post_process_generation(generated, fix_markdown<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="bu">print</span>(generated)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code># Nougat: Neural Optical Understanding for Academic Documents

 Lukas Blecher

Correspondence to: lblecher@meta.com

Guillem Cucurull

Thomas Scialom

Robert Stojnic

Meta AI

The paper reports 8.1M papers but the authors recently updated the numbers on the GitHub page https://github.com/allenai/s2orc

###### Abstract

Scientific knowledge is predominantly stored in books and scientific journals, often in the form of PDFs. However, the PDF format leads to a loss of semantic information, particularly for mathematical expressions. We propose Nougat (**N**eural **O**ptical **U**nderstanding for **A**cademic Documents), a Visual Transformer model that performs an _Optical Character Recognition_ (OCR) task for processing scientific documents into a markup language, and demonstrate the effectiveness of our model on a new dataset of scientific documents. The proposed approach offers a promising solution to enhance the accessibility of scientific knowledge in the digital age, by bridging the gap between human-readable documents and machine-readable text. We release the models and code to accelerate future work on scientific text recognition.

## 1 Introduction

The majority of scientific knowledge is stored in books or published in scientific journals, most commonly in the Portable Document Format (PDF). Next to HTML, PDFs are the second most prominent data format on the internet, making up 2.4% of common crawl [1]. However, the information stored in these files is very difficult to extract into any other formats. This is especially true for highly specialized documents, such as scientific research papers, where the semantic information of mathematical expressions is lost.

Existing Optical Character Recognition (OCR) engines, such as Tesseract OCR [2], excel at detecting and classifying individual characters and words in an image, but fail to understand the relationship between them due to their line-by-line approach. This means that they treat superscripts and subscripts in the same way as the surrounding text, which is a significant drawback for mathematical expressions. In mathematical notations like fractions, exponents, and matrices, relative positions of characters are crucial.

Converting academic research papers into machine-readable text also enables accessibility and searchability of science as a whole. The information of millions of academic papers can not be fully accessed because they are locked behind an unreadable format. Existing corpora, such as the S2ORC dataset [3], capture the text of 12M2 papers using GROBID [4], but are missing meaningful representations of the mathematical equations.

Footnote 2: The paper reports 8.1M papers but the authors recently updated the numbers on the GitHub page https://github.com/allenai/s2orc

To this end, we introduce Nougat, a transformer based model that can convert images of document pages to formatted markup text.

The primary contributions in this paper are

* Release of a pre-trained model capable of converting a PDF to a lightweight markup language. We release the code and the model on GitHub3 Footnote 3: https://github.com/facebookresearch/nougat
* We introduce a pipeline to create dataset for pairing PDFs to source code
* Our method is only dependent on the image of a page, allowing access to scanned papers and books</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>



<!-- -->

</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div>CC BY-NC-SA 4.0</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{goni2023,
  author = {Goni, Hasan},
  title = {How to {Use} {Nougat} to {Read} {Scientific} {Paper}},
  date = {2023-10-21},
  url = {https://hasangoni.quarto.pub/hasan-blog-post/posts/nougat-to-read-scientific-pdf-files},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-goni2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Goni, Hasan. 2023. <span>“How to Use Nougat to Read Scientific
Paper.”</span> October 21, 2023. <a href="https://hasangoni.quarto.pub/hasan-blog-post/posts/nougat-to-read-scientific-pdf-files">https://hasangoni.quarto.pub/hasan-blog-post/posts/nougat-to-read-scientific-pdf-files</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="yourusername/quarto_blog_hasan" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
<script src="https://giscus.app/client.js" data-repo="HasanGoni/quarto_blog_hasan" data-repo-id="" data-category="General" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb22" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb22-1"><a href="#cb22-1"></a><span class="co">---</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="an">title:</span><span class="co"> How to Use Nougat to Read Scientific Paper</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="an">subtitle:</span><span class="co"> Research paper working</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="an">date:</span><span class="co"> "2023-10-21"</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="an">categories:</span><span class="co"> [Nlp, Research paper, Text]</span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="an">author:</span><span class="co"> "Hasan Goni"</span></span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="an">listing:</span></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="co">  sort: "date desc"</span></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="co">  contents: "posts"</span></span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="co">  sort-ui: false</span></span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="co">  filter-ui: false</span></span>
<span id="cb22-13"><a href="#cb22-13"></a><span class="co">  categories: true</span></span>
<span id="cb22-14"><a href="#cb22-14"></a><span class="co">   </span></span>
<span id="cb22-15"><a href="#cb22-15"></a><span class="an">page-layout:</span><span class="co"> full</span></span>
<span id="cb22-16"><a href="#cb22-16"></a><span class="an">image:</span><span class="co"> "image.png"</span></span>
<span id="cb22-17"><a href="#cb22-17"></a><span class="co">---</span></span>
<span id="cb22-18"><a href="#cb22-18"></a><span class="fu"># Nougat to read scientific PDFs</span></span>
<span id="cb22-19"><a href="#cb22-19"></a></span>
<span id="cb22-20"><a href="#cb22-20"></a><span class="ss">- </span>Copied from <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/NielsRogge/Transformers-Tutorials/tree/master/Nougat)</span></span>
<span id="cb22-21"><a href="#cb22-21"></a></span>
<span id="cb22-22"><a href="#cb22-22"></a><span class="fu"># TL-DR</span></span>
<span id="cb22-23"><a href="#cb22-23"></a>Nougat is a Visual Transformer model designed to enhance accessibility of scientific knowledge in the digital age.</span>
<span id="cb22-24"><a href="#cb22-24"></a>It converts scientific documents from PDFs into a markup language, improving understanding, especially for mathematical expressions.</span>
<span id="cb22-25"><a href="#cb22-25"></a>The model's effectiveness has been demonstrated on a new dataset of scientific documents.</span>
<span id="cb22-26"><a href="#cb22-26"></a>This innovation bridges the gap between human-readable and machine-readable text.</span>
<span id="cb22-27"><a href="#cb22-27"></a>The authors have shared their models and code to accelerate future research in scientific text recognition.</span>
<span id="cb22-28"><a href="#cb22-28"></a></span>
<span id="cb22-29"><a href="#cb22-29"></a></span>
<span id="cb22-30"><a href="#cb22-30"></a>This is just notebook, to show how to use it.</span>
<span id="cb22-31"><a href="#cb22-31"></a></span>
<span id="cb22-32"><a href="#cb22-32"></a><span class="ss">* </span>TODO</span>
<span id="cb22-33"><a href="#cb22-33"></a><span class="ss">    + </span>Write some more about the paper.</span>
<span id="cb22-34"><a href="#cb22-34"></a><span class="ss">    + </span>Add nbdev library to work with it, so that  just entering name of the pdf is needed from user hand and then it will be automatically converted.</span>
<span id="cb22-35"><a href="#cb22-35"></a><span class="ss">        + </span>Create pip install documentation for it</span>
<span id="cb22-36"><a href="#cb22-36"></a></span>
<span id="cb22-37"><a href="#cb22-37"></a><span class="fu">## Jupter notebook is the following</span></span>
<span id="cb22-38"><a href="#cb22-38"></a><span class="in">```python</span></span>
<span id="cb22-39"><a href="#cb22-39"></a><span class="co">#pip install -q pymupdf python-Levenshtein nltk</span></span>
<span id="cb22-40"><a href="#cb22-40"></a><span class="in">```</span></span>
<span id="cb22-41"><a href="#cb22-41"></a></span>
<span id="cb22-42"><a href="#cb22-42"></a></span>
<span id="cb22-43"><a href="#cb22-43"></a><span class="in">```python</span></span>
<span id="cb22-44"><a href="#cb22-44"></a><span class="im">from</span> transformers <span class="im">import</span> AutoProcessor, VisionEncoderDecoderModel</span>
<span id="cb22-45"><a href="#cb22-45"></a><span class="im">import</span> torch</span>
<span id="cb22-46"><a href="#cb22-46"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb22-47"><a href="#cb22-47"></a><span class="im">from</span> typing <span class="im">import</span> Optional, List, Dict, Tuple </span>
<span id="cb22-48"><a href="#cb22-48"></a><span class="im">import</span> io</span>
<span id="cb22-49"><a href="#cb22-49"></a><span class="im">import</span> fitz</span>
<span id="cb22-50"><a href="#cb22-50"></a><span class="im">from</span> huggingface_hub <span class="im">import</span> hf_hub_download</span>
<span id="cb22-51"><a href="#cb22-51"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb22-52"><a href="#cb22-52"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb22-53"><a href="#cb22-53"></a><span class="im">from</span> transformers <span class="im">import</span> StoppingCriteria, StoppingCriteriaList</span>
<span id="cb22-54"><a href="#cb22-54"></a><span class="in">```</span></span>
<span id="cb22-55"><a href="#cb22-55"></a></span>
<span id="cb22-56"><a href="#cb22-56"></a></span>
<span id="cb22-57"><a href="#cb22-57"></a><span class="in">```python</span></span>
<span id="cb22-58"><a href="#cb22-58"></a>processor <span class="op">=</span> AutoProcessor.from_pretrained(<span class="st">"facebook/nougat-small"</span>)</span>
<span id="cb22-59"><a href="#cb22-59"></a>model <span class="op">=</span> VisionEncoderDecoderModel.from_pretrained(<span class="st">"facebook/nougat-small"</span>)</span>
<span id="cb22-60"><a href="#cb22-60"></a><span class="in">```</span></span>
<span id="cb22-61"><a href="#cb22-61"></a></span>
<span id="cb22-62"><a href="#cb22-62"></a></span>
<span id="cb22-63"><a href="#cb22-63"></a><span class="in">    Downloading (…)rocessor_config.json:   0%|          | 0.00/479 [00:00&lt;?, ?B/s]</span></span>
<span id="cb22-64"><a href="#cb22-64"></a></span>
<span id="cb22-65"><a href="#cb22-65"></a></span>
<span id="cb22-66"><a href="#cb22-66"></a></span>
<span id="cb22-67"><a href="#cb22-67"></a><span class="in">    Downloading (…)okenizer_config.json:   0%|          | 0.00/4.49k [00:00&lt;?, ?B/s]</span></span>
<span id="cb22-68"><a href="#cb22-68"></a></span>
<span id="cb22-69"><a href="#cb22-69"></a></span>
<span id="cb22-70"><a href="#cb22-70"></a></span>
<span id="cb22-71"><a href="#cb22-71"></a><span class="in">    Downloading (…)/main/tokenizer.json:   0%|          | 0.00/2.14M [00:00&lt;?, ?B/s]</span></span>
<span id="cb22-72"><a href="#cb22-72"></a></span>
<span id="cb22-73"><a href="#cb22-73"></a></span>
<span id="cb22-74"><a href="#cb22-74"></a></span>
<span id="cb22-75"><a href="#cb22-75"></a><span class="in">    Downloading (…)cial_tokens_map.json:   0%|          | 0.00/96.0 [00:00&lt;?, ?B/s]</span></span>
<span id="cb22-76"><a href="#cb22-76"></a></span>
<span id="cb22-77"><a href="#cb22-77"></a></span>
<span id="cb22-78"><a href="#cb22-78"></a><span class="in">    Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.</span></span>
<span id="cb22-79"><a href="#cb22-79"></a></span>
<span id="cb22-80"><a href="#cb22-80"></a></span>
<span id="cb22-81"><a href="#cb22-81"></a></span>
<span id="cb22-82"><a href="#cb22-82"></a><span class="in">    Downloading (…)lve/main/config.json:   0%|          | 0.00/4.77k [00:00&lt;?, ?B/s]</span></span>
<span id="cb22-83"><a href="#cb22-83"></a></span>
<span id="cb22-84"><a href="#cb22-84"></a></span>
<span id="cb22-85"><a href="#cb22-85"></a></span>
<span id="cb22-86"><a href="#cb22-86"></a><span class="in">    Downloading pytorch_model.bin:   0%|          | 0.00/990M [00:00&lt;?, ?B/s]</span></span>
<span id="cb22-87"><a href="#cb22-87"></a></span>
<span id="cb22-88"><a href="#cb22-88"></a></span>
<span id="cb22-89"><a href="#cb22-89"></a></span>
<span id="cb22-90"><a href="#cb22-90"></a><span class="in">    Downloading (…)neration_config.json:   0%|          | 0.00/165 [00:00&lt;?, ?B/s]</span></span>
<span id="cb22-91"><a href="#cb22-91"></a></span>
<span id="cb22-92"><a href="#cb22-92"></a></span>
<span id="cb22-93"><a href="#cb22-93"></a></span>
<span id="cb22-94"><a href="#cb22-94"></a><span class="in">```python</span></span>
<span id="cb22-95"><a href="#cb22-95"></a><span class="op">%%</span>capture</span>
<span id="cb22-96"><a href="#cb22-96"></a><span class="co">#device = "cuda" if torch.cuda.is_available() else "cpu"</span></span>
<span id="cb22-97"><a href="#cb22-97"></a>device <span class="op">=</span> <span class="st">"cpu"</span></span>
<span id="cb22-98"><a href="#cb22-98"></a>model.to(device)</span>
<span id="cb22-99"><a href="#cb22-99"></a>     </span>
<span id="cb22-100"><a href="#cb22-100"></a><span class="in">```</span></span>
<span id="cb22-101"><a href="#cb22-101"></a></span>
<span id="cb22-102"><a href="#cb22-102"></a></span>
<span id="cb22-103"><a href="#cb22-103"></a><span class="in">```python</span></span>
<span id="cb22-104"><a href="#cb22-104"></a>filepath <span class="op">=</span> hf_hub_download(repo_id<span class="op">=</span><span class="st">"ysharma/nougat"</span>, filename<span class="op">=</span><span class="st">"input/nougat.pdf"</span>, repo_type<span class="op">=</span><span class="st">"space"</span>)</span>
<span id="cb22-105"><a href="#cb22-105"></a><span class="in">```</span></span>
<span id="cb22-106"><a href="#cb22-106"></a></span>
<span id="cb22-107"><a href="#cb22-107"></a></span>
<span id="cb22-108"><a href="#cb22-108"></a><span class="in">    Downloading nougat.pdf:   0%|          | 0.00/4.13M [00:00&lt;?, ?B/s]</span></span>
<span id="cb22-109"><a href="#cb22-109"></a></span>
<span id="cb22-110"><a href="#cb22-110"></a></span>
<span id="cb22-111"><a href="#cb22-111"></a></span>
<span id="cb22-112"><a href="#cb22-112"></a><span class="in">```python</span></span>
<span id="cb22-113"><a href="#cb22-113"></a><span class="kw">def</span> rasterize_paper(</span>
<span id="cb22-114"><a href="#cb22-114"></a>    pdf: Path,</span>
<span id="cb22-115"><a href="#cb22-115"></a>    outpath: Optional[Path] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb22-116"><a href="#cb22-116"></a>    dpi: <span class="bu">int</span> <span class="op">=</span> <span class="dv">96</span>,</span>
<span id="cb22-117"><a href="#cb22-117"></a>    return_pil<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb22-118"><a href="#cb22-118"></a>    pages<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb22-119"><a href="#cb22-119"></a>) <span class="op">-&gt;</span> Optional[List[io.BytesIO]]:</span>
<span id="cb22-120"><a href="#cb22-120"></a>    <span class="co">"""</span></span>
<span id="cb22-121"><a href="#cb22-121"></a><span class="co">    Rasterize a PDF file to PNG images.</span></span>
<span id="cb22-122"><a href="#cb22-122"></a></span>
<span id="cb22-123"><a href="#cb22-123"></a><span class="co">    Args:</span></span>
<span id="cb22-124"><a href="#cb22-124"></a><span class="co">        pdf (Path): The path to the PDF file.</span></span>
<span id="cb22-125"><a href="#cb22-125"></a><span class="co">        outpath (Optional[Path], optional): The output directory. If None, the PIL images will be returned instead. Defaults to None.</span></span>
<span id="cb22-126"><a href="#cb22-126"></a><span class="co">        dpi (int, optional): The output DPI. Defaults to 96.</span></span>
<span id="cb22-127"><a href="#cb22-127"></a><span class="co">        return_pil (bool, optional): Whether to return the PIL images instead of writing them to disk. Defaults to False.</span></span>
<span id="cb22-128"><a href="#cb22-128"></a><span class="co">        pages (Optional[List[int]], optional): The pages to rasterize. If None, all pages will be rasterized. Defaults to None.</span></span>
<span id="cb22-129"><a href="#cb22-129"></a></span>
<span id="cb22-130"><a href="#cb22-130"></a><span class="co">    Returns:</span></span>
<span id="cb22-131"><a href="#cb22-131"></a><span class="co">        Optional[List[io.BytesIO]]: The PIL images if `return_pil` is True, otherwise None.</span></span>
<span id="cb22-132"><a href="#cb22-132"></a><span class="co">    """</span></span>
<span id="cb22-133"><a href="#cb22-133"></a></span>
<span id="cb22-134"><a href="#cb22-134"></a>    pillow_images <span class="op">=</span> []</span>
<span id="cb22-135"><a href="#cb22-135"></a>    <span class="cf">if</span> outpath <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb22-136"><a href="#cb22-136"></a>        return_pil <span class="op">=</span> <span class="va">True</span></span>
<span id="cb22-137"><a href="#cb22-137"></a>    <span class="cf">try</span>:</span>
<span id="cb22-138"><a href="#cb22-138"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(pdf, (<span class="bu">str</span>, Path)):</span>
<span id="cb22-139"><a href="#cb22-139"></a>            pdf <span class="op">=</span> fitz.<span class="bu">open</span>(pdf)</span>
<span id="cb22-140"><a href="#cb22-140"></a>        <span class="cf">if</span> pages <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb22-141"><a href="#cb22-141"></a>            pages <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(pdf))</span>
<span id="cb22-142"><a href="#cb22-142"></a>        <span class="cf">for</span> i <span class="kw">in</span> pages:</span>
<span id="cb22-143"><a href="#cb22-143"></a>            page_bytes: <span class="bu">bytes</span> <span class="op">=</span> pdf[i].get_pixmap(dpi<span class="op">=</span>dpi).pil_tobytes(<span class="bu">format</span><span class="op">=</span><span class="st">"PNG"</span>)</span>
<span id="cb22-144"><a href="#cb22-144"></a>            <span class="cf">if</span> return_pil:</span>
<span id="cb22-145"><a href="#cb22-145"></a>                pillow_images.append(io.BytesIO(page_bytes))</span>
<span id="cb22-146"><a href="#cb22-146"></a>            <span class="cf">else</span>:</span>
<span id="cb22-147"><a href="#cb22-147"></a>                <span class="cf">with</span> (outpath <span class="op">/</span> (<span class="st">"</span><span class="sc">%02d</span><span class="st">.png"</span> <span class="op">%</span> (i <span class="op">+</span> <span class="dv">1</span>))).<span class="bu">open</span>(<span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb22-148"><a href="#cb22-148"></a>                    f.write(page_bytes)</span>
<span id="cb22-149"><a href="#cb22-149"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb22-150"><a href="#cb22-150"></a>        <span class="cf">pass</span></span>
<span id="cb22-151"><a href="#cb22-151"></a>    <span class="cf">if</span> return_pil:</span>
<span id="cb22-152"><a href="#cb22-152"></a>        <span class="cf">return</span> pillow_images</span>
<span id="cb22-153"><a href="#cb22-153"></a><span class="in">```</span></span>
<span id="cb22-154"><a href="#cb22-154"></a></span>
<span id="cb22-155"><a href="#cb22-155"></a></span>
<span id="cb22-156"><a href="#cb22-156"></a><span class="in">```python</span></span>
<span id="cb22-157"><a href="#cb22-157"></a>images <span class="op">=</span> rasterize_paper(pdf<span class="op">=</span>filepath, return_pil<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-158"><a href="#cb22-158"></a><span class="in">```</span></span>
<span id="cb22-159"><a href="#cb22-159"></a></span>
<span id="cb22-160"><a href="#cb22-160"></a></span>
<span id="cb22-161"><a href="#cb22-161"></a><span class="in">```python</span></span>
<span id="cb22-162"><a href="#cb22-162"></a><span class="bu">len</span>(images)</span>
<span id="cb22-163"><a href="#cb22-163"></a><span class="in">```</span></span>
<span id="cb22-164"><a href="#cb22-164"></a></span>
<span id="cb22-165"><a href="#cb22-165"></a></span>
<span id="cb22-166"><a href="#cb22-166"></a></span>
<span id="cb22-167"><a href="#cb22-167"></a></span>
<span id="cb22-168"><a href="#cb22-168"></a><span class="in">    17</span></span>
<span id="cb22-169"><a href="#cb22-169"></a></span>
<span id="cb22-170"><a href="#cb22-170"></a></span>
<span id="cb22-171"><a href="#cb22-171"></a></span>
<span id="cb22-172"><a href="#cb22-172"></a></span>
<span id="cb22-173"><a href="#cb22-173"></a><span class="in">```python</span></span>
<span id="cb22-174"><a href="#cb22-174"></a>image <span class="op">=</span> Image.<span class="bu">open</span>(images[<span class="dv">0</span>])</span>
<span id="cb22-175"><a href="#cb22-175"></a><span class="in">```</span></span>
<span id="cb22-176"><a href="#cb22-176"></a></span>
<span id="cb22-177"><a href="#cb22-177"></a></span>
<span id="cb22-178"><a href="#cb22-178"></a><span class="in">```python</span></span>
<span id="cb22-179"><a href="#cb22-179"></a>image</span>
<span id="cb22-180"><a href="#cb22-180"></a><span class="in">```</span></span>
<span id="cb22-181"><a href="#cb22-181"></a></span>
<span id="cb22-182"><a href="#cb22-182"></a></span>
<span id="cb22-183"><a href="#cb22-183"></a></span>
<span id="cb22-184"><a href="#cb22-184"></a></span>
<span id="cb22-185"><a href="#cb22-185"></a><span class="in">    </span></span>
<span id="cb22-186"><a href="#cb22-186"></a><span class="al">![png](images/image.png)</span></span>
<span id="cb22-187"><a href="#cb22-187"></a>    </span>
<span id="cb22-188"><a href="#cb22-188"></a></span>
<span id="cb22-189"><a href="#cb22-189"></a></span>
<span id="cb22-190"><a href="#cb22-190"></a></span>
<span id="cb22-191"><a href="#cb22-191"></a></span>
<span id="cb22-192"><a href="#cb22-192"></a><span class="in">```python</span></span>
<span id="cb22-193"><a href="#cb22-193"></a><span class="co"># prepare image for the model</span></span>
<span id="cb22-194"><a href="#cb22-194"></a>pixel_values <span class="op">=</span> processor(images<span class="op">=</span>image, return_tensors<span class="op">=</span><span class="st">"pt"</span>).pixel_values</span>
<span id="cb22-195"><a href="#cb22-195"></a><span class="bu">print</span>(pixel_values.shape)</span>
<span id="cb22-196"><a href="#cb22-196"></a>     </span>
<span id="cb22-197"><a href="#cb22-197"></a><span class="in">```</span></span>
<span id="cb22-198"><a href="#cb22-198"></a></span>
<span id="cb22-199"><a href="#cb22-199"></a><span class="in">    torch.Size([1, 3, 896, 672])</span></span>
<span id="cb22-200"><a href="#cb22-200"></a></span>
<span id="cb22-201"><a href="#cb22-201"></a></span>
<span id="cb22-202"><a href="#cb22-202"></a></span>
<span id="cb22-203"><a href="#cb22-203"></a><span class="in">```python</span></span>
<span id="cb22-204"><a href="#cb22-204"></a><span class="kw">class</span> RunningVarTorch:</span>
<span id="cb22-205"><a href="#cb22-205"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, L<span class="op">=</span><span class="dv">15</span>, norm<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb22-206"><a href="#cb22-206"></a>        <span class="va">self</span>.values <span class="op">=</span> <span class="va">None</span></span>
<span id="cb22-207"><a href="#cb22-207"></a>        <span class="va">self</span>.L <span class="op">=</span> L</span>
<span id="cb22-208"><a href="#cb22-208"></a>        <span class="va">self</span>.norm <span class="op">=</span> norm</span>
<span id="cb22-209"><a href="#cb22-209"></a></span>
<span id="cb22-210"><a href="#cb22-210"></a>    <span class="kw">def</span> push(<span class="va">self</span>, x: torch.Tensor):</span>
<span id="cb22-211"><a href="#cb22-211"></a>        <span class="cf">assert</span> x.dim() <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb22-212"><a href="#cb22-212"></a>        <span class="cf">if</span> <span class="va">self</span>.values <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb22-213"><a href="#cb22-213"></a>            <span class="va">self</span>.values <span class="op">=</span> x[:, <span class="va">None</span>]</span>
<span id="cb22-214"><a href="#cb22-214"></a>        <span class="cf">elif</span> <span class="va">self</span>.values.shape[<span class="dv">1</span>] <span class="op">&lt;</span> <span class="va">self</span>.L:</span>
<span id="cb22-215"><a href="#cb22-215"></a>            <span class="va">self</span>.values <span class="op">=</span> torch.cat((<span class="va">self</span>.values, x[:, <span class="va">None</span>]), <span class="dv">1</span>)</span>
<span id="cb22-216"><a href="#cb22-216"></a>        <span class="cf">else</span>:</span>
<span id="cb22-217"><a href="#cb22-217"></a>            <span class="va">self</span>.values <span class="op">=</span> torch.cat((<span class="va">self</span>.values[:, <span class="dv">1</span>:], x[:, <span class="va">None</span>]), <span class="dv">1</span>)</span>
<span id="cb22-218"><a href="#cb22-218"></a></span>
<span id="cb22-219"><a href="#cb22-219"></a>    <span class="kw">def</span> variance(<span class="va">self</span>):</span>
<span id="cb22-220"><a href="#cb22-220"></a>        <span class="cf">if</span> <span class="va">self</span>.values <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb22-221"><a href="#cb22-221"></a>            <span class="cf">return</span></span>
<span id="cb22-222"><a href="#cb22-222"></a>        <span class="cf">if</span> <span class="va">self</span>.norm:</span>
<span id="cb22-223"><a href="#cb22-223"></a>            <span class="cf">return</span> torch.var(<span class="va">self</span>.values, <span class="dv">1</span>) <span class="op">/</span> <span class="va">self</span>.values.shape[<span class="dv">1</span>]</span>
<span id="cb22-224"><a href="#cb22-224"></a>        <span class="cf">else</span>:</span>
<span id="cb22-225"><a href="#cb22-225"></a>            <span class="cf">return</span> torch.var(<span class="va">self</span>.values, <span class="dv">1</span>)</span>
<span id="cb22-226"><a href="#cb22-226"></a><span class="in">```</span></span>
<span id="cb22-227"><a href="#cb22-227"></a></span>
<span id="cb22-228"><a href="#cb22-228"></a></span>
<span id="cb22-229"><a href="#cb22-229"></a><span class="in">```python</span></span>
<span id="cb22-230"><a href="#cb22-230"></a><span class="kw">class</span> StoppingCriteriaScores(StoppingCriteria):</span>
<span id="cb22-231"><a href="#cb22-231"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, threshold: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.015</span>, window_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">200</span>):</span>
<span id="cb22-232"><a href="#cb22-232"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb22-233"><a href="#cb22-233"></a>        <span class="va">self</span>.threshold <span class="op">=</span> threshold</span>
<span id="cb22-234"><a href="#cb22-234"></a>        <span class="va">self</span>.<span class="bu">vars</span> <span class="op">=</span> RunningVarTorch(norm<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-235"><a href="#cb22-235"></a>        <span class="va">self</span>.varvars <span class="op">=</span> RunningVarTorch(L<span class="op">=</span>window_size)</span>
<span id="cb22-236"><a href="#cb22-236"></a>        <span class="va">self</span>.stop_inds <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb22-237"><a href="#cb22-237"></a>        <span class="va">self</span>.stopped <span class="op">=</span> defaultdict(<span class="bu">bool</span>)</span>
<span id="cb22-238"><a href="#cb22-238"></a>        <span class="va">self</span>.size <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-239"><a href="#cb22-239"></a>        <span class="va">self</span>.window_size <span class="op">=</span> window_size</span>
<span id="cb22-240"><a href="#cb22-240"></a></span>
<span id="cb22-241"><a href="#cb22-241"></a>    <span class="at">@torch.no_grad</span>()</span>
<span id="cb22-242"><a href="#cb22-242"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, input_ids: torch.LongTensor, scores: torch.FloatTensor):</span>
<span id="cb22-243"><a href="#cb22-243"></a>        last_scores <span class="op">=</span> scores[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb22-244"><a href="#cb22-244"></a>        <span class="va">self</span>.<span class="bu">vars</span>.push(last_scores.<span class="bu">max</span>(<span class="dv">1</span>)[<span class="dv">0</span>].<span class="bu">float</span>().cpu())</span>
<span id="cb22-245"><a href="#cb22-245"></a>        <span class="va">self</span>.varvars.push(<span class="va">self</span>.<span class="bu">vars</span>.variance())</span>
<span id="cb22-246"><a href="#cb22-246"></a>        <span class="va">self</span>.size <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb22-247"><a href="#cb22-247"></a>        <span class="cf">if</span> <span class="va">self</span>.size <span class="op">&lt;</span> <span class="va">self</span>.window_size:</span>
<span id="cb22-248"><a href="#cb22-248"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb22-249"><a href="#cb22-249"></a></span>
<span id="cb22-250"><a href="#cb22-250"></a>        varvar <span class="op">=</span> <span class="va">self</span>.varvars.variance()</span>
<span id="cb22-251"><a href="#cb22-251"></a>        <span class="cf">for</span> b <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(last_scores)):</span>
<span id="cb22-252"><a href="#cb22-252"></a>            <span class="cf">if</span> varvar[b] <span class="op">&lt;</span> <span class="va">self</span>.threshold:</span>
<span id="cb22-253"><a href="#cb22-253"></a>                <span class="cf">if</span> <span class="va">self</span>.stop_inds[b] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="kw">not</span> <span class="va">self</span>.stopped[b]:</span>
<span id="cb22-254"><a href="#cb22-254"></a>                    <span class="va">self</span>.stopped[b] <span class="op">=</span> <span class="va">self</span>.stop_inds[b] <span class="op">&gt;=</span> <span class="va">self</span>.size</span>
<span id="cb22-255"><a href="#cb22-255"></a>                <span class="cf">else</span>:</span>
<span id="cb22-256"><a href="#cb22-256"></a>                    <span class="va">self</span>.stop_inds[b] <span class="op">=</span> <span class="bu">int</span>(</span>
<span id="cb22-257"><a href="#cb22-257"></a>                        <span class="bu">min</span>(<span class="bu">max</span>(<span class="va">self</span>.size, <span class="dv">1</span>) <span class="op">*</span> <span class="fl">1.15</span> <span class="op">+</span> <span class="dv">150</span> <span class="op">+</span> <span class="va">self</span>.window_size, <span class="dv">4095</span>)</span>
<span id="cb22-258"><a href="#cb22-258"></a>                    )</span>
<span id="cb22-259"><a href="#cb22-259"></a>            <span class="cf">else</span>:</span>
<span id="cb22-260"><a href="#cb22-260"></a>                <span class="va">self</span>.stop_inds[b] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-261"><a href="#cb22-261"></a>                <span class="va">self</span>.stopped[b] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb22-262"><a href="#cb22-262"></a>        <span class="cf">return</span> <span class="bu">all</span>(<span class="va">self</span>.stopped.values()) <span class="kw">and</span> <span class="bu">len</span>(<span class="va">self</span>.stopped) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb22-263"><a href="#cb22-263"></a><span class="in">```</span></span>
<span id="cb22-264"><a href="#cb22-264"></a></span>
<span id="cb22-265"><a href="#cb22-265"></a></span>
<span id="cb22-266"><a href="#cb22-266"></a><span class="in">```python</span></span>
<span id="cb22-267"><a href="#cb22-267"></a></span>
<span id="cb22-268"><a href="#cb22-268"></a><span class="co"># autoregressively generate tokens, with custom stopping criteria (as defined by the Nougat authors)</span></span>
<span id="cb22-269"><a href="#cb22-269"></a>outputs <span class="op">=</span> model.generate(pixel_values.to(device),</span>
<span id="cb22-270"><a href="#cb22-270"></a>                          min_length<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb22-271"><a href="#cb22-271"></a>                          max_length<span class="op">=</span><span class="dv">3584</span>,</span>
<span id="cb22-272"><a href="#cb22-272"></a>                          bad_words_ids<span class="op">=</span>[[processor.tokenizer.unk_token_id]],</span>
<span id="cb22-273"><a href="#cb22-273"></a>                          return_dict_in_generate<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-274"><a href="#cb22-274"></a>                          output_scores<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-275"><a href="#cb22-275"></a>                          stopping_criteria<span class="op">=</span>StoppingCriteriaList([StoppingCriteriaScores()]),</span>
<span id="cb22-276"><a href="#cb22-276"></a>)</span>
<span id="cb22-277"><a href="#cb22-277"></a><span class="in">```</span></span>
<span id="cb22-278"><a href="#cb22-278"></a></span>
<span id="cb22-279"><a href="#cb22-279"></a></span>
<span id="cb22-280"><a href="#cb22-280"></a><span class="in">```python</span></span>
<span id="cb22-281"><a href="#cb22-281"></a>generated <span class="op">=</span> processor.batch_decode(outputs[<span class="dv">0</span>], skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb22-282"><a href="#cb22-282"></a>generated <span class="op">=</span> processor.post_process_generation(generated, fix_markdown<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-283"><a href="#cb22-283"></a><span class="bu">print</span>(generated)</span>
<span id="cb22-284"><a href="#cb22-284"></a><span class="in">```</span></span>
<span id="cb22-285"><a href="#cb22-285"></a></span>
<span id="cb22-286"><a href="#cb22-286"></a><span class="in">    </span></span>
<span id="cb22-287"><a href="#cb22-287"></a><span class="in">    </span></span>
<span id="cb22-288"><a href="#cb22-288"></a><span class="in">    # Nougat: Neural Optical Understanding for Academic Documents</span></span>
<span id="cb22-289"><a href="#cb22-289"></a><span class="in">    </span></span>
<span id="cb22-290"><a href="#cb22-290"></a><span class="in">     Lukas Blecher</span></span>
<span id="cb22-291"><a href="#cb22-291"></a><span class="in">    </span></span>
<span id="cb22-292"><a href="#cb22-292"></a><span class="in">    Correspondence to: lblecher@meta.com</span></span>
<span id="cb22-293"><a href="#cb22-293"></a><span class="in">    </span></span>
<span id="cb22-294"><a href="#cb22-294"></a><span class="in">    Guillem Cucurull</span></span>
<span id="cb22-295"><a href="#cb22-295"></a><span class="in">    </span></span>
<span id="cb22-296"><a href="#cb22-296"></a><span class="in">    Thomas Scialom</span></span>
<span id="cb22-297"><a href="#cb22-297"></a><span class="in">    </span></span>
<span id="cb22-298"><a href="#cb22-298"></a><span class="in">    Robert Stojnic</span></span>
<span id="cb22-299"><a href="#cb22-299"></a><span class="in">    </span></span>
<span id="cb22-300"><a href="#cb22-300"></a><span class="in">    Meta AI</span></span>
<span id="cb22-301"><a href="#cb22-301"></a><span class="in">    </span></span>
<span id="cb22-302"><a href="#cb22-302"></a><span class="in">    The paper reports 8.1M papers but the authors recently updated the numbers on the GitHub page https://github.com/allenai/s2orc</span></span>
<span id="cb22-303"><a href="#cb22-303"></a><span class="in">    </span></span>
<span id="cb22-304"><a href="#cb22-304"></a><span class="in">    ###### Abstract</span></span>
<span id="cb22-305"><a href="#cb22-305"></a><span class="in">    </span></span>
<span id="cb22-306"><a href="#cb22-306"></a><span class="in">    Scientific knowledge is predominantly stored in books and scientific journals, often in the form of PDFs. However, the PDF format leads to a loss of semantic information, particularly for mathematical expressions. We propose Nougat (**N**eural **O**ptical **U**nderstanding for **A**cademic Documents), a Visual Transformer model that performs an _Optical Character Recognition_ (OCR) task for processing scientific documents into a markup language, and demonstrate the effectiveness of our model on a new dataset of scientific documents. The proposed approach offers a promising solution to enhance the accessibility of scientific knowledge in the digital age, by bridging the gap between human-readable documents and machine-readable text. We release the models and code to accelerate future work on scientific text recognition.</span></span>
<span id="cb22-307"><a href="#cb22-307"></a><span class="in">    </span></span>
<span id="cb22-308"><a href="#cb22-308"></a><span class="in">    ## 1 Introduction</span></span>
<span id="cb22-309"><a href="#cb22-309"></a><span class="in">    </span></span>
<span id="cb22-310"><a href="#cb22-310"></a><span class="in">    The majority of scientific knowledge is stored in books or published in scientific journals, most commonly in the Portable Document Format (PDF). Next to HTML, PDFs are the second most prominent data format on the internet, making up 2.4% of common crawl [1]. However, the information stored in these files is very difficult to extract into any other formats. This is especially true for highly specialized documents, such as scientific research papers, where the semantic information of mathematical expressions is lost.</span></span>
<span id="cb22-311"><a href="#cb22-311"></a><span class="in">    </span></span>
<span id="cb22-312"><a href="#cb22-312"></a><span class="in">    Existing Optical Character Recognition (OCR) engines, such as Tesseract OCR [2], excel at detecting and classifying individual characters and words in an image, but fail to understand the relationship between them due to their line-by-line approach. This means that they treat superscripts and subscripts in the same way as the surrounding text, which is a significant drawback for mathematical expressions. In mathematical notations like fractions, exponents, and matrices, relative positions of characters are crucial.</span></span>
<span id="cb22-313"><a href="#cb22-313"></a><span class="in">    </span></span>
<span id="cb22-314"><a href="#cb22-314"></a><span class="in">    Converting academic research papers into machine-readable text also enables accessibility and searchability of science as a whole. The information of millions of academic papers can not be fully accessed because they are locked behind an unreadable format. Existing corpora, such as the S2ORC dataset [3], capture the text of 12M2 papers using GROBID [4], but are missing meaningful representations of the mathematical equations.</span></span>
<span id="cb22-315"><a href="#cb22-315"></a><span class="in">    </span></span>
<span id="cb22-316"><a href="#cb22-316"></a><span class="in">    Footnote 2: The paper reports 8.1M papers but the authors recently updated the numbers on the GitHub page https://github.com/allenai/s2orc</span></span>
<span id="cb22-317"><a href="#cb22-317"></a><span class="in">    </span></span>
<span id="cb22-318"><a href="#cb22-318"></a><span class="in">    To this end, we introduce Nougat, a transformer based model that can convert images of document pages to formatted markup text.</span></span>
<span id="cb22-319"><a href="#cb22-319"></a><span class="in">    </span></span>
<span id="cb22-320"><a href="#cb22-320"></a><span class="in">    The primary contributions in this paper are</span></span>
<span id="cb22-321"><a href="#cb22-321"></a><span class="in">    </span></span>
<span id="cb22-322"><a href="#cb22-322"></a><span class="in">    * Release of a pre-trained model capable of converting a PDF to a lightweight markup language. We release the code and the model on GitHub3 Footnote 3: https://github.com/facebookresearch/nougat</span></span>
<span id="cb22-323"><a href="#cb22-323"></a><span class="in">    * We introduce a pipeline to create dataset for pairing PDFs to source code</span></span>
<span id="cb22-324"><a href="#cb22-324"></a><span class="in">    * Our method is only dependent on the image of a page, allowing access to scanned papers and books</span></span>
<span id="cb22-325"><a href="#cb22-325"></a></span>
<span id="cb22-326"><a href="#cb22-326"></a></span>
<span id="cb22-327"><a href="#cb22-327"></a></span>
<span id="cb22-328"><a href="#cb22-328"></a><span class="in">```python</span></span>
<span id="cb22-329"><a href="#cb22-329"></a></span>
<span id="cb22-330"><a href="#cb22-330"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>