<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hasan">
<meta name="dcterms.date" content="2025-01-22">

<title>Hasan’s Data Science &amp; AI Blog - Feature Magic: What Makes Images Unique</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Hasan’s Data Science &amp; AI Blog - Feature Magic: What Makes Images Unique">
<meta property="og:description" content="">
<meta property="og:image" content="https://hasangoni.quarto.pub/hasan-blog-post/posts/series/cv-foundations/images/feature-magic-header.jpg">
<meta property="og:site-name" content="Hasan's Data Science &amp; AI Blog">
<meta name="twitter:title" content="Hasan’s Data Science &amp; AI Blog - Feature Magic: What Makes Images Unique">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://hasangoni.quarto.pub/hasan-blog-post/posts/series/cv-foundations/images/feature-magic-header.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Hasan’s Data Science &amp; AI Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-series" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Series</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-series">    
        <li>
    <a class="dropdown-item" href="../../../posts/series/data-science-steps.html" rel="" target="">
 <span class="dropdown-text">Data Science Steps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../posts/series/computer-vision-foundations.html" rel="" target="">
 <span class="dropdown-text">Computer Vision Foundations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../posts/series/vlm.html" rel="" target="">
 <span class="dropdown-text">VLM Series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../posts/series/anomaly-detection/index.html" rel="" target="">
 <span class="dropdown-text">Anomaly Detection</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../categories.html" rel="" target="">
 <span class="menu-text">Categories</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tags.html" rel="" target="">
 <span class="menu-text">Tags</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/HasanGoni" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/hasangoni" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../posts/series/computer-vision-foundations.html">Computer Vision Foundations</a></li><li class="breadcrumb-item"><a href="../../../posts/series/cv-foundations/06-feature-magic.html">6. Feature Magic</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Feature Magic: What Makes Images Unique</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                                <div class="quarto-categories">
                <div class="quarto-category">computer-vision</div>
                <div class="quarto-category">features</div>
                <div class="quarto-category">keypoints</div>
                <div class="quarto-category">matching</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Hasan </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 22, 2025</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">June 29, 2025</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/data-science-steps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/data-science-steps-to-follow-part01/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/data-science-steps-to-follow-part02/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/data-science-steps-to-follow-part03/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 03</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/data-science-steps-to-follow-part04/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 04</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/data-science-steps-to-follow-part05/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 05</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/data-science-steps-to-follow-part06/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Steps to Follow - 06</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Computer Vision Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/computer-vision-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computer Vision Foundations Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/cv-foundations/01-why-computer-vision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Why Computer Vision?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/cv-foundations/02-images-as-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Images as Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/cv-foundations/03-opencv-essentials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. OpenCV Essentials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/cv-foundations/04-finding-patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Finding Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/cv-foundations/05-image-segmentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Image Segmentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/cv-foundations/06-feature-magic.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">6. Feature Magic</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/cv-foundations/07-why-deep-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Why Deep Learning?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/cv-foundations/08-modern-vision-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Modern Vision Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/cv-foundations/09-first-cv-project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. First CV Project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/cv-foundations/10-where-to-go-next.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Where to Go Next</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Anomaly Detection</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/anomaly-detection/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/anomaly-detection/finding-the-oddballs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finding the Oddballs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">VLM Series</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/vlm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/series/vlm-qwen3-14b/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Qwen3-14B</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-puzzle-piece-problem" id="toc-the-puzzle-piece-problem" class="nav-link active" data-scroll-target="#the-puzzle-piece-problem"><span class="header-section-number">0.1</span> The Puzzle Piece Problem</a></li>
  <li><a href="#what-are-features" id="toc-what-are-features" class="nav-link" data-scroll-target="#what-are-features"><span class="header-section-number">0.2</span> What Are Features?</a></li>
  <li><a href="#your-first-feature-detector-sift" id="toc-your-first-feature-detector-sift" class="nav-link" data-scroll-target="#your-first-feature-detector-sift"><span class="header-section-number">0.3</span> Your First Feature Detector: SIFT</a></li>
  <li><a href="#the-faster-alternative-orb" id="toc-the-faster-alternative-orb" class="nav-link" data-scroll-target="#the-faster-alternative-orb"><span class="header-section-number">0.4</span> The Faster Alternative: ORB</a></li>
  <li><a href="#feature-matching-finding-connections" id="toc-feature-matching-finding-connections" class="nav-link" data-scroll-target="#feature-matching-finding-connections"><span class="header-section-number">0.5</span> Feature Matching: Finding Connections</a></li>
  <li><a href="#understanding-feature-descriptors" id="toc-understanding-feature-descriptors" class="nav-link" data-scroll-target="#understanding-feature-descriptors"><span class="header-section-number">0.6</span> Understanding Feature Descriptors</a></li>
  <li><a href="#real-world-application-object-recognition" id="toc-real-world-application-object-recognition" class="nav-link" data-scroll-target="#real-world-application-object-recognition"><span class="header-section-number">0.7</span> Real-World Application: Object Recognition</a></li>
  <li><a href="#feature-detection-comparison" id="toc-feature-detection-comparison" class="nav-link" data-scroll-target="#feature-detection-comparison"><span class="header-section-number">0.8</span> Feature Detection Comparison</a></li>
  <li><a href="#your-challenge-build-a-panorama-stitcher" id="toc-your-challenge-build-a-panorama-stitcher" class="nav-link" data-scroll-target="#your-challenge-build-a-panorama-stitcher"><span class="header-section-number">0.9</span> Your Challenge: Build a Panorama Stitcher</a></li>
  <li><a href="#the-magic-behind-feature-matching" id="toc-the-magic-behind-feature-matching" class="nav-link" data-scroll-target="#the-magic-behind-feature-matching"><span class="header-section-number">0.10</span> The Magic Behind Feature Matching</a>
  <ul class="collapse">
  <li><a href="#scale-invariance" id="toc-scale-invariance" class="nav-link" data-scroll-target="#scale-invariance"><span class="header-section-number">0.10.1</span> 1. <strong>Scale Invariance</strong></a></li>
  <li><a href="#rotation-invariance" id="toc-rotation-invariance" class="nav-link" data-scroll-target="#rotation-invariance"><span class="header-section-number">0.10.2</span> 2. <strong>Rotation Invariance</strong></a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">0.11</span> Key Takeaways</a></li>
  <li><a href="#whats-coming-next" id="toc-whats-coming-next" class="nav-link" data-scroll-target="#whats-coming-next"><span class="header-section-number">0.12</span> What’s Coming Next?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/cv-foundations/feature-magic-header.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Feature detection visualization - geometric shapes with clear keypoints for detection</figcaption>
</figure>
</div>
<section id="the-puzzle-piece-problem" class="level2" data-number="0.1">
<h2 data-number="0.1" class="anchored" data-anchor-id="the-puzzle-piece-problem"><span class="header-section-number">0.1</span> The Puzzle Piece Problem</h2>
<p>Imagine you’re doing a 1000-piece jigsaw puzzle. How do you know which pieces fit together? You look for <strong>unique features</strong>—distinctive colors, patterns, corners, and edges that help you match pieces.</p>
<p>Computer vision faces the same challenge: How do we find the same object in different photos? The answer lies in <strong>feature detection</strong>—finding unique, recognizable points that remain consistent even when the image changes.</p>
<p>Today, we’ll unlock this superpower and teach computers to recognize objects across different photos, lighting conditions, and viewing angles!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Try it yourself!</strong> Open this <a href="https://colab.research.google.com/github/hasanpasha/quarto_blog_hasan/blob/main/notebooks/cv-foundations-05-feature-magic.ipynb">interactive Colab notebook</a> to experiment with feature detection and matching as we build this tutorial.</p>
</div>
</div>
</section>
<section id="what-are-features" class="level2" data-number="0.2">
<h2 data-number="0.2" class="anchored" data-anchor-id="what-are-features"><span class="header-section-number">0.2</span> What Are Features?</h2>
<p><strong>Features</strong> are distinctive points in an image that are: - <strong>Unique</strong>: Stand out from their surroundings - <strong>Repeatable</strong>: Can be found again in different images - <strong>Stable</strong>: Don’t change much with lighting or viewpoint - <strong>Informative</strong>: Carry enough information for matching</p>
<p>Think of features as the “fingerprints” of an image!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/architecture-features.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Architectural features perfect for detection</figcaption>
</figure>
</div>
<p>In this architectural image, features would be detected at: - <strong>Window corners</strong> where frames meet - <strong>Building edges</strong> and wall boundaries<br>
- <strong>Grid patterns</strong> of repeated windows - <strong>High-contrast regions</strong> between frames and glass</p>
</section>
<section id="your-first-feature-detector-sift" class="level2" data-number="0.3">
<h2 data-number="0.3" class="anchored" data-anchor-id="your-first-feature-detector-sift"><span class="header-section-number">0.3</span> Your First Feature Detector: SIFT</h2>
<p><strong>SIFT</strong> (Scale-Invariant Feature Transform) is like having a super-detective that can find the same clues even if they’re rotated, scaled, or slightly changed:</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> cv2</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> requests</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">from</span> io <span class="im">import</span> BytesIO</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># Load a sample image with clear features (architectural scene)</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">def</span> load_image_from_url(url):</span>
<span id="cb1-10"><a href="#cb1-10"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb1-11"><a href="#cb1-11"></a>    img <span class="op">=</span> Image.<span class="bu">open</span>(BytesIO(response.content))</span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="cf">return</span> cv2.cvtColor(np.array(img), cv2.COLOR_RGB2BGR)</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co"># Load our synthetic architectural image with clear features</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>img <span class="op">=</span> cv2.imread(<span class="st">'images/architecture-features.jpg'</span>)</span>
<span id="cb1-16"><a href="#cb1-16"></a>img_rgb <span class="op">=</span> cv2.cvtColor(img, cv2.COLOR_BGR2RGB)</span>
<span id="cb1-17"><a href="#cb1-17"></a>gray <span class="op">=</span> cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co"># Create SIFT detector</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>sift <span class="op">=</span> cv2.SIFT_create()</span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co"># Find keypoints and descriptors</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>keypoints, descriptors <span class="op">=</span> sift.detectAndCompute(gray, <span class="va">None</span>)</span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="bu">print</span>(<span class="ss">f"SIFT found </span><span class="sc">{</span><span class="bu">len</span>(keypoints)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="bu">print</span>(<span class="ss">f"Each keypoint has a </span><span class="sc">{</span>descriptors<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">-dimensional descriptor"</span>)</span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co"># Draw keypoints</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>img_with_keypoints <span class="op">=</span> cv2.drawKeypoints(</span>
<span id="cb1-30"><a href="#cb1-30"></a>    img_rgb, keypoints, <span class="va">None</span>, </span>
<span id="cb1-31"><a href="#cb1-31"></a>    flags<span class="op">=</span>cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS</span>
<span id="cb1-32"><a href="#cb1-32"></a>)</span>
<span id="cb1-33"><a href="#cb1-33"></a></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="co"># Display results</span></span>
<span id="cb1-35"><a href="#cb1-35"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">8</span>))</span>
<span id="cb1-36"><a href="#cb1-36"></a></span>
<span id="cb1-37"><a href="#cb1-37"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1-38"><a href="#cb1-38"></a>plt.imshow(img_rgb)</span>
<span id="cb1-39"><a href="#cb1-39"></a>plt.title(<span class="st">"Original Image"</span>)</span>
<span id="cb1-40"><a href="#cb1-40"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb1-41"><a href="#cb1-41"></a></span>
<span id="cb1-42"><a href="#cb1-42"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb1-43"><a href="#cb1-43"></a>plt.imshow(img_with_keypoints)</span>
<span id="cb1-44"><a href="#cb1-44"></a>plt.title(<span class="ss">f"SIFT Keypoints: </span><span class="sc">{</span><span class="bu">len</span>(keypoints)<span class="sc">}</span><span class="ss"> detected"</span>)</span>
<span id="cb1-45"><a href="#cb1-45"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb1-46"><a href="#cb1-46"></a></span>
<span id="cb1-47"><a href="#cb1-47"></a>plt.tight_layout()</span>
<span id="cb1-48"><a href="#cb1-48"></a>plt.show()</span>
<span id="cb1-49"><a href="#cb1-49"></a></span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="co"># Show some keypoint properties</span></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">First 5 keypoints properties:"</span>)</span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="cf">for</span> i, kp <span class="kw">in</span> <span class="bu">enumerate</span>(keypoints[:<span class="dv">5</span>]):</span>
<span id="cb1-53"><a href="#cb1-53"></a>    <span class="bu">print</span>(<span class="ss">f"Keypoint </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: position=(</span><span class="sc">{</span>kp<span class="sc">.</span>pt[<span class="dv">0</span>]<span class="sc">:.1f}</span><span class="ss">, </span><span class="sc">{</span>kp<span class="sc">.</span>pt[<span class="dv">1</span>]<span class="sc">:.1f}</span><span class="ss">), "</span></span>
<span id="cb1-54"><a href="#cb1-54"></a>          <span class="ss">f"size=</span><span class="sc">{</span>kp<span class="sc">.</span>size<span class="sc">:.1f}</span><span class="ss">, angle=</span><span class="sc">{</span>kp<span class="sc">.</span>angle<span class="sc">:.1f}</span><span class="ss">°"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>SIFT found 908 keypoints
Each keypoint has a 128-dimensional descriptor

First 5 keypoints properties:
Keypoint 1: position=(81.9, 150.3), size=5.4, angle=101.4°
Keypoint 2: position=(81.9, 150.3), size=5.4, angle=257.9°
Keypoint 3: position=(99.7, 153.4), size=21.1, angle=174.5°
Keypoint 4: position=(99.7, 153.4), size=21.1, angle=278.9°
Keypoint 5: position=(100.9, 548.0), size=18.1, angle=175.7°</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="06-feature-magic_files/figure-html/cell-2-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>🎯 Amazing!</strong> Each green circle represents a detected feature. The size shows the scale, and the line shows the orientation.</p>
</section>
<section id="the-faster-alternative-orb" class="level2" data-number="0.4">
<h2 data-number="0.4" class="anchored" data-anchor-id="the-faster-alternative-orb"><span class="header-section-number">0.4</span> The Faster Alternative: ORB</h2>
<p><strong>ORB</strong> (Oriented FAST and Rotated BRIEF) is like SIFT’s speedy cousin—faster and free to use in commercial applications:</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Create ORB detector</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>orb <span class="op">=</span> cv2.ORB_create()</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># Find keypoints and descriptors</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>orb_kp, orb_desc <span class="op">=</span> orb.detectAndCompute(gray, <span class="va">None</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="bu">print</span>(<span class="ss">f"ORB found </span><span class="sc">{</span><span class="bu">len</span>(orb_kp)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="bu">print</span>(<span class="ss">f"Each keypoint has a </span><span class="sc">{</span>orb_desc<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="op">*</span><span class="dv">8</span><span class="sc">}</span><span class="ss">-bit binary descriptor"</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co"># Draw ORB keypoints</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>img_orb <span class="op">=</span> cv2.drawKeypoints(img_rgb, orb_kp, <span class="va">None</span>, color<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>), flags<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co"># Compare SIFT vs ORB</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb3-15"><a href="#cb3-15"></a></span>
<span id="cb3-16"><a href="#cb3-16"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb3-17"><a href="#cb3-17"></a>plt.imshow(img_with_keypoints)</span>
<span id="cb3-18"><a href="#cb3-18"></a>plt.title(<span class="ss">f"SIFT: </span><span class="sc">{</span><span class="bu">len</span>(keypoints)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb3-19"><a href="#cb3-19"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb3-20"><a href="#cb3-20"></a></span>
<span id="cb3-21"><a href="#cb3-21"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb3-22"><a href="#cb3-22"></a>plt.imshow(img_orb)</span>
<span id="cb3-23"><a href="#cb3-23"></a>plt.title(<span class="ss">f"ORB: </span><span class="sc">{</span><span class="bu">len</span>(orb_kp)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb3-24"><a href="#cb3-24"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co"># Show descriptor differences</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb3-28"><a href="#cb3-28"></a>plt.plot(descriptors[<span class="dv">0</span>])</span>
<span id="cb3-29"><a href="#cb3-29"></a>plt.title(<span class="st">"SIFT Descriptor (128 values)"</span>)</span>
<span id="cb3-30"><a href="#cb3-30"></a>plt.xlabel(<span class="st">"Dimension"</span>)</span>
<span id="cb3-31"><a href="#cb3-31"></a>plt.ylabel(<span class="st">"Value"</span>)</span>
<span id="cb3-32"><a href="#cb3-32"></a></span>
<span id="cb3-33"><a href="#cb3-33"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb3-34"><a href="#cb3-34"></a>plt.plot(orb_desc[<span class="dv">0</span>])</span>
<span id="cb3-35"><a href="#cb3-35"></a>plt.title(<span class="st">"ORB Descriptor (32 bytes)"</span>)</span>
<span id="cb3-36"><a href="#cb3-36"></a>plt.xlabel(<span class="st">"Byte"</span>)</span>
<span id="cb3-37"><a href="#cb3-37"></a>plt.ylabel(<span class="st">"Value"</span>)</span>
<span id="cb3-38"><a href="#cb3-38"></a></span>
<span id="cb3-39"><a href="#cb3-39"></a>plt.tight_layout()</span>
<span id="cb3-40"><a href="#cb3-40"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ORB found 500 keypoints
Each keypoint has a 256-bit binary descriptor</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="06-feature-magic_files/figure-html/cell-3-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Key Differences:</strong> - <strong>SIFT</strong>: More accurate, 128-dimensional float descriptors - <strong>ORB</strong>: Faster, 256-bit binary descriptors, patent-free</p>
</section>
<section id="feature-matching-finding-connections" class="level2" data-number="0.5">
<h2 data-number="0.5" class="anchored" data-anchor-id="feature-matching-finding-connections"><span class="header-section-number">0.5</span> Feature Matching: Finding Connections</h2>
<p>Now comes the exciting part—matching features between images to find the same objects or scenes:</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Load a second image (different architectural pattern for matching)</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>img2 <span class="op">=</span> cv2.imread(<span class="st">'images/architecture-features-2.jpg'</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a>img2_rgb <span class="op">=</span> cv2.cvtColor(img2, cv2.COLOR_BGR2RGB)</span>
<span id="cb5-4"><a href="#cb5-4"></a>gray2 <span class="op">=</span> cv2.cvtColor(img2, cv2.COLOR_BGR2GRAY)</span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># Detect features in both images</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>kp1, desc1 <span class="op">=</span> sift.detectAndCompute(gray, <span class="va">None</span>)</span>
<span id="cb5-8"><a href="#cb5-8"></a>kp2, desc2 <span class="op">=</span> sift.detectAndCompute(gray2, <span class="va">None</span>)</span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="kw">def</span> match_features(desc1, desc2, ratio_threshold<span class="op">=</span><span class="fl">0.7</span>):</span>
<span id="cb5-11"><a href="#cb5-11"></a>    <span class="co">"""Match features using Lowe's ratio test"""</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>    </span>
<span id="cb5-13"><a href="#cb5-13"></a>    <span class="co"># Brute Force matcher</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>    bf <span class="op">=</span> cv2.BFMatcher()</span>
<span id="cb5-15"><a href="#cb5-15"></a>    matches <span class="op">=</span> bf.knnMatch(desc1, desc2, k<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-16"><a href="#cb5-16"></a>    </span>
<span id="cb5-17"><a href="#cb5-17"></a>    <span class="co"># Apply Lowe's ratio test to filter good matches</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>    good_matches <span class="op">=</span> []</span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="cf">for</span> match_pair <span class="kw">in</span> matches:</span>
<span id="cb5-20"><a href="#cb5-20"></a>        <span class="cf">if</span> <span class="bu">len</span>(match_pair) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb5-21"><a href="#cb5-21"></a>            m, n <span class="op">=</span> match_pair</span>
<span id="cb5-22"><a href="#cb5-22"></a>            <span class="cf">if</span> m.distance <span class="op">&lt;</span> ratio_threshold <span class="op">*</span> n.distance:</span>
<span id="cb5-23"><a href="#cb5-23"></a>                good_matches.append(m)</span>
<span id="cb5-24"><a href="#cb5-24"></a>    </span>
<span id="cb5-25"><a href="#cb5-25"></a>    <span class="cf">return</span> good_matches</span>
<span id="cb5-26"><a href="#cb5-26"></a></span>
<span id="cb5-27"><a href="#cb5-27"></a><span class="co"># Match SIFT features</span></span>
<span id="cb5-28"><a href="#cb5-28"></a>good_matches <span class="op">=</span> match_features(desc1, desc2)</span>
<span id="cb5-29"><a href="#cb5-29"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(good_matches)<span class="sc">}</span><span class="ss"> good matches out of </span><span class="sc">{</span><span class="bu">len</span>(kp1)<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span><span class="bu">len</span>(kp2)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb5-30"><a href="#cb5-30"></a></span>
<span id="cb5-31"><a href="#cb5-31"></a><span class="co"># Draw matches</span></span>
<span id="cb5-32"><a href="#cb5-32"></a>matched_img <span class="op">=</span> cv2.drawMatches(</span>
<span id="cb5-33"><a href="#cb5-33"></a>    img_rgb, kp1,</span>
<span id="cb5-34"><a href="#cb5-34"></a>    img2_rgb, kp2,</span>
<span id="cb5-35"><a href="#cb5-35"></a>    good_matches[:<span class="dv">50</span>], <span class="va">None</span>,  <span class="co"># Show top 50 matches</span></span>
<span id="cb5-36"><a href="#cb5-36"></a>    flags<span class="op">=</span>cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS</span>
<span id="cb5-37"><a href="#cb5-37"></a>)</span>
<span id="cb5-38"><a href="#cb5-38"></a></span>
<span id="cb5-39"><a href="#cb5-39"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb5-40"><a href="#cb5-40"></a>plt.imshow(matched_img)</span>
<span id="cb5-41"><a href="#cb5-41"></a>plt.title(<span class="ss">f"Feature Matching: </span><span class="sc">{</span><span class="bu">len</span>(good_matches)<span class="sc">}</span><span class="ss"> matches found"</span>)</span>
<span id="cb5-42"><a href="#cb5-42"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb5-43"><a href="#cb5-43"></a>plt.show()</span>
<span id="cb5-44"><a href="#cb5-44"></a></span>
<span id="cb5-45"><a href="#cb5-45"></a><span class="co"># Show match quality statistics</span></span>
<span id="cb5-46"><a href="#cb5-46"></a>distances <span class="op">=</span> [m.distance <span class="cf">for</span> m <span class="kw">in</span> good_matches]</span>
<span id="cb5-47"><a href="#cb5-47"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Match quality statistics:"</span>)</span>
<span id="cb5-48"><a href="#cb5-48"></a><span class="bu">print</span>(<span class="ss">f"Average distance: </span><span class="sc">{</span>np<span class="sc">.</span>mean(distances)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb5-49"><a href="#cb5-49"></a><span class="co">#print(f"Min distance: {np.min(distances):.2f}")</span></span>
<span id="cb5-50"><a href="#cb5-50"></a><span class="co">#print(f"Max distance: {np.max(distances):.2f}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Found 0 good matches out of 908 and 466 keypoints

Match quality statistics:
Average distance: nan</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="06-feature-magic_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>🔥 Incredible!</strong> Each line connects matching features between the two images. The shorter the line, the better the match!</p>
</section>
<section id="understanding-feature-descriptors" class="level2" data-number="0.6">
<h2 data-number="0.6" class="anchored" data-anchor-id="understanding-feature-descriptors"><span class="header-section-number">0.6</span> Understanding Feature Descriptors</h2>
<p>Each keypoint comes with a <strong>descriptor</strong>—a numerical “fingerprint” that describes the local area around that point:</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">def</span> visualize_feature_patches(image, keypoints, num_features<span class="op">=</span><span class="dv">6</span>):</span>
<span id="cb7-2"><a href="#cb7-2"></a>    <span class="co">"""Visualize patches around keypoints"""</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>    </span>
<span id="cb7-4"><a href="#cb7-4"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb7-5"><a href="#cb7-5"></a>    </span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(num_features, <span class="bu">len</span>(keypoints))):</span>
<span id="cb7-7"><a href="#cb7-7"></a>        kp <span class="op">=</span> keypoints[i]</span>
<span id="cb7-8"><a href="#cb7-8"></a>        </span>
<span id="cb7-9"><a href="#cb7-9"></a>        <span class="co"># Extract patch around keypoint</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>        x, y <span class="op">=</span> <span class="bu">int</span>(kp.pt[<span class="dv">0</span>]), <span class="bu">int</span>(kp.pt[<span class="dv">1</span>])</span>
<span id="cb7-11"><a href="#cb7-11"></a>        size <span class="op">=</span> <span class="bu">max</span>(<span class="bu">int</span>(kp.size), <span class="dv">20</span>)  <span class="co"># Minimum patch size</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>        </span>
<span id="cb7-13"><a href="#cb7-13"></a>        <span class="co"># Make sure we don't go out of bounds</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>        x1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, x <span class="op">-</span> size<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb7-15"><a href="#cb7-15"></a>        y1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, y <span class="op">-</span> size<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb7-16"><a href="#cb7-16"></a>        x2 <span class="op">=</span> <span class="bu">min</span>(image.shape[<span class="dv">1</span>], x <span class="op">+</span> size<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb7-17"><a href="#cb7-17"></a>        y2 <span class="op">=</span> <span class="bu">min</span>(image.shape[<span class="dv">0</span>], y <span class="op">+</span> size<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb7-18"><a href="#cb7-18"></a>        </span>
<span id="cb7-19"><a href="#cb7-19"></a>        <span class="cf">if</span> x2 <span class="op">&gt;</span> x1 <span class="kw">and</span> y2 <span class="op">&gt;</span> y1:  <span class="co"># Valid patch</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>            patch <span class="op">=</span> image[y1:y2, x1:x2]</span>
<span id="cb7-21"><a href="#cb7-21"></a>            </span>
<span id="cb7-22"><a href="#cb7-22"></a>            <span class="co"># Plot patch</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>            plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb7-24"><a href="#cb7-24"></a>            <span class="cf">if</span> <span class="bu">len</span>(patch.shape) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb7-25"><a href="#cb7-25"></a>                plt.imshow(patch)</span>
<span id="cb7-26"><a href="#cb7-26"></a>            <span class="cf">else</span>:</span>
<span id="cb7-27"><a href="#cb7-27"></a>                plt.imshow(patch, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb7-28"><a href="#cb7-28"></a>            plt.title(<span class="ss">f"Keypoint </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">Size: </span><span class="sc">{</span>kp<span class="sc">.</span>size<span class="sc">:.1f}</span><span class="ss">, Angle: </span><span class="sc">{</span>kp<span class="sc">.</span>angle<span class="sc">:.1f}</span><span class="ss">°"</span>)</span>
<span id="cb7-29"><a href="#cb7-29"></a>            plt.axis(<span class="st">'off'</span>)</span>
<span id="cb7-30"><a href="#cb7-30"></a>            </span>
<span id="cb7-31"><a href="#cb7-31"></a>            <span class="co"># Draw keypoint center</span></span>
<span id="cb7-32"><a href="#cb7-32"></a>            center_x <span class="op">=</span> (x <span class="op">-</span> x1)</span>
<span id="cb7-33"><a href="#cb7-33"></a>            center_y <span class="op">=</span> (y <span class="op">-</span> y1)</span>
<span id="cb7-34"><a href="#cb7-34"></a>            plt.plot(center_x, center_y, <span class="st">'r+'</span>, markersize<span class="op">=</span><span class="dv">10</span>, markeredgewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-35"><a href="#cb7-35"></a>    </span>
<span id="cb7-36"><a href="#cb7-36"></a>    plt.tight_layout()</span>
<span id="cb7-37"><a href="#cb7-37"></a>    plt.show()</span>
<span id="cb7-38"><a href="#cb7-38"></a></span>
<span id="cb7-39"><a href="#cb7-39"></a><span class="co"># Visualize some feature patches</span></span>
<span id="cb7-40"><a href="#cb7-40"></a><span class="bu">print</span>(<span class="st">"Here's what SIFT 'sees' around each keypoint:"</span>)</span>
<span id="cb7-41"><a href="#cb7-41"></a>visualize_feature_patches(img_rgb, keypoints)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Here's what SIFT 'sees' around each keypoint:</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="06-feature-magic_files/figure-html/cell-5-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>💡 Insight</strong>: Each red cross marks the exact keypoint location. SIFT analyzes the gradient patterns in these patches to create unique descriptors.</p>
</section>
<section id="real-world-application-object-recognition" class="level2" data-number="0.7">
<h2 data-number="0.7" class="anchored" data-anchor-id="real-world-application-object-recognition"><span class="header-section-number">0.7</span> Real-World Application: Object Recognition</h2>
<p>Let’s build a simple object recognition system using feature matching:</p>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">class</span> SimpleObjectRecognizer:</span>
<span id="cb9-2"><a href="#cb9-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, detector_type<span class="op">=</span><span class="st">'ORB'</span>):</span>
<span id="cb9-3"><a href="#cb9-3"></a>        <span class="cf">if</span> detector_type <span class="op">==</span> <span class="st">'ORB'</span>:</span>
<span id="cb9-4"><a href="#cb9-4"></a>            <span class="va">self</span>.detector <span class="op">=</span> cv2.ORB_create()</span>
<span id="cb9-5"><a href="#cb9-5"></a>            <span class="va">self</span>.matcher <span class="op">=</span> cv2.BFMatcher(cv2.NORM_HAMMING, crossCheck<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-6"><a href="#cb9-6"></a>        <span class="cf">else</span>:  <span class="co"># SIFT</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>            <span class="va">self</span>.detector <span class="op">=</span> cv2.SIFT_create()</span>
<span id="cb9-8"><a href="#cb9-8"></a>            <span class="va">self</span>.matcher <span class="op">=</span> cv2.BFMatcher()</span>
<span id="cb9-9"><a href="#cb9-9"></a>        </span>
<span id="cb9-10"><a href="#cb9-10"></a>        <span class="va">self</span>.detector_type <span class="op">=</span> detector_type</span>
<span id="cb9-11"><a href="#cb9-11"></a>        <span class="va">self</span>.reference_objects <span class="op">=</span> {}</span>
<span id="cb9-12"><a href="#cb9-12"></a>    </span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="kw">def</span> add_reference_object(<span class="va">self</span>, name, image):</span>
<span id="cb9-14"><a href="#cb9-14"></a>        <span class="co">"""Add a reference object to recognize"""</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>        <span class="cf">if</span> <span class="bu">len</span>(image.shape) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb9-16"><a href="#cb9-16"></a>            gray <span class="op">=</span> cv2.cvtColor(image, cv2.COLOR_RGB2GRAY)</span>
<span id="cb9-17"><a href="#cb9-17"></a>        <span class="cf">else</span>:</span>
<span id="cb9-18"><a href="#cb9-18"></a>            gray <span class="op">=</span> image</span>
<span id="cb9-19"><a href="#cb9-19"></a>            </span>
<span id="cb9-20"><a href="#cb9-20"></a>        keypoints, descriptors <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(gray, <span class="va">None</span>)</span>
<span id="cb9-21"><a href="#cb9-21"></a>        </span>
<span id="cb9-22"><a href="#cb9-22"></a>        <span class="cf">if</span> descriptors <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb9-23"><a href="#cb9-23"></a>            <span class="va">self</span>.reference_objects[name] <span class="op">=</span> {</span>
<span id="cb9-24"><a href="#cb9-24"></a>                <span class="st">'keypoints'</span>: keypoints,</span>
<span id="cb9-25"><a href="#cb9-25"></a>                <span class="st">'descriptors'</span>: descriptors,</span>
<span id="cb9-26"><a href="#cb9-26"></a>                <span class="st">'image'</span>: image</span>
<span id="cb9-27"><a href="#cb9-27"></a>            }</span>
<span id="cb9-28"><a href="#cb9-28"></a>            <span class="bu">print</span>(<span class="ss">f"Added '</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">' with </span><span class="sc">{</span><span class="bu">len</span>(keypoints)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb9-29"><a href="#cb9-29"></a>        <span class="cf">else</span>:</span>
<span id="cb9-30"><a href="#cb9-30"></a>            <span class="bu">print</span>(<span class="ss">f"No features found in '</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb9-31"><a href="#cb9-31"></a>    </span>
<span id="cb9-32"><a href="#cb9-32"></a>    <span class="kw">def</span> recognize_objects(<span class="va">self</span>, scene_image, min_matches<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb9-33"><a href="#cb9-33"></a>        <span class="co">"""Find reference objects in a scene"""</span></span>
<span id="cb9-34"><a href="#cb9-34"></a>        <span class="cf">if</span> <span class="bu">len</span>(scene_image.shape) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb9-35"><a href="#cb9-35"></a>            scene_gray <span class="op">=</span> cv2.cvtColor(scene_image, cv2.COLOR_RGB2GRAY)</span>
<span id="cb9-36"><a href="#cb9-36"></a>        <span class="cf">else</span>:</span>
<span id="cb9-37"><a href="#cb9-37"></a>            scene_gray <span class="op">=</span> scene_image</span>
<span id="cb9-38"><a href="#cb9-38"></a>            </span>
<span id="cb9-39"><a href="#cb9-39"></a>        scene_kp, scene_desc <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(scene_gray, <span class="va">None</span>)</span>
<span id="cb9-40"><a href="#cb9-40"></a>        </span>
<span id="cb9-41"><a href="#cb9-41"></a>        <span class="cf">if</span> scene_desc <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb9-42"><a href="#cb9-42"></a>            <span class="cf">return</span> []</span>
<span id="cb9-43"><a href="#cb9-43"></a>        </span>
<span id="cb9-44"><a href="#cb9-44"></a>        results <span class="op">=</span> []</span>
<span id="cb9-45"><a href="#cb9-45"></a>        </span>
<span id="cb9-46"><a href="#cb9-46"></a>        <span class="cf">for</span> obj_name, obj_data <span class="kw">in</span> <span class="va">self</span>.reference_objects.items():</span>
<span id="cb9-47"><a href="#cb9-47"></a>            <span class="co"># Match features</span></span>
<span id="cb9-48"><a href="#cb9-48"></a>            <span class="cf">if</span> <span class="va">self</span>.detector_type <span class="op">==</span> <span class="st">'ORB'</span>:</span>
<span id="cb9-49"><a href="#cb9-49"></a>                matches <span class="op">=</span> <span class="va">self</span>.matcher.match(obj_data[<span class="st">'descriptors'</span>], scene_desc)</span>
<span id="cb9-50"><a href="#cb9-50"></a>                matches <span class="op">=</span> <span class="bu">sorted</span>(matches, key<span class="op">=</span><span class="kw">lambda</span> x: x.distance)</span>
<span id="cb9-51"><a href="#cb9-51"></a>                good_matches <span class="op">=</span> matches[:<span class="bu">min</span>(<span class="dv">50</span>, <span class="bu">len</span>(matches))]</span>
<span id="cb9-52"><a href="#cb9-52"></a>            <span class="cf">else</span>:  <span class="co"># SIFT with ratio test</span></span>
<span id="cb9-53"><a href="#cb9-53"></a>                matches <span class="op">=</span> <span class="va">self</span>.matcher.knnMatch(obj_data[<span class="st">'descriptors'</span>], scene_desc, k<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb9-54"><a href="#cb9-54"></a>                good_matches <span class="op">=</span> []</span>
<span id="cb9-55"><a href="#cb9-55"></a>                <span class="cf">for</span> match_pair <span class="kw">in</span> matches:</span>
<span id="cb9-56"><a href="#cb9-56"></a>                    <span class="cf">if</span> <span class="bu">len</span>(match_pair) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb9-57"><a href="#cb9-57"></a>                        m, n <span class="op">=</span> match_pair</span>
<span id="cb9-58"><a href="#cb9-58"></a>                        <span class="cf">if</span> m.distance <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">*</span> n.distance:</span>
<span id="cb9-59"><a href="#cb9-59"></a>                            good_matches.append(m)</span>
<span id="cb9-60"><a href="#cb9-60"></a>            </span>
<span id="cb9-61"><a href="#cb9-61"></a>            <span class="cf">if</span> <span class="bu">len</span>(good_matches) <span class="op">&gt;=</span> min_matches:</span>
<span id="cb9-62"><a href="#cb9-62"></a>                confidence <span class="op">=</span> min_matches <span class="op">/</span> <span class="bu">len</span>(good_matches) <span class="cf">if</span> <span class="bu">len</span>(good_matches) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb9-63"><a href="#cb9-63"></a>                results.append({</span>
<span id="cb9-64"><a href="#cb9-64"></a>                    <span class="st">'name'</span>: obj_name,</span>
<span id="cb9-65"><a href="#cb9-65"></a>                    <span class="st">'matches'</span>: <span class="bu">len</span>(good_matches),</span>
<span id="cb9-66"><a href="#cb9-66"></a>                    <span class="st">'confidence'</span>: confidence,</span>
<span id="cb9-67"><a href="#cb9-67"></a>                    <span class="st">'good_matches'</span>: good_matches,</span>
<span id="cb9-68"><a href="#cb9-68"></a>                    <span class="st">'scene_keypoints'</span>: scene_kp,</span>
<span id="cb9-69"><a href="#cb9-69"></a>                    <span class="st">'obj_keypoints'</span>: obj_data[<span class="st">'keypoints'</span>]</span>
<span id="cb9-70"><a href="#cb9-70"></a>                })</span>
<span id="cb9-71"><a href="#cb9-71"></a>        </span>
<span id="cb9-72"><a href="#cb9-72"></a>        <span class="cf">return</span> <span class="bu">sorted</span>(results, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'matches'</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-73"><a href="#cb9-73"></a></span>
<span id="cb9-74"><a href="#cb9-74"></a><span class="co"># Example usage with architectural features</span></span>
<span id="cb9-75"><a href="#cb9-75"></a>recognizer <span class="op">=</span> SimpleObjectRecognizer(<span class="st">'SIFT'</span>)</span>
<span id="cb9-76"><a href="#cb9-76"></a></span>
<span id="cb9-77"><a href="#cb9-77"></a><span class="co"># Add reference objects (crop distinctive parts of images)</span></span>
<span id="cb9-78"><a href="#cb9-78"></a><span class="co"># For demo, we'll use the same image as reference</span></span>
<span id="cb9-79"><a href="#cb9-79"></a>reference_crop <span class="op">=</span> img_rgb[<span class="dv">100</span>:<span class="dv">400</span>, <span class="dv">200</span>:<span class="dv">500</span>]  <span class="co"># Crop a distinctive building section</span></span>
<span id="cb9-80"><a href="#cb9-80"></a>recognizer.add_reference_object(<span class="st">"Building Section"</span>, reference_crop)</span>
<span id="cb9-81"><a href="#cb9-81"></a></span>
<span id="cb9-82"><a href="#cb9-82"></a><span class="co"># Try to find it in a scene</span></span>
<span id="cb9-83"><a href="#cb9-83"></a>recognition_results <span class="op">=</span> recognizer.recognize_objects(img2_rgb, min_matches<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb9-84"><a href="#cb9-84"></a></span>
<span id="cb9-85"><a href="#cb9-85"></a><span class="cf">if</span> recognition_results:</span>
<span id="cb9-86"><a href="#cb9-86"></a>    result <span class="op">=</span> recognition_results[<span class="dv">0</span>]</span>
<span id="cb9-87"><a href="#cb9-87"></a>    </span>
<span id="cb9-88"><a href="#cb9-88"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">8</span>))</span>
<span id="cb9-89"><a href="#cb9-89"></a>    </span>
<span id="cb9-90"><a href="#cb9-90"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb9-91"><a href="#cb9-91"></a>    plt.imshow(reference_crop)</span>
<span id="cb9-92"><a href="#cb9-92"></a>    plt.title(<span class="st">"Reference Object"</span>)</span>
<span id="cb9-93"><a href="#cb9-93"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb9-94"><a href="#cb9-94"></a>    </span>
<span id="cb9-95"><a href="#cb9-95"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb9-96"><a href="#cb9-96"></a>    plt.imshow(img2_rgb)</span>
<span id="cb9-97"><a href="#cb9-97"></a>    plt.title(<span class="ss">f"Scene - Found </span><span class="sc">{</span>result[<span class="st">'matches'</span>]<span class="sc">}</span><span class="ss"> matches"</span>)</span>
<span id="cb9-98"><a href="#cb9-98"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb9-99"><a href="#cb9-99"></a>    </span>
<span id="cb9-100"><a href="#cb9-100"></a>    plt.tight_layout()</span>
<span id="cb9-101"><a href="#cb9-101"></a>    plt.show()</span>
<span id="cb9-102"><a href="#cb9-102"></a>    </span>
<span id="cb9-103"><a href="#cb9-103"></a>    <span class="bu">print</span>(<span class="ss">f"Recognition Results:"</span>)</span>
<span id="cb9-104"><a href="#cb9-104"></a>    <span class="cf">for</span> result <span class="kw">in</span> recognition_results:</span>
<span id="cb9-105"><a href="#cb9-105"></a>        <span class="bu">print</span>(<span class="ss">f"- Found '</span><span class="sc">{</span>result[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">' with </span><span class="sc">{</span>result[<span class="st">'matches'</span>]<span class="sc">}</span><span class="ss"> matches"</span>)</span>
<span id="cb9-106"><a href="#cb9-106"></a><span class="cf">else</span>:</span>
<span id="cb9-107"><a href="#cb9-107"></a>    <span class="bu">print</span>(<span class="st">"No objects recognized in the scene"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Added 'Building Section' with 295 keypoints
No objects recognized in the scene</code></pre>
</div>
</div>
</section>
<section id="feature-detection-comparison" class="level2" data-number="0.8">
<h2 data-number="0.8" class="anchored" data-anchor-id="feature-detection-comparison"><span class="header-section-number">0.8</span> Feature Detection Comparison</h2>
<p>Let’s compare different feature detectors to understand their strengths:</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">def</span> compare_feature_detectors(image):</span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="co">"""Compare different feature detection algorithms"""</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="cf">if</span> <span class="bu">len</span>(image.shape) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb11-4"><a href="#cb11-4"></a>        gray <span class="op">=</span> cv2.cvtColor(image, cv2.COLOR_RGB2GRAY)</span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="cf">else</span>:</span>
<span id="cb11-6"><a href="#cb11-6"></a>        gray <span class="op">=</span> image</span>
<span id="cb11-7"><a href="#cb11-7"></a>    </span>
<span id="cb11-8"><a href="#cb11-8"></a>    <span class="co"># Different detectors</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>    detectors <span class="op">=</span> {</span>
<span id="cb11-10"><a href="#cb11-10"></a>        <span class="st">'SIFT'</span>: cv2.SIFT_create(),</span>
<span id="cb11-11"><a href="#cb11-11"></a>        <span class="st">'ORB'</span>: cv2.ORB_create(),</span>
<span id="cb11-12"><a href="#cb11-12"></a>        <span class="st">'FAST'</span>: cv2.FastFeatureDetector_create(),</span>
<span id="cb11-13"><a href="#cb11-13"></a>        <span class="st">'BRISK'</span>: cv2.BRISK_create()</span>
<span id="cb11-14"><a href="#cb11-14"></a>    }</span>
<span id="cb11-15"><a href="#cb11-15"></a>    </span>
<span id="cb11-16"><a href="#cb11-16"></a>    results <span class="op">=</span> {}</span>
<span id="cb11-17"><a href="#cb11-17"></a>    </span>
<span id="cb11-18"><a href="#cb11-18"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">15</span>))</span>
<span id="cb11-19"><a href="#cb11-19"></a>    </span>
<span id="cb11-20"><a href="#cb11-20"></a>    <span class="cf">for</span> i, (name, detector) <span class="kw">in</span> <span class="bu">enumerate</span>(detectors.items()):</span>
<span id="cb11-21"><a href="#cb11-21"></a>        <span class="co"># Detect keypoints</span></span>
<span id="cb11-22"><a href="#cb11-22"></a>        <span class="cf">if</span> name <span class="kw">in</span> [<span class="st">'SIFT'</span>, <span class="st">'ORB'</span>, <span class="st">'BRISK'</span>]:</span>
<span id="cb11-23"><a href="#cb11-23"></a>            keypoints, descriptors <span class="op">=</span> detector.detectAndCompute(gray, <span class="va">None</span>)</span>
<span id="cb11-24"><a href="#cb11-24"></a>        <span class="cf">else</span>:  <span class="co"># FAST doesn't compute descriptors</span></span>
<span id="cb11-25"><a href="#cb11-25"></a>            keypoints <span class="op">=</span> detector.detect(gray, <span class="va">None</span>)</span>
<span id="cb11-26"><a href="#cb11-26"></a>            descriptors <span class="op">=</span> <span class="va">None</span></span>
<span id="cb11-27"><a href="#cb11-27"></a>        </span>
<span id="cb11-28"><a href="#cb11-28"></a>        <span class="co"># Draw keypoints</span></span>
<span id="cb11-29"><a href="#cb11-29"></a>        img_with_kp <span class="op">=</span> cv2.drawKeypoints(image, keypoints, <span class="va">None</span>, color<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>))</span>
<span id="cb11-30"><a href="#cb11-30"></a>        </span>
<span id="cb11-31"><a href="#cb11-31"></a>        <span class="co"># Store results</span></span>
<span id="cb11-32"><a href="#cb11-32"></a>        results[name] <span class="op">=</span> {</span>
<span id="cb11-33"><a href="#cb11-33"></a>            <span class="st">'keypoints'</span>: <span class="bu">len</span>(keypoints),</span>
<span id="cb11-34"><a href="#cb11-34"></a>            <span class="st">'has_descriptors'</span>: descriptors <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>,</span>
<span id="cb11-35"><a href="#cb11-35"></a>            <span class="st">'speed'</span>: <span class="st">'Fast'</span> <span class="cf">if</span> name <span class="kw">in</span> [<span class="st">'FAST'</span>, <span class="st">'ORB'</span>] <span class="cf">else</span> <span class="st">'Slow'</span></span>
<span id="cb11-36"><a href="#cb11-36"></a>        }</span>
<span id="cb11-37"><a href="#cb11-37"></a>        </span>
<span id="cb11-38"><a href="#cb11-38"></a>        <span class="co"># Plot</span></span>
<span id="cb11-39"><a href="#cb11-39"></a>        plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb11-40"><a href="#cb11-40"></a>        plt.imshow(img_with_kp)</span>
<span id="cb11-41"><a href="#cb11-41"></a>        plt.title(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(keypoints)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb11-42"><a href="#cb11-42"></a>        plt.axis(<span class="st">'off'</span>)</span>
<span id="cb11-43"><a href="#cb11-43"></a>    </span>
<span id="cb11-44"><a href="#cb11-44"></a>    plt.tight_layout()</span>
<span id="cb11-45"><a href="#cb11-45"></a>    plt.show()</span>
<span id="cb11-46"><a href="#cb11-46"></a>    </span>
<span id="cb11-47"><a href="#cb11-47"></a>    <span class="co"># Print comparison table</span></span>
<span id="cb11-48"><a href="#cb11-48"></a>    <span class="bu">print</span>(<span class="st">"Feature Detector Comparison:"</span>)</span>
<span id="cb11-49"><a href="#cb11-49"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb11-50"><a href="#cb11-50"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Detector'</span><span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span><span class="st">'Keypoints'</span><span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span><span class="st">'Descriptors'</span><span class="sc">:&lt;12}</span><span class="ss"> | </span><span class="sc">{</span><span class="st">'Speed'</span><span class="sc">:&lt;8}</span><span class="ss">"</span>)</span>
<span id="cb11-51"><a href="#cb11-51"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb11-52"><a href="#cb11-52"></a>    <span class="cf">for</span> name, data <span class="kw">in</span> results.items():</span>
<span id="cb11-53"><a href="#cb11-53"></a>        desc_info <span class="op">=</span> <span class="st">"✓"</span> <span class="cf">if</span> data[<span class="st">'has_descriptors'</span>] <span class="cf">else</span> <span class="st">"✗"</span></span>
<span id="cb11-54"><a href="#cb11-54"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span>data[<span class="st">'keypoints'</span>]<span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span>desc_info<span class="sc">:&lt;12}</span><span class="ss"> | </span><span class="sc">{</span>data[<span class="st">'speed'</span>]<span class="sc">:&lt;8}</span><span class="ss">"</span>)</span>
<span id="cb11-55"><a href="#cb11-55"></a>    </span>
<span id="cb11-56"><a href="#cb11-56"></a>    <span class="cf">return</span> results</span>
<span id="cb11-57"><a href="#cb11-57"></a></span>
<span id="cb11-58"><a href="#cb11-58"></a><span class="co"># Compare detectors on architectural image</span></span>
<span id="cb11-59"><a href="#cb11-59"></a><span class="bu">print</span>(<span class="st">"Comparing feature detectors on architectural scene:"</span>)</span>
<span id="cb11-60"><a href="#cb11-60"></a>comparison_results <span class="op">=</span> compare_feature_detectors(img_rgb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Comparing feature detectors on architectural scene:
Feature Detector Comparison:
------------------------------------------------------------
Detector   | Keypoints  | Descriptors  | Speed   
------------------------------------------------------------
SIFT       | 908        | ✓            | Slow    
ORB        | 500        | ✓            | Fast    
FAST       | 587        | ✗            | Fast    
BRISK      | 2007       | ✓            | Slow    </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="06-feature-magic_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="your-challenge-build-a-panorama-stitcher" class="level2" data-number="0.9">
<h2 data-number="0.9" class="anchored" data-anchor-id="your-challenge-build-a-panorama-stitcher"><span class="header-section-number">0.9</span> Your Challenge: Build a Panorama Stitcher</h2>
<p>Now it’s your turn! Here’s a framework for a panorama stitching system:</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">class</span> PanoramaStitcher:</span>
<span id="cb13-2"><a href="#cb13-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb13-3"><a href="#cb13-3"></a>        <span class="va">self</span>.detector <span class="op">=</span> cv2.SIFT_create()</span>
<span id="cb13-4"><a href="#cb13-4"></a>        <span class="va">self</span>.matcher <span class="op">=</span> cv2.BFMatcher()</span>
<span id="cb13-5"><a href="#cb13-5"></a>    </span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="kw">def</span> find_homography(<span class="va">self</span>, img1, img2):</span>
<span id="cb13-7"><a href="#cb13-7"></a>        <span class="co">"""Find transformation between two images"""</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>        <span class="co"># Convert to grayscale</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>        gray1 <span class="op">=</span> cv2.cvtColor(img1, cv2.COLOR_RGB2GRAY) <span class="cf">if</span> <span class="bu">len</span>(img1.shape) <span class="op">==</span> <span class="dv">3</span> <span class="cf">else</span> img1</span>
<span id="cb13-10"><a href="#cb13-10"></a>        gray2 <span class="op">=</span> cv2.cvtColor(img2, cv2.COLOR_RGB2GRAY) <span class="cf">if</span> <span class="bu">len</span>(img2.shape) <span class="op">==</span> <span class="dv">3</span> <span class="cf">else</span> img2</span>
<span id="cb13-11"><a href="#cb13-11"></a>        </span>
<span id="cb13-12"><a href="#cb13-12"></a>        <span class="co"># Find keypoints and descriptors</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>        kp1, desc1 <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(gray1, <span class="va">None</span>)</span>
<span id="cb13-14"><a href="#cb13-14"></a>        kp2, desc2 <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(gray2, <span class="va">None</span>)</span>
<span id="cb13-15"><a href="#cb13-15"></a>        </span>
<span id="cb13-16"><a href="#cb13-16"></a>        <span class="cf">if</span> desc1 <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> desc2 <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb13-17"><a href="#cb13-17"></a>            <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>        </span>
<span id="cb13-19"><a href="#cb13-19"></a>        <span class="co"># Match features</span></span>
<span id="cb13-20"><a href="#cb13-20"></a>        matches <span class="op">=</span> <span class="va">self</span>.matcher.knnMatch(desc1, desc2, k<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb13-21"><a href="#cb13-21"></a>        </span>
<span id="cb13-22"><a href="#cb13-22"></a>        <span class="co"># Filter good matches using Lowe's ratio test</span></span>
<span id="cb13-23"><a href="#cb13-23"></a>        good_matches <span class="op">=</span> []</span>
<span id="cb13-24"><a href="#cb13-24"></a>        <span class="cf">for</span> match_pair <span class="kw">in</span> matches:</span>
<span id="cb13-25"><a href="#cb13-25"></a>            <span class="cf">if</span> <span class="bu">len</span>(match_pair) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb13-26"><a href="#cb13-26"></a>                m, n <span class="op">=</span> match_pair</span>
<span id="cb13-27"><a href="#cb13-27"></a>                <span class="cf">if</span> m.distance <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">*</span> n.distance:</span>
<span id="cb13-28"><a href="#cb13-28"></a>                    good_matches.append(m)</span>
<span id="cb13-29"><a href="#cb13-29"></a>        </span>
<span id="cb13-30"><a href="#cb13-30"></a>        <span class="cf">if</span> <span class="bu">len</span>(good_matches) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb13-31"><a href="#cb13-31"></a>            <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="bu">len</span>(good_matches)</span>
<span id="cb13-32"><a href="#cb13-32"></a>        </span>
<span id="cb13-33"><a href="#cb13-33"></a>        <span class="co"># Extract matched points</span></span>
<span id="cb13-34"><a href="#cb13-34"></a>        src_pts <span class="op">=</span> np.float32([kp1[m.queryIdx].pt <span class="cf">for</span> m <span class="kw">in</span> good_matches]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb13-35"><a href="#cb13-35"></a>        dst_pts <span class="op">=</span> np.float32([kp2[m.trainIdx].pt <span class="cf">for</span> m <span class="kw">in</span> good_matches]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb13-36"><a href="#cb13-36"></a>        </span>
<span id="cb13-37"><a href="#cb13-37"></a>        <span class="co"># Find homography using RANSAC</span></span>
<span id="cb13-38"><a href="#cb13-38"></a>        homography, mask <span class="op">=</span> cv2.findHomography(src_pts, dst_pts, cv2.RANSAC, <span class="fl">5.0</span>)</span>
<span id="cb13-39"><a href="#cb13-39"></a>        </span>
<span id="cb13-40"><a href="#cb13-40"></a>        <span class="cf">return</span> homography, mask, <span class="bu">len</span>(good_matches)</span>
<span id="cb13-41"><a href="#cb13-41"></a>    </span>
<span id="cb13-42"><a href="#cb13-42"></a>    <span class="kw">def</span> visualize_matches(<span class="va">self</span>, img1, img2):</span>
<span id="cb13-43"><a href="#cb13-43"></a>        <span class="co">"""Visualize feature matches between two images"""</span></span>
<span id="cb13-44"><a href="#cb13-44"></a>        <span class="co"># Find features</span></span>
<span id="cb13-45"><a href="#cb13-45"></a>        gray1 <span class="op">=</span> cv2.cvtColor(img1, cv2.COLOR_RGB2GRAY) <span class="cf">if</span> <span class="bu">len</span>(img1.shape) <span class="op">==</span> <span class="dv">3</span> <span class="cf">else</span> img1</span>
<span id="cb13-46"><a href="#cb13-46"></a>        gray2 <span class="op">=</span> cv2.cvtColor(img2, cv2.COLOR_RGB2GRAY) <span class="cf">if</span> <span class="bu">len</span>(img2.shape) <span class="op">==</span> <span class="dv">3</span> <span class="cf">else</span> img2</span>
<span id="cb13-47"><a href="#cb13-47"></a>        </span>
<span id="cb13-48"><a href="#cb13-48"></a>        kp1, desc1 <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(gray1, <span class="va">None</span>)</span>
<span id="cb13-49"><a href="#cb13-49"></a>        kp2, desc2 <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(gray2, <span class="va">None</span>)</span>
<span id="cb13-50"><a href="#cb13-50"></a>        </span>
<span id="cb13-51"><a href="#cb13-51"></a>        <span class="cf">if</span> desc1 <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> desc2 <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb13-52"><a href="#cb13-52"></a>            <span class="bu">print</span>(<span class="st">"Could not find features in one or both images"</span>)</span>
<span id="cb13-53"><a href="#cb13-53"></a>            <span class="cf">return</span></span>
<span id="cb13-54"><a href="#cb13-54"></a>        </span>
<span id="cb13-55"><a href="#cb13-55"></a>        <span class="co"># Match and filter</span></span>
<span id="cb13-56"><a href="#cb13-56"></a>        matches <span class="op">=</span> <span class="va">self</span>.matcher.knnMatch(desc1, desc2, k<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb13-57"><a href="#cb13-57"></a>        good_matches <span class="op">=</span> []</span>
<span id="cb13-58"><a href="#cb13-58"></a>        <span class="cf">for</span> match_pair <span class="kw">in</span> matches:</span>
<span id="cb13-59"><a href="#cb13-59"></a>            <span class="cf">if</span> <span class="bu">len</span>(match_pair) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb13-60"><a href="#cb13-60"></a>                m, n <span class="op">=</span> match_pair</span>
<span id="cb13-61"><a href="#cb13-61"></a>                <span class="cf">if</span> m.distance <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">*</span> n.distance:</span>
<span id="cb13-62"><a href="#cb13-62"></a>                    good_matches.append(m)</span>
<span id="cb13-63"><a href="#cb13-63"></a>        </span>
<span id="cb13-64"><a href="#cb13-64"></a>        <span class="co"># Draw matches</span></span>
<span id="cb13-65"><a href="#cb13-65"></a>        matched_img <span class="op">=</span> cv2.drawMatches(</span>
<span id="cb13-66"><a href="#cb13-66"></a>            img1, kp1, img2, kp2, good_matches[:<span class="dv">30</span>], <span class="va">None</span>,</span>
<span id="cb13-67"><a href="#cb13-67"></a>            flags<span class="op">=</span>cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS</span>
<span id="cb13-68"><a href="#cb13-68"></a>        )</span>
<span id="cb13-69"><a href="#cb13-69"></a>        </span>
<span id="cb13-70"><a href="#cb13-70"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb13-71"><a href="#cb13-71"></a>        plt.imshow(matched_img)</span>
<span id="cb13-72"><a href="#cb13-72"></a>        plt.title(<span class="ss">f"Feature Matches: </span><span class="sc">{</span><span class="bu">len</span>(good_matches)<span class="sc">}</span><span class="ss"> good matches found"</span>)</span>
<span id="cb13-73"><a href="#cb13-73"></a>        plt.axis(<span class="st">'off'</span>)</span>
<span id="cb13-74"><a href="#cb13-74"></a>        plt.show()</span>
<span id="cb13-75"><a href="#cb13-75"></a>        </span>
<span id="cb13-76"><a href="#cb13-76"></a>        <span class="cf">return</span> <span class="bu">len</span>(good_matches)</span>
<span id="cb13-77"><a href="#cb13-77"></a></span>
<span id="cb13-78"><a href="#cb13-78"></a><span class="co"># Test the panorama stitcher</span></span>
<span id="cb13-79"><a href="#cb13-79"></a>stitcher <span class="op">=</span> PanoramaStitcher()</span>
<span id="cb13-80"><a href="#cb13-80"></a></span>
<span id="cb13-81"><a href="#cb13-81"></a><span class="bu">print</span>(<span class="st">"Analyzing feature matches between architectural images:"</span>)</span>
<span id="cb13-82"><a href="#cb13-82"></a>num_matches <span class="op">=</span> stitcher.visualize_matches(img_rgb, img2_rgb)</span>
<span id="cb13-83"><a href="#cb13-83"></a></span>
<span id="cb13-84"><a href="#cb13-84"></a><span class="cf">if</span> num_matches <span class="kw">and</span> num_matches <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb13-85"><a href="#cb13-85"></a>    <span class="bu">print</span>(<span class="ss">f"✅ Great! Found </span><span class="sc">{</span>num_matches<span class="sc">}</span><span class="ss"> matches - perfect for panorama stitching!"</span>)</span>
<span id="cb13-86"><a href="#cb13-86"></a>    <span class="bu">print</span>(<span class="st">"💡 Challenge: Implement the actual image stitching using cv2.warpPerspective"</span>)</span>
<span id="cb13-87"><a href="#cb13-87"></a><span class="cf">else</span>:</span>
<span id="cb13-88"><a href="#cb13-88"></a>    <span class="bu">print</span>(<span class="st">"❌ Not enough matches for reliable stitching"</span>)</span>
<span id="cb13-89"><a href="#cb13-89"></a>    <span class="bu">print</span>(<span class="st">"💡 Try with images that have more overlap or distinctive features"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analyzing feature matches between architectural images:
❌ Not enough matches for reliable stitching
💡 Try with images that have more overlap or distinctive features</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="06-feature-magic_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="the-magic-behind-feature-matching" class="level2" data-number="0.10">
<h2 data-number="0.10" class="anchored" data-anchor-id="the-magic-behind-feature-matching"><span class="header-section-number">0.10</span> The Magic Behind Feature Matching</h2>
<p>Understanding what makes feature matching work:</p>
<section id="scale-invariance" class="level3" data-number="0.10.1">
<h3 data-number="0.10.1" class="anchored" data-anchor-id="scale-invariance"><span class="header-section-number">0.10.1</span> 1. <strong>Scale Invariance</strong></h3>
<p>Features can be detected at different sizes:</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Demonstrate scale invariance</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">def</span> show_scale_invariance():</span>
<span id="cb15-3"><a href="#cb15-3"></a>    <span class="co"># Create a simple pattern</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>    pattern <span class="op">=</span> np.zeros((<span class="dv">200</span>, <span class="dv">200</span>), dtype<span class="op">=</span>np.uint8)</span>
<span id="cb15-5"><a href="#cb15-5"></a>    cv2.rectangle(pattern, (<span class="dv">50</span>, <span class="dv">50</span>), (<span class="dv">150</span>, <span class="dv">150</span>), <span class="dv">255</span>, <span class="dv">2</span>)</span>
<span id="cb15-6"><a href="#cb15-6"></a>    cv2.circle(pattern, (<span class="dv">100</span>, <span class="dv">100</span>), <span class="dv">30</span>, <span class="dv">255</span>, <span class="dv">2</span>)</span>
<span id="cb15-7"><a href="#cb15-7"></a>    </span>
<span id="cb15-8"><a href="#cb15-8"></a>    <span class="co"># Scale it</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>    small_pattern <span class="op">=</span> cv2.resize(pattern, (<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb15-10"><a href="#cb15-10"></a>    large_pattern <span class="op">=</span> cv2.resize(pattern, (<span class="dv">400</span>, <span class="dv">400</span>))</span>
<span id="cb15-11"><a href="#cb15-11"></a>    </span>
<span id="cb15-12"><a href="#cb15-12"></a>    <span class="co"># Detect features in each</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>    sift <span class="op">=</span> cv2.SIFT_create()</span>
<span id="cb15-14"><a href="#cb15-14"></a>    </span>
<span id="cb15-15"><a href="#cb15-15"></a>    kp_orig, _ <span class="op">=</span> sift.detectAndCompute(pattern, <span class="va">None</span>)</span>
<span id="cb15-16"><a href="#cb15-16"></a>    kp_small, _ <span class="op">=</span> sift.detectAndCompute(small_pattern, <span class="va">None</span>)</span>
<span id="cb15-17"><a href="#cb15-17"></a>    kp_large, _ <span class="op">=</span> sift.detectAndCompute(large_pattern, <span class="va">None</span>)</span>
<span id="cb15-18"><a href="#cb15-18"></a>    </span>
<span id="cb15-19"><a href="#cb15-19"></a>    <span class="co"># Visualize</span></span>
<span id="cb15-20"><a href="#cb15-20"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb15-21"><a href="#cb15-21"></a>    </span>
<span id="cb15-22"><a href="#cb15-22"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb15-23"><a href="#cb15-23"></a>    img_small <span class="op">=</span> cv2.drawKeypoints(cv2.cvtColor(small_pattern, cv2.COLOR_GRAY2RGB), </span>
<span id="cb15-24"><a href="#cb15-24"></a>                                  kp_small, <span class="va">None</span>, flags<span class="op">=</span>cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS)</span>
<span id="cb15-25"><a href="#cb15-25"></a>    plt.imshow(img_small)</span>
<span id="cb15-26"><a href="#cb15-26"></a>    plt.title(<span class="ss">f"Small (100x100): </span><span class="sc">{</span><span class="bu">len</span>(kp_small)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb15-27"><a href="#cb15-27"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb15-28"><a href="#cb15-28"></a>    </span>
<span id="cb15-29"><a href="#cb15-29"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb15-30"><a href="#cb15-30"></a>    img_orig <span class="op">=</span> cv2.drawKeypoints(cv2.cvtColor(pattern, cv2.COLOR_GRAY2RGB), </span>
<span id="cb15-31"><a href="#cb15-31"></a>                                 kp_orig, <span class="va">None</span>, flags<span class="op">=</span>cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS)</span>
<span id="cb15-32"><a href="#cb15-32"></a>    plt.imshow(img_orig)</span>
<span id="cb15-33"><a href="#cb15-33"></a>    plt.title(<span class="ss">f"Original (200x200): </span><span class="sc">{</span><span class="bu">len</span>(kp_orig)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb15-34"><a href="#cb15-34"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb15-35"><a href="#cb15-35"></a>    </span>
<span id="cb15-36"><a href="#cb15-36"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb15-37"><a href="#cb15-37"></a>    img_large <span class="op">=</span> cv2.drawKeypoints(cv2.cvtColor(large_pattern, cv2.COLOR_GRAY2RGB), </span>
<span id="cb15-38"><a href="#cb15-38"></a>                                  kp_large, <span class="va">None</span>, flags<span class="op">=</span>cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS)</span>
<span id="cb15-39"><a href="#cb15-39"></a>    plt.imshow(img_large)</span>
<span id="cb15-40"><a href="#cb15-40"></a>    plt.title(<span class="ss">f"Large (400x400): </span><span class="sc">{</span><span class="bu">len</span>(kp_large)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb15-41"><a href="#cb15-41"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb15-42"><a href="#cb15-42"></a>    </span>
<span id="cb15-43"><a href="#cb15-43"></a>    plt.tight_layout()</span>
<span id="cb15-44"><a href="#cb15-44"></a>    plt.show()</span>
<span id="cb15-45"><a href="#cb15-45"></a>    </span>
<span id="cb15-46"><a href="#cb15-46"></a>    <span class="bu">print</span>(<span class="st">"✨ Scale Invariance: SIFT detects similar features at different scales!"</span>)</span>
<span id="cb15-47"><a href="#cb15-47"></a></span>
<span id="cb15-48"><a href="#cb15-48"></a>show_scale_invariance()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="06-feature-magic_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>✨ Scale Invariance: SIFT detects similar features at different scales!</code></pre>
</div>
</div>
</section>
<section id="rotation-invariance" class="level3" data-number="0.10.2">
<h3 data-number="0.10.2" class="anchored" data-anchor-id="rotation-invariance"><span class="header-section-number">0.10.2</span> 2. <strong>Rotation Invariance</strong></h3>
<p>Features remain detectable when rotated:</p>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Demonstrate rotation invariance</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">def</span> show_rotation_invariance():</span>
<span id="cb17-3"><a href="#cb17-3"></a>    <span class="co"># Use a small crop with clear features</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>    <span class="cf">if</span> <span class="st">'img_rgb'</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="cb17-5"><a href="#cb17-5"></a>        test_img <span class="op">=</span> img_rgb[<span class="dv">100</span>:<span class="dv">300</span>, <span class="dv">200</span>:<span class="dv">400</span>]</span>
<span id="cb17-6"><a href="#cb17-6"></a>    <span class="cf">else</span>:</span>
<span id="cb17-7"><a href="#cb17-7"></a>        <span class="co"># Create a test pattern if main image not available</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>        test_img <span class="op">=</span> np.zeros((<span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">3</span>), dtype<span class="op">=</span>np.uint8)</span>
<span id="cb17-9"><a href="#cb17-9"></a>        cv2.rectangle(test_img, (<span class="dv">50</span>, <span class="dv">50</span>), (<span class="dv">150</span>, <span class="dv">150</span>), (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>), <span class="dv">2</span>)</span>
<span id="cb17-10"><a href="#cb17-10"></a>        cv2.circle(test_img, (<span class="dv">100</span>, <span class="dv">100</span>), <span class="dv">30</span>, (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>), <span class="dv">2</span>)</span>
<span id="cb17-11"><a href="#cb17-11"></a>    </span>
<span id="cb17-12"><a href="#cb17-12"></a>    <span class="co"># Rotate the image</span></span>
<span id="cb17-13"><a href="#cb17-13"></a>    center <span class="op">=</span> (test_img.shape[<span class="dv">1</span>]<span class="op">//</span><span class="dv">2</span>, test_img.shape[<span class="dv">0</span>]<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb17-14"><a href="#cb17-14"></a>    rotation_matrix <span class="op">=</span> cv2.getRotationMatrix2D(center, <span class="dv">45</span>, <span class="fl">1.0</span>)</span>
<span id="cb17-15"><a href="#cb17-15"></a>    rotated_img <span class="op">=</span> cv2.warpAffine(test_img, rotation_matrix, (test_img.shape[<span class="dv">1</span>], test_img.shape[<span class="dv">0</span>]))</span>
<span id="cb17-16"><a href="#cb17-16"></a>    </span>
<span id="cb17-17"><a href="#cb17-17"></a>    <span class="co"># Detect features</span></span>
<span id="cb17-18"><a href="#cb17-18"></a>    sift <span class="op">=</span> cv2.SIFT_create()</span>
<span id="cb17-19"><a href="#cb17-19"></a>    </span>
<span id="cb17-20"><a href="#cb17-20"></a>    gray_orig <span class="op">=</span> cv2.cvtColor(test_img, cv2.COLOR_RGB2GRAY)</span>
<span id="cb17-21"><a href="#cb17-21"></a>    gray_rot <span class="op">=</span> cv2.cvtColor(rotated_img, cv2.COLOR_RGB2GRAY)</span>
<span id="cb17-22"><a href="#cb17-22"></a>    </span>
<span id="cb17-23"><a href="#cb17-23"></a>    kp_orig, desc_orig <span class="op">=</span> sift.detectAndCompute(gray_orig, <span class="va">None</span>)</span>
<span id="cb17-24"><a href="#cb17-24"></a>    kp_rot, desc_rot <span class="op">=</span> sift.detectAndCompute(gray_rot, <span class="va">None</span>)</span>
<span id="cb17-25"><a href="#cb17-25"></a>    </span>
<span id="cb17-26"><a href="#cb17-26"></a>    <span class="co"># Match features</span></span>
<span id="cb17-27"><a href="#cb17-27"></a>    <span class="cf">if</span> desc_orig <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> desc_rot <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb17-28"><a href="#cb17-28"></a>        bf <span class="op">=</span> cv2.BFMatcher()</span>
<span id="cb17-29"><a href="#cb17-29"></a>        matches <span class="op">=</span> bf.knnMatch(desc_orig, desc_rot, k<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb17-30"><a href="#cb17-30"></a>        good_matches <span class="op">=</span> []</span>
<span id="cb17-31"><a href="#cb17-31"></a>        <span class="cf">for</span> match_pair <span class="kw">in</span> matches:</span>
<span id="cb17-32"><a href="#cb17-32"></a>            <span class="cf">if</span> <span class="bu">len</span>(match_pair) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb17-33"><a href="#cb17-33"></a>                m, n <span class="op">=</span> match_pair</span>
<span id="cb17-34"><a href="#cb17-34"></a>                <span class="cf">if</span> m.distance <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">*</span> n.distance:</span>
<span id="cb17-35"><a href="#cb17-35"></a>                    good_matches.append(m)</span>
<span id="cb17-36"><a href="#cb17-36"></a>        </span>
<span id="cb17-37"><a href="#cb17-37"></a>        <span class="co"># Visualize</span></span>
<span id="cb17-38"><a href="#cb17-38"></a>        matched_img <span class="op">=</span> cv2.drawMatches(</span>
<span id="cb17-39"><a href="#cb17-39"></a>            test_img, kp_orig, rotated_img, kp_rot, good_matches, <span class="va">None</span>,</span>
<span id="cb17-40"><a href="#cb17-40"></a>            flags<span class="op">=</span>cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS</span>
<span id="cb17-41"><a href="#cb17-41"></a>        )</span>
<span id="cb17-42"><a href="#cb17-42"></a>        </span>
<span id="cb17-43"><a href="#cb17-43"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">8</span>))</span>
<span id="cb17-44"><a href="#cb17-44"></a>        plt.imshow(matched_img)</span>
<span id="cb17-45"><a href="#cb17-45"></a>        plt.title(<span class="ss">f"Rotation Invariance: </span><span class="sc">{</span><span class="bu">len</span>(good_matches)<span class="sc">}</span><span class="ss"> matches between original and 45° rotated image"</span>)</span>
<span id="cb17-46"><a href="#cb17-46"></a>        plt.axis(<span class="st">'off'</span>)</span>
<span id="cb17-47"><a href="#cb17-47"></a>        plt.show()</span>
<span id="cb17-48"><a href="#cb17-48"></a>        </span>
<span id="cb17-49"><a href="#cb17-49"></a>        <span class="bu">print</span>(<span class="ss">f"🔄 Rotation Invariance: Found </span><span class="sc">{</span><span class="bu">len</span>(good_matches)<span class="sc">}</span><span class="ss"> matching features despite 45° rotation!"</span>)</span>
<span id="cb17-50"><a href="#cb17-50"></a>    <span class="cf">else</span>:</span>
<span id="cb17-51"><a href="#cb17-51"></a>        <span class="bu">print</span>(<span class="st">"Could not detect enough features for matching"</span>)</span>
<span id="cb17-52"><a href="#cb17-52"></a></span>
<span id="cb17-53"><a href="#cb17-53"></a>show_rotation_invariance()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="06-feature-magic_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>🔄 Rotation Invariance: Found 19 matching features despite 45° rotation!</code></pre>
</div>
</div>
</section>
</section>
<section id="key-takeaways" class="level2" data-number="0.11">
<h2 data-number="0.11" class="anchored" data-anchor-id="key-takeaways"><span class="header-section-number">0.11</span> Key Takeaways</h2>
<ul>
<li><strong>Features are the “fingerprints”</strong> of images - unique, repeatable points</li>
<li><strong>SIFT is more accurate</strong> but slower; <strong>ORB is faster</strong> but less precise</li>
<li><strong>Feature matching</strong> enables object recognition, panorama stitching, and 3D reconstruction</li>
<li><strong>Lowe’s ratio test</strong> filters out ambiguous matches for better accuracy</li>
<li><strong>Scale and rotation invariance</strong> make features robust to transformations</li>
<li><strong>Real-world applications</strong> include Google Photos, autonomous vehicles, and AR/VR</li>
</ul>
</section>
<section id="whats-coming-next" class="level2" data-number="0.12">
<h2 data-number="0.12" class="anchored" data-anchor-id="whats-coming-next"><span class="header-section-number">0.12</span> What’s Coming Next?</h2>
<p>In our next post, <a href="../../../posts/series/cv-foundations/07-why-deep-learning.html"><strong>“Why Deep Learning? When Classical Methods Hit the Wall”</strong></a>, we’ll discover:</p>
<ul>
<li><strong>The limitations</strong> of classical computer vision methods</li>
<li><strong>Why neural networks</strong> revolutionized image understanding</li>
<li><strong>Your first deep learning model</strong> for image classification</li>
<li><strong>Transfer learning</strong> - standing on the shoulders of giants</li>
</ul>
<p>You’ve mastered the art of finding and matching features—next, we’ll explore how deep learning took computer vision to the next level!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hands-On Lab
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ready to extract and match features in your own images? Try the complete interactive notebook: <a href="https://colab.research.google.com/github/hasanpasha/quarto_blog_hasan/blob/main/notebooks/cv-foundations-05-feature-magic.ipynb"><strong>Feature Magic Lab</strong></a></p>
<p>Build panoramas, recognize objects, and explore the magic of feature detection!</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Series Navigation
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Previous</strong>: <a href="../../../posts/series/cv-foundations/05-image-segmentation.html">Image Segmentation: Dividing and Conquering</a></li>
<li><strong>Next</strong>: <a href="../../../posts/series/cv-foundations/07-why-deep-learning.html">Why Deep Learning? When Classical Methods Hit the Wall</a></li>
<li><strong>Series Home</strong>: <a href="../../../posts/series/computer-vision-foundations.html">Computer Vision Foundations</a></li>
</ul>
</div>
</div>
<hr>
<p><em>You’ve just learned one of the most powerful techniques in computer vision! Feature matching is used in everything from Google Photos to archaeological site reconstruction. Next, we’ll see why deep learning became necessary and how it builds on these foundations.</em></p>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div>CC BY-NC-SA 4.0</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{2025,
  author = {, Hasan},
  title = {Feature {Magic:} {What} {Makes} {Images} {Unique}},
  date = {2025-01-22},
  url = {https://hasangoni.quarto.pub/hasan-blog-post/posts/series/cv-foundations/06-feature-magic.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Hasan. 2025. <span>“Feature Magic: What Makes Images Unique.”</span>
January 22, 2025. <a href="https://hasangoni.quarto.pub/hasan-blog-post/posts/series/cv-foundations/06-feature-magic.html">https://hasangoni.quarto.pub/hasan-blog-post/posts/series/cv-foundations/06-feature-magic.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="yourusername/quarto_blog_hasan" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
<script src="https://giscus.app/client.js" data-repo="HasanGoni/quarto_blog_hasan" data-repo-id="" data-category="General" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb19" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><a href="#cb19-1"></a><span class="co">---</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="an">title:</span><span class="co"> "Feature Magic: What Makes Images Unique"</span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="an">author:</span><span class="co"> "Hasan"</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="an">date:</span><span class="co"> 2025-01-22</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="an">categories:</span><span class="co"> [computer-vision, features, keypoints, matching]</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="an">tags:</span><span class="co"> [sift, orb, keypoints, feature-matching, panorama]</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="an">image:</span><span class="co"> "images/feature-magic-header.jpg"</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="an">series:</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co">  name: "Computer Vision Foundations"</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="co">  number: 6</span></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="an">format:</span></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="co">  html: default</span></span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb19-15"><a href="#cb19-15"></a><span class="co">---</span></span>
<span id="cb19-16"><a href="#cb19-16"></a></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="al">![Feature detection visualization - geometric shapes with clear keypoints for detection](../../images/cv-foundations/feature-magic-header.jpg)</span></span>
<span id="cb19-18"><a href="#cb19-18"></a></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="fu">## The Puzzle Piece Problem</span></span>
<span id="cb19-20"><a href="#cb19-20"></a></span>
<span id="cb19-21"><a href="#cb19-21"></a>Imagine you're doing a 1000-piece jigsaw puzzle. How do you know which pieces fit together? You look for **unique features**—distinctive colors, patterns, corners, and edges that help you match pieces.</span>
<span id="cb19-22"><a href="#cb19-22"></a></span>
<span id="cb19-23"><a href="#cb19-23"></a>Computer vision faces the same challenge: How do we find the same object in different photos? The answer lies in **feature detection**—finding unique, recognizable points that remain consistent even when the image changes.</span>
<span id="cb19-24"><a href="#cb19-24"></a></span>
<span id="cb19-25"><a href="#cb19-25"></a>Today, we'll unlock this superpower and teach computers to recognize objects across different photos, lighting conditions, and viewing angles!</span>
<span id="cb19-26"><a href="#cb19-26"></a></span>
<span id="cb19-27"><a href="#cb19-27"></a>:::{.callout-tip}</span>
<span id="cb19-28"><a href="#cb19-28"></a>**Try it yourself!** Open this <span class="co">[</span><span class="ot">interactive Colab notebook</span><span class="co">](https://colab.research.google.com/github/hasanpasha/quarto_blog_hasan/blob/main/notebooks/cv-foundations-05-feature-magic.ipynb)</span> to experiment with feature detection and matching as we build this tutorial.</span>
<span id="cb19-29"><a href="#cb19-29"></a>:::</span>
<span id="cb19-30"><a href="#cb19-30"></a></span>
<span id="cb19-31"><a href="#cb19-31"></a><span class="fu">## What Are Features?</span></span>
<span id="cb19-32"><a href="#cb19-32"></a></span>
<span id="cb19-33"><a href="#cb19-33"></a>**Features** are distinctive points in an image that are:</span>
<span id="cb19-34"><a href="#cb19-34"></a><span class="ss">- </span>**Unique**: Stand out from their surroundings</span>
<span id="cb19-35"><a href="#cb19-35"></a><span class="ss">- </span>**Repeatable**: Can be found again in different images</span>
<span id="cb19-36"><a href="#cb19-36"></a><span class="ss">- </span>**Stable**: Don't change much with lighting or viewpoint</span>
<span id="cb19-37"><a href="#cb19-37"></a><span class="ss">- </span>**Informative**: Carry enough information for matching</span>
<span id="cb19-38"><a href="#cb19-38"></a></span>
<span id="cb19-39"><a href="#cb19-39"></a>Think of features as the "fingerprints" of an image!</span>
<span id="cb19-40"><a href="#cb19-40"></a></span>
<span id="cb19-41"><a href="#cb19-41"></a><span class="al">![Architectural features perfect for detection](images/architecture-features.jpg)</span></span>
<span id="cb19-42"><a href="#cb19-42"></a></span>
<span id="cb19-43"><a href="#cb19-43"></a>In this architectural image, features would be detected at:</span>
<span id="cb19-44"><a href="#cb19-44"></a><span class="ss">- </span>**Window corners** where frames meet</span>
<span id="cb19-45"><a href="#cb19-45"></a><span class="ss">- </span>**Building edges** and wall boundaries  </span>
<span id="cb19-46"><a href="#cb19-46"></a><span class="ss">- </span>**Grid patterns** of repeated windows</span>
<span id="cb19-47"><a href="#cb19-47"></a><span class="ss">- </span>**High-contrast regions** between frames and glass</span>
<span id="cb19-48"><a href="#cb19-48"></a></span>
<span id="cb19-49"><a href="#cb19-49"></a><span class="fu">## Your First Feature Detector: SIFT</span></span>
<span id="cb19-50"><a href="#cb19-50"></a></span>
<span id="cb19-51"><a href="#cb19-51"></a>**SIFT** (Scale-Invariant Feature Transform) is like having a super-detective that can find the same clues even if they're rotated, scaled, or slightly changed:</span>
<span id="cb19-52"><a href="#cb19-52"></a></span>
<span id="cb19-55"><a href="#cb19-55"></a><span class="in">```{python}</span></span>
<span id="cb19-56"><a href="#cb19-56"></a><span class="co">#| eval: true</span></span>
<span id="cb19-57"><a href="#cb19-57"></a><span class="im">import</span> cv2</span>
<span id="cb19-58"><a href="#cb19-58"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb19-59"><a href="#cb19-59"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb19-60"><a href="#cb19-60"></a><span class="im">import</span> requests</span>
<span id="cb19-61"><a href="#cb19-61"></a><span class="im">from</span> io <span class="im">import</span> BytesIO</span>
<span id="cb19-62"><a href="#cb19-62"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb19-63"><a href="#cb19-63"></a></span>
<span id="cb19-64"><a href="#cb19-64"></a><span class="co"># Load a sample image with clear features (architectural scene)</span></span>
<span id="cb19-65"><a href="#cb19-65"></a><span class="kw">def</span> load_image_from_url(url):</span>
<span id="cb19-66"><a href="#cb19-66"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb19-67"><a href="#cb19-67"></a>    img <span class="op">=</span> Image.<span class="bu">open</span>(BytesIO(response.content))</span>
<span id="cb19-68"><a href="#cb19-68"></a>    <span class="cf">return</span> cv2.cvtColor(np.array(img), cv2.COLOR_RGB2BGR)</span>
<span id="cb19-69"><a href="#cb19-69"></a></span>
<span id="cb19-70"><a href="#cb19-70"></a><span class="co"># Load our synthetic architectural image with clear features</span></span>
<span id="cb19-71"><a href="#cb19-71"></a>img <span class="op">=</span> cv2.imread(<span class="st">'images/architecture-features.jpg'</span>)</span>
<span id="cb19-72"><a href="#cb19-72"></a>img_rgb <span class="op">=</span> cv2.cvtColor(img, cv2.COLOR_BGR2RGB)</span>
<span id="cb19-73"><a href="#cb19-73"></a>gray <span class="op">=</span> cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span>
<span id="cb19-74"><a href="#cb19-74"></a></span>
<span id="cb19-75"><a href="#cb19-75"></a><span class="co"># Create SIFT detector</span></span>
<span id="cb19-76"><a href="#cb19-76"></a>sift <span class="op">=</span> cv2.SIFT_create()</span>
<span id="cb19-77"><a href="#cb19-77"></a></span>
<span id="cb19-78"><a href="#cb19-78"></a><span class="co"># Find keypoints and descriptors</span></span>
<span id="cb19-79"><a href="#cb19-79"></a>keypoints, descriptors <span class="op">=</span> sift.detectAndCompute(gray, <span class="va">None</span>)</span>
<span id="cb19-80"><a href="#cb19-80"></a></span>
<span id="cb19-81"><a href="#cb19-81"></a><span class="bu">print</span>(<span class="ss">f"SIFT found </span><span class="sc">{</span><span class="bu">len</span>(keypoints)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb19-82"><a href="#cb19-82"></a><span class="bu">print</span>(<span class="ss">f"Each keypoint has a </span><span class="sc">{</span>descriptors<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">-dimensional descriptor"</span>)</span>
<span id="cb19-83"><a href="#cb19-83"></a></span>
<span id="cb19-84"><a href="#cb19-84"></a><span class="co"># Draw keypoints</span></span>
<span id="cb19-85"><a href="#cb19-85"></a>img_with_keypoints <span class="op">=</span> cv2.drawKeypoints(</span>
<span id="cb19-86"><a href="#cb19-86"></a>    img_rgb, keypoints, <span class="va">None</span>, </span>
<span id="cb19-87"><a href="#cb19-87"></a>    flags<span class="op">=</span>cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS</span>
<span id="cb19-88"><a href="#cb19-88"></a>)</span>
<span id="cb19-89"><a href="#cb19-89"></a></span>
<span id="cb19-90"><a href="#cb19-90"></a><span class="co"># Display results</span></span>
<span id="cb19-91"><a href="#cb19-91"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">8</span>))</span>
<span id="cb19-92"><a href="#cb19-92"></a></span>
<span id="cb19-93"><a href="#cb19-93"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb19-94"><a href="#cb19-94"></a>plt.imshow(img_rgb)</span>
<span id="cb19-95"><a href="#cb19-95"></a>plt.title(<span class="st">"Original Image"</span>)</span>
<span id="cb19-96"><a href="#cb19-96"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-97"><a href="#cb19-97"></a></span>
<span id="cb19-98"><a href="#cb19-98"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb19-99"><a href="#cb19-99"></a>plt.imshow(img_with_keypoints)</span>
<span id="cb19-100"><a href="#cb19-100"></a>plt.title(<span class="ss">f"SIFT Keypoints: </span><span class="sc">{</span><span class="bu">len</span>(keypoints)<span class="sc">}</span><span class="ss"> detected"</span>)</span>
<span id="cb19-101"><a href="#cb19-101"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-102"><a href="#cb19-102"></a></span>
<span id="cb19-103"><a href="#cb19-103"></a>plt.tight_layout()</span>
<span id="cb19-104"><a href="#cb19-104"></a>plt.show()</span>
<span id="cb19-105"><a href="#cb19-105"></a></span>
<span id="cb19-106"><a href="#cb19-106"></a><span class="co"># Show some keypoint properties</span></span>
<span id="cb19-107"><a href="#cb19-107"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">First 5 keypoints properties:"</span>)</span>
<span id="cb19-108"><a href="#cb19-108"></a><span class="cf">for</span> i, kp <span class="kw">in</span> <span class="bu">enumerate</span>(keypoints[:<span class="dv">5</span>]):</span>
<span id="cb19-109"><a href="#cb19-109"></a>    <span class="bu">print</span>(<span class="ss">f"Keypoint </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: position=(</span><span class="sc">{</span>kp<span class="sc">.</span>pt[<span class="dv">0</span>]<span class="sc">:.1f}</span><span class="ss">, </span><span class="sc">{</span>kp<span class="sc">.</span>pt[<span class="dv">1</span>]<span class="sc">:.1f}</span><span class="ss">), "</span></span>
<span id="cb19-110"><a href="#cb19-110"></a>          <span class="ss">f"size=</span><span class="sc">{</span>kp<span class="sc">.</span>size<span class="sc">:.1f}</span><span class="ss">, angle=</span><span class="sc">{</span>kp<span class="sc">.</span>angle<span class="sc">:.1f}</span><span class="ss">°"</span>)</span>
<span id="cb19-111"><a href="#cb19-111"></a><span class="in">```</span></span>
<span id="cb19-112"><a href="#cb19-112"></a></span>
<span id="cb19-113"><a href="#cb19-113"></a>**🎯 Amazing!** Each green circle represents a detected feature. The size shows the scale, and the line shows the orientation.</span>
<span id="cb19-114"><a href="#cb19-114"></a></span>
<span id="cb19-115"><a href="#cb19-115"></a><span class="fu">## The Faster Alternative: ORB</span></span>
<span id="cb19-116"><a href="#cb19-116"></a></span>
<span id="cb19-117"><a href="#cb19-117"></a>**ORB** (Oriented FAST and Rotated BRIEF) is like SIFT's speedy cousin—faster and free to use in commercial applications:</span>
<span id="cb19-118"><a href="#cb19-118"></a></span>
<span id="cb19-121"><a href="#cb19-121"></a><span class="in">```{python}</span></span>
<span id="cb19-122"><a href="#cb19-122"></a><span class="co">#| eval: true</span></span>
<span id="cb19-123"><a href="#cb19-123"></a><span class="co"># Create ORB detector</span></span>
<span id="cb19-124"><a href="#cb19-124"></a>orb <span class="op">=</span> cv2.ORB_create()</span>
<span id="cb19-125"><a href="#cb19-125"></a></span>
<span id="cb19-126"><a href="#cb19-126"></a><span class="co"># Find keypoints and descriptors</span></span>
<span id="cb19-127"><a href="#cb19-127"></a>orb_kp, orb_desc <span class="op">=</span> orb.detectAndCompute(gray, <span class="va">None</span>)</span>
<span id="cb19-128"><a href="#cb19-128"></a></span>
<span id="cb19-129"><a href="#cb19-129"></a><span class="bu">print</span>(<span class="ss">f"ORB found </span><span class="sc">{</span><span class="bu">len</span>(orb_kp)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb19-130"><a href="#cb19-130"></a><span class="bu">print</span>(<span class="ss">f"Each keypoint has a </span><span class="sc">{</span>orb_desc<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="op">*</span><span class="dv">8</span><span class="sc">}</span><span class="ss">-bit binary descriptor"</span>)</span>
<span id="cb19-131"><a href="#cb19-131"></a></span>
<span id="cb19-132"><a href="#cb19-132"></a><span class="co"># Draw ORB keypoints</span></span>
<span id="cb19-133"><a href="#cb19-133"></a>img_orb <span class="op">=</span> cv2.drawKeypoints(img_rgb, orb_kp, <span class="va">None</span>, color<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>), flags<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb19-134"><a href="#cb19-134"></a></span>
<span id="cb19-135"><a href="#cb19-135"></a><span class="co"># Compare SIFT vs ORB</span></span>
<span id="cb19-136"><a href="#cb19-136"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb19-137"><a href="#cb19-137"></a></span>
<span id="cb19-138"><a href="#cb19-138"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb19-139"><a href="#cb19-139"></a>plt.imshow(img_with_keypoints)</span>
<span id="cb19-140"><a href="#cb19-140"></a>plt.title(<span class="ss">f"SIFT: </span><span class="sc">{</span><span class="bu">len</span>(keypoints)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb19-141"><a href="#cb19-141"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-142"><a href="#cb19-142"></a></span>
<span id="cb19-143"><a href="#cb19-143"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb19-144"><a href="#cb19-144"></a>plt.imshow(img_orb)</span>
<span id="cb19-145"><a href="#cb19-145"></a>plt.title(<span class="ss">f"ORB: </span><span class="sc">{</span><span class="bu">len</span>(orb_kp)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb19-146"><a href="#cb19-146"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-147"><a href="#cb19-147"></a></span>
<span id="cb19-148"><a href="#cb19-148"></a><span class="co"># Show descriptor differences</span></span>
<span id="cb19-149"><a href="#cb19-149"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb19-150"><a href="#cb19-150"></a>plt.plot(descriptors[<span class="dv">0</span>])</span>
<span id="cb19-151"><a href="#cb19-151"></a>plt.title(<span class="st">"SIFT Descriptor (128 values)"</span>)</span>
<span id="cb19-152"><a href="#cb19-152"></a>plt.xlabel(<span class="st">"Dimension"</span>)</span>
<span id="cb19-153"><a href="#cb19-153"></a>plt.ylabel(<span class="st">"Value"</span>)</span>
<span id="cb19-154"><a href="#cb19-154"></a></span>
<span id="cb19-155"><a href="#cb19-155"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb19-156"><a href="#cb19-156"></a>plt.plot(orb_desc[<span class="dv">0</span>])</span>
<span id="cb19-157"><a href="#cb19-157"></a>plt.title(<span class="st">"ORB Descriptor (32 bytes)"</span>)</span>
<span id="cb19-158"><a href="#cb19-158"></a>plt.xlabel(<span class="st">"Byte"</span>)</span>
<span id="cb19-159"><a href="#cb19-159"></a>plt.ylabel(<span class="st">"Value"</span>)</span>
<span id="cb19-160"><a href="#cb19-160"></a></span>
<span id="cb19-161"><a href="#cb19-161"></a>plt.tight_layout()</span>
<span id="cb19-162"><a href="#cb19-162"></a>plt.show()</span>
<span id="cb19-163"><a href="#cb19-163"></a><span class="in">```</span></span>
<span id="cb19-164"><a href="#cb19-164"></a></span>
<span id="cb19-165"><a href="#cb19-165"></a>**Key Differences:**</span>
<span id="cb19-166"><a href="#cb19-166"></a><span class="ss">- </span>**SIFT**: More accurate, 128-dimensional float descriptors</span>
<span id="cb19-167"><a href="#cb19-167"></a><span class="ss">- </span>**ORB**: Faster, 256-bit binary descriptors, patent-free</span>
<span id="cb19-168"><a href="#cb19-168"></a></span>
<span id="cb19-169"><a href="#cb19-169"></a><span class="fu">## Feature Matching: Finding Connections</span></span>
<span id="cb19-170"><a href="#cb19-170"></a></span>
<span id="cb19-171"><a href="#cb19-171"></a>Now comes the exciting part—matching features between images to find the same objects or scenes:</span>
<span id="cb19-172"><a href="#cb19-172"></a></span>
<span id="cb19-175"><a href="#cb19-175"></a><span class="in">```{python}</span></span>
<span id="cb19-176"><a href="#cb19-176"></a><span class="co">#| eval: true</span></span>
<span id="cb19-177"><a href="#cb19-177"></a><span class="co"># Load a second image (different architectural pattern for matching)</span></span>
<span id="cb19-178"><a href="#cb19-178"></a>img2 <span class="op">=</span> cv2.imread(<span class="st">'images/architecture-features-2.jpg'</span>)</span>
<span id="cb19-179"><a href="#cb19-179"></a>img2_rgb <span class="op">=</span> cv2.cvtColor(img2, cv2.COLOR_BGR2RGB)</span>
<span id="cb19-180"><a href="#cb19-180"></a>gray2 <span class="op">=</span> cv2.cvtColor(img2, cv2.COLOR_BGR2GRAY)</span>
<span id="cb19-181"><a href="#cb19-181"></a></span>
<span id="cb19-182"><a href="#cb19-182"></a><span class="co"># Detect features in both images</span></span>
<span id="cb19-183"><a href="#cb19-183"></a>kp1, desc1 <span class="op">=</span> sift.detectAndCompute(gray, <span class="va">None</span>)</span>
<span id="cb19-184"><a href="#cb19-184"></a>kp2, desc2 <span class="op">=</span> sift.detectAndCompute(gray2, <span class="va">None</span>)</span>
<span id="cb19-185"><a href="#cb19-185"></a></span>
<span id="cb19-186"><a href="#cb19-186"></a><span class="kw">def</span> match_features(desc1, desc2, ratio_threshold<span class="op">=</span><span class="fl">0.7</span>):</span>
<span id="cb19-187"><a href="#cb19-187"></a>    <span class="co">"""Match features using Lowe's ratio test"""</span></span>
<span id="cb19-188"><a href="#cb19-188"></a>    </span>
<span id="cb19-189"><a href="#cb19-189"></a>    <span class="co"># Brute Force matcher</span></span>
<span id="cb19-190"><a href="#cb19-190"></a>    bf <span class="op">=</span> cv2.BFMatcher()</span>
<span id="cb19-191"><a href="#cb19-191"></a>    matches <span class="op">=</span> bf.knnMatch(desc1, desc2, k<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-192"><a href="#cb19-192"></a>    </span>
<span id="cb19-193"><a href="#cb19-193"></a>    <span class="co"># Apply Lowe's ratio test to filter good matches</span></span>
<span id="cb19-194"><a href="#cb19-194"></a>    good_matches <span class="op">=</span> []</span>
<span id="cb19-195"><a href="#cb19-195"></a>    <span class="cf">for</span> match_pair <span class="kw">in</span> matches:</span>
<span id="cb19-196"><a href="#cb19-196"></a>        <span class="cf">if</span> <span class="bu">len</span>(match_pair) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb19-197"><a href="#cb19-197"></a>            m, n <span class="op">=</span> match_pair</span>
<span id="cb19-198"><a href="#cb19-198"></a>            <span class="cf">if</span> m.distance <span class="op">&lt;</span> ratio_threshold <span class="op">*</span> n.distance:</span>
<span id="cb19-199"><a href="#cb19-199"></a>                good_matches.append(m)</span>
<span id="cb19-200"><a href="#cb19-200"></a>    </span>
<span id="cb19-201"><a href="#cb19-201"></a>    <span class="cf">return</span> good_matches</span>
<span id="cb19-202"><a href="#cb19-202"></a></span>
<span id="cb19-203"><a href="#cb19-203"></a><span class="co"># Match SIFT features</span></span>
<span id="cb19-204"><a href="#cb19-204"></a>good_matches <span class="op">=</span> match_features(desc1, desc2)</span>
<span id="cb19-205"><a href="#cb19-205"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(good_matches)<span class="sc">}</span><span class="ss"> good matches out of </span><span class="sc">{</span><span class="bu">len</span>(kp1)<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span><span class="bu">len</span>(kp2)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb19-206"><a href="#cb19-206"></a></span>
<span id="cb19-207"><a href="#cb19-207"></a><span class="co"># Draw matches</span></span>
<span id="cb19-208"><a href="#cb19-208"></a>matched_img <span class="op">=</span> cv2.drawMatches(</span>
<span id="cb19-209"><a href="#cb19-209"></a>    img_rgb, kp1,</span>
<span id="cb19-210"><a href="#cb19-210"></a>    img2_rgb, kp2,</span>
<span id="cb19-211"><a href="#cb19-211"></a>    good_matches[:<span class="dv">50</span>], <span class="va">None</span>,  <span class="co"># Show top 50 matches</span></span>
<span id="cb19-212"><a href="#cb19-212"></a>    flags<span class="op">=</span>cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS</span>
<span id="cb19-213"><a href="#cb19-213"></a>)</span>
<span id="cb19-214"><a href="#cb19-214"></a></span>
<span id="cb19-215"><a href="#cb19-215"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb19-216"><a href="#cb19-216"></a>plt.imshow(matched_img)</span>
<span id="cb19-217"><a href="#cb19-217"></a>plt.title(<span class="ss">f"Feature Matching: </span><span class="sc">{</span><span class="bu">len</span>(good_matches)<span class="sc">}</span><span class="ss"> matches found"</span>)</span>
<span id="cb19-218"><a href="#cb19-218"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-219"><a href="#cb19-219"></a>plt.show()</span>
<span id="cb19-220"><a href="#cb19-220"></a></span>
<span id="cb19-221"><a href="#cb19-221"></a><span class="co"># Show match quality statistics</span></span>
<span id="cb19-222"><a href="#cb19-222"></a>distances <span class="op">=</span> [m.distance <span class="cf">for</span> m <span class="kw">in</span> good_matches]</span>
<span id="cb19-223"><a href="#cb19-223"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Match quality statistics:"</span>)</span>
<span id="cb19-224"><a href="#cb19-224"></a><span class="bu">print</span>(<span class="ss">f"Average distance: </span><span class="sc">{</span>np<span class="sc">.</span>mean(distances)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb19-225"><a href="#cb19-225"></a><span class="co">#print(f"Min distance: {np.min(distances):.2f}")</span></span>
<span id="cb19-226"><a href="#cb19-226"></a><span class="co">#print(f"Max distance: {np.max(distances):.2f}")</span></span>
<span id="cb19-227"><a href="#cb19-227"></a><span class="in">```</span></span>
<span id="cb19-228"><a href="#cb19-228"></a></span>
<span id="cb19-229"><a href="#cb19-229"></a>**🔥 Incredible!** Each line connects matching features between the two images. The shorter the line, the better the match!</span>
<span id="cb19-230"><a href="#cb19-230"></a></span>
<span id="cb19-231"><a href="#cb19-231"></a><span class="fu">## Understanding Feature Descriptors</span></span>
<span id="cb19-232"><a href="#cb19-232"></a></span>
<span id="cb19-233"><a href="#cb19-233"></a>Each keypoint comes with a **descriptor**—a numerical "fingerprint" that describes the local area around that point:</span>
<span id="cb19-234"><a href="#cb19-234"></a></span>
<span id="cb19-237"><a href="#cb19-237"></a><span class="in">```{python}</span></span>
<span id="cb19-238"><a href="#cb19-238"></a><span class="co">#| eval: true</span></span>
<span id="cb19-239"><a href="#cb19-239"></a><span class="kw">def</span> visualize_feature_patches(image, keypoints, num_features<span class="op">=</span><span class="dv">6</span>):</span>
<span id="cb19-240"><a href="#cb19-240"></a>    <span class="co">"""Visualize patches around keypoints"""</span></span>
<span id="cb19-241"><a href="#cb19-241"></a>    </span>
<span id="cb19-242"><a href="#cb19-242"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb19-243"><a href="#cb19-243"></a>    </span>
<span id="cb19-244"><a href="#cb19-244"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(num_features, <span class="bu">len</span>(keypoints))):</span>
<span id="cb19-245"><a href="#cb19-245"></a>        kp <span class="op">=</span> keypoints[i]</span>
<span id="cb19-246"><a href="#cb19-246"></a>        </span>
<span id="cb19-247"><a href="#cb19-247"></a>        <span class="co"># Extract patch around keypoint</span></span>
<span id="cb19-248"><a href="#cb19-248"></a>        x, y <span class="op">=</span> <span class="bu">int</span>(kp.pt[<span class="dv">0</span>]), <span class="bu">int</span>(kp.pt[<span class="dv">1</span>])</span>
<span id="cb19-249"><a href="#cb19-249"></a>        size <span class="op">=</span> <span class="bu">max</span>(<span class="bu">int</span>(kp.size), <span class="dv">20</span>)  <span class="co"># Minimum patch size</span></span>
<span id="cb19-250"><a href="#cb19-250"></a>        </span>
<span id="cb19-251"><a href="#cb19-251"></a>        <span class="co"># Make sure we don't go out of bounds</span></span>
<span id="cb19-252"><a href="#cb19-252"></a>        x1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, x <span class="op">-</span> size<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb19-253"><a href="#cb19-253"></a>        y1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, y <span class="op">-</span> size<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb19-254"><a href="#cb19-254"></a>        x2 <span class="op">=</span> <span class="bu">min</span>(image.shape[<span class="dv">1</span>], x <span class="op">+</span> size<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb19-255"><a href="#cb19-255"></a>        y2 <span class="op">=</span> <span class="bu">min</span>(image.shape[<span class="dv">0</span>], y <span class="op">+</span> size<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb19-256"><a href="#cb19-256"></a>        </span>
<span id="cb19-257"><a href="#cb19-257"></a>        <span class="cf">if</span> x2 <span class="op">&gt;</span> x1 <span class="kw">and</span> y2 <span class="op">&gt;</span> y1:  <span class="co"># Valid patch</span></span>
<span id="cb19-258"><a href="#cb19-258"></a>            patch <span class="op">=</span> image[y1:y2, x1:x2]</span>
<span id="cb19-259"><a href="#cb19-259"></a>            </span>
<span id="cb19-260"><a href="#cb19-260"></a>            <span class="co"># Plot patch</span></span>
<span id="cb19-261"><a href="#cb19-261"></a>            plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb19-262"><a href="#cb19-262"></a>            <span class="cf">if</span> <span class="bu">len</span>(patch.shape) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb19-263"><a href="#cb19-263"></a>                plt.imshow(patch)</span>
<span id="cb19-264"><a href="#cb19-264"></a>            <span class="cf">else</span>:</span>
<span id="cb19-265"><a href="#cb19-265"></a>                plt.imshow(patch, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb19-266"><a href="#cb19-266"></a>            plt.title(<span class="ss">f"Keypoint </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">Size: </span><span class="sc">{</span>kp<span class="sc">.</span>size<span class="sc">:.1f}</span><span class="ss">, Angle: </span><span class="sc">{</span>kp<span class="sc">.</span>angle<span class="sc">:.1f}</span><span class="ss">°"</span>)</span>
<span id="cb19-267"><a href="#cb19-267"></a>            plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-268"><a href="#cb19-268"></a>            </span>
<span id="cb19-269"><a href="#cb19-269"></a>            <span class="co"># Draw keypoint center</span></span>
<span id="cb19-270"><a href="#cb19-270"></a>            center_x <span class="op">=</span> (x <span class="op">-</span> x1)</span>
<span id="cb19-271"><a href="#cb19-271"></a>            center_y <span class="op">=</span> (y <span class="op">-</span> y1)</span>
<span id="cb19-272"><a href="#cb19-272"></a>            plt.plot(center_x, center_y, <span class="st">'r+'</span>, markersize<span class="op">=</span><span class="dv">10</span>, markeredgewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-273"><a href="#cb19-273"></a>    </span>
<span id="cb19-274"><a href="#cb19-274"></a>    plt.tight_layout()</span>
<span id="cb19-275"><a href="#cb19-275"></a>    plt.show()</span>
<span id="cb19-276"><a href="#cb19-276"></a></span>
<span id="cb19-277"><a href="#cb19-277"></a><span class="co"># Visualize some feature patches</span></span>
<span id="cb19-278"><a href="#cb19-278"></a><span class="bu">print</span>(<span class="st">"Here's what SIFT 'sees' around each keypoint:"</span>)</span>
<span id="cb19-279"><a href="#cb19-279"></a>visualize_feature_patches(img_rgb, keypoints)</span>
<span id="cb19-280"><a href="#cb19-280"></a><span class="in">```</span></span>
<span id="cb19-281"><a href="#cb19-281"></a></span>
<span id="cb19-282"><a href="#cb19-282"></a>**💡 Insight**: Each red cross marks the exact keypoint location. SIFT analyzes the gradient patterns in these patches to create unique descriptors.</span>
<span id="cb19-283"><a href="#cb19-283"></a></span>
<span id="cb19-284"><a href="#cb19-284"></a><span class="fu">## Real-World Application: Object Recognition</span></span>
<span id="cb19-285"><a href="#cb19-285"></a></span>
<span id="cb19-286"><a href="#cb19-286"></a>Let's build a simple object recognition system using feature matching:</span>
<span id="cb19-287"><a href="#cb19-287"></a></span>
<span id="cb19-290"><a href="#cb19-290"></a><span class="in">```{python}</span></span>
<span id="cb19-291"><a href="#cb19-291"></a><span class="co">#| eval: true</span></span>
<span id="cb19-292"><a href="#cb19-292"></a><span class="kw">class</span> SimpleObjectRecognizer:</span>
<span id="cb19-293"><a href="#cb19-293"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, detector_type<span class="op">=</span><span class="st">'ORB'</span>):</span>
<span id="cb19-294"><a href="#cb19-294"></a>        <span class="cf">if</span> detector_type <span class="op">==</span> <span class="st">'ORB'</span>:</span>
<span id="cb19-295"><a href="#cb19-295"></a>            <span class="va">self</span>.detector <span class="op">=</span> cv2.ORB_create()</span>
<span id="cb19-296"><a href="#cb19-296"></a>            <span class="va">self</span>.matcher <span class="op">=</span> cv2.BFMatcher(cv2.NORM_HAMMING, crossCheck<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-297"><a href="#cb19-297"></a>        <span class="cf">else</span>:  <span class="co"># SIFT</span></span>
<span id="cb19-298"><a href="#cb19-298"></a>            <span class="va">self</span>.detector <span class="op">=</span> cv2.SIFT_create()</span>
<span id="cb19-299"><a href="#cb19-299"></a>            <span class="va">self</span>.matcher <span class="op">=</span> cv2.BFMatcher()</span>
<span id="cb19-300"><a href="#cb19-300"></a>        </span>
<span id="cb19-301"><a href="#cb19-301"></a>        <span class="va">self</span>.detector_type <span class="op">=</span> detector_type</span>
<span id="cb19-302"><a href="#cb19-302"></a>        <span class="va">self</span>.reference_objects <span class="op">=</span> {}</span>
<span id="cb19-303"><a href="#cb19-303"></a>    </span>
<span id="cb19-304"><a href="#cb19-304"></a>    <span class="kw">def</span> add_reference_object(<span class="va">self</span>, name, image):</span>
<span id="cb19-305"><a href="#cb19-305"></a>        <span class="co">"""Add a reference object to recognize"""</span></span>
<span id="cb19-306"><a href="#cb19-306"></a>        <span class="cf">if</span> <span class="bu">len</span>(image.shape) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb19-307"><a href="#cb19-307"></a>            gray <span class="op">=</span> cv2.cvtColor(image, cv2.COLOR_RGB2GRAY)</span>
<span id="cb19-308"><a href="#cb19-308"></a>        <span class="cf">else</span>:</span>
<span id="cb19-309"><a href="#cb19-309"></a>            gray <span class="op">=</span> image</span>
<span id="cb19-310"><a href="#cb19-310"></a>            </span>
<span id="cb19-311"><a href="#cb19-311"></a>        keypoints, descriptors <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(gray, <span class="va">None</span>)</span>
<span id="cb19-312"><a href="#cb19-312"></a>        </span>
<span id="cb19-313"><a href="#cb19-313"></a>        <span class="cf">if</span> descriptors <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb19-314"><a href="#cb19-314"></a>            <span class="va">self</span>.reference_objects[name] <span class="op">=</span> {</span>
<span id="cb19-315"><a href="#cb19-315"></a>                <span class="st">'keypoints'</span>: keypoints,</span>
<span id="cb19-316"><a href="#cb19-316"></a>                <span class="st">'descriptors'</span>: descriptors,</span>
<span id="cb19-317"><a href="#cb19-317"></a>                <span class="st">'image'</span>: image</span>
<span id="cb19-318"><a href="#cb19-318"></a>            }</span>
<span id="cb19-319"><a href="#cb19-319"></a>            <span class="bu">print</span>(<span class="ss">f"Added '</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">' with </span><span class="sc">{</span><span class="bu">len</span>(keypoints)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb19-320"><a href="#cb19-320"></a>        <span class="cf">else</span>:</span>
<span id="cb19-321"><a href="#cb19-321"></a>            <span class="bu">print</span>(<span class="ss">f"No features found in '</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb19-322"><a href="#cb19-322"></a>    </span>
<span id="cb19-323"><a href="#cb19-323"></a>    <span class="kw">def</span> recognize_objects(<span class="va">self</span>, scene_image, min_matches<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb19-324"><a href="#cb19-324"></a>        <span class="co">"""Find reference objects in a scene"""</span></span>
<span id="cb19-325"><a href="#cb19-325"></a>        <span class="cf">if</span> <span class="bu">len</span>(scene_image.shape) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb19-326"><a href="#cb19-326"></a>            scene_gray <span class="op">=</span> cv2.cvtColor(scene_image, cv2.COLOR_RGB2GRAY)</span>
<span id="cb19-327"><a href="#cb19-327"></a>        <span class="cf">else</span>:</span>
<span id="cb19-328"><a href="#cb19-328"></a>            scene_gray <span class="op">=</span> scene_image</span>
<span id="cb19-329"><a href="#cb19-329"></a>            </span>
<span id="cb19-330"><a href="#cb19-330"></a>        scene_kp, scene_desc <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(scene_gray, <span class="va">None</span>)</span>
<span id="cb19-331"><a href="#cb19-331"></a>        </span>
<span id="cb19-332"><a href="#cb19-332"></a>        <span class="cf">if</span> scene_desc <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb19-333"><a href="#cb19-333"></a>            <span class="cf">return</span> []</span>
<span id="cb19-334"><a href="#cb19-334"></a>        </span>
<span id="cb19-335"><a href="#cb19-335"></a>        results <span class="op">=</span> []</span>
<span id="cb19-336"><a href="#cb19-336"></a>        </span>
<span id="cb19-337"><a href="#cb19-337"></a>        <span class="cf">for</span> obj_name, obj_data <span class="kw">in</span> <span class="va">self</span>.reference_objects.items():</span>
<span id="cb19-338"><a href="#cb19-338"></a>            <span class="co"># Match features</span></span>
<span id="cb19-339"><a href="#cb19-339"></a>            <span class="cf">if</span> <span class="va">self</span>.detector_type <span class="op">==</span> <span class="st">'ORB'</span>:</span>
<span id="cb19-340"><a href="#cb19-340"></a>                matches <span class="op">=</span> <span class="va">self</span>.matcher.match(obj_data[<span class="st">'descriptors'</span>], scene_desc)</span>
<span id="cb19-341"><a href="#cb19-341"></a>                matches <span class="op">=</span> <span class="bu">sorted</span>(matches, key<span class="op">=</span><span class="kw">lambda</span> x: x.distance)</span>
<span id="cb19-342"><a href="#cb19-342"></a>                good_matches <span class="op">=</span> matches[:<span class="bu">min</span>(<span class="dv">50</span>, <span class="bu">len</span>(matches))]</span>
<span id="cb19-343"><a href="#cb19-343"></a>            <span class="cf">else</span>:  <span class="co"># SIFT with ratio test</span></span>
<span id="cb19-344"><a href="#cb19-344"></a>                matches <span class="op">=</span> <span class="va">self</span>.matcher.knnMatch(obj_data[<span class="st">'descriptors'</span>], scene_desc, k<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-345"><a href="#cb19-345"></a>                good_matches <span class="op">=</span> []</span>
<span id="cb19-346"><a href="#cb19-346"></a>                <span class="cf">for</span> match_pair <span class="kw">in</span> matches:</span>
<span id="cb19-347"><a href="#cb19-347"></a>                    <span class="cf">if</span> <span class="bu">len</span>(match_pair) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb19-348"><a href="#cb19-348"></a>                        m, n <span class="op">=</span> match_pair</span>
<span id="cb19-349"><a href="#cb19-349"></a>                        <span class="cf">if</span> m.distance <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">*</span> n.distance:</span>
<span id="cb19-350"><a href="#cb19-350"></a>                            good_matches.append(m)</span>
<span id="cb19-351"><a href="#cb19-351"></a>            </span>
<span id="cb19-352"><a href="#cb19-352"></a>            <span class="cf">if</span> <span class="bu">len</span>(good_matches) <span class="op">&gt;=</span> min_matches:</span>
<span id="cb19-353"><a href="#cb19-353"></a>                confidence <span class="op">=</span> min_matches <span class="op">/</span> <span class="bu">len</span>(good_matches) <span class="cf">if</span> <span class="bu">len</span>(good_matches) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb19-354"><a href="#cb19-354"></a>                results.append({</span>
<span id="cb19-355"><a href="#cb19-355"></a>                    <span class="st">'name'</span>: obj_name,</span>
<span id="cb19-356"><a href="#cb19-356"></a>                    <span class="st">'matches'</span>: <span class="bu">len</span>(good_matches),</span>
<span id="cb19-357"><a href="#cb19-357"></a>                    <span class="st">'confidence'</span>: confidence,</span>
<span id="cb19-358"><a href="#cb19-358"></a>                    <span class="st">'good_matches'</span>: good_matches,</span>
<span id="cb19-359"><a href="#cb19-359"></a>                    <span class="st">'scene_keypoints'</span>: scene_kp,</span>
<span id="cb19-360"><a href="#cb19-360"></a>                    <span class="st">'obj_keypoints'</span>: obj_data[<span class="st">'keypoints'</span>]</span>
<span id="cb19-361"><a href="#cb19-361"></a>                })</span>
<span id="cb19-362"><a href="#cb19-362"></a>        </span>
<span id="cb19-363"><a href="#cb19-363"></a>        <span class="cf">return</span> <span class="bu">sorted</span>(results, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'matches'</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-364"><a href="#cb19-364"></a></span>
<span id="cb19-365"><a href="#cb19-365"></a><span class="co"># Example usage with architectural features</span></span>
<span id="cb19-366"><a href="#cb19-366"></a>recognizer <span class="op">=</span> SimpleObjectRecognizer(<span class="st">'SIFT'</span>)</span>
<span id="cb19-367"><a href="#cb19-367"></a></span>
<span id="cb19-368"><a href="#cb19-368"></a><span class="co"># Add reference objects (crop distinctive parts of images)</span></span>
<span id="cb19-369"><a href="#cb19-369"></a><span class="co"># For demo, we'll use the same image as reference</span></span>
<span id="cb19-370"><a href="#cb19-370"></a>reference_crop <span class="op">=</span> img_rgb[<span class="dv">100</span>:<span class="dv">400</span>, <span class="dv">200</span>:<span class="dv">500</span>]  <span class="co"># Crop a distinctive building section</span></span>
<span id="cb19-371"><a href="#cb19-371"></a>recognizer.add_reference_object(<span class="st">"Building Section"</span>, reference_crop)</span>
<span id="cb19-372"><a href="#cb19-372"></a></span>
<span id="cb19-373"><a href="#cb19-373"></a><span class="co"># Try to find it in a scene</span></span>
<span id="cb19-374"><a href="#cb19-374"></a>recognition_results <span class="op">=</span> recognizer.recognize_objects(img2_rgb, min_matches<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb19-375"><a href="#cb19-375"></a></span>
<span id="cb19-376"><a href="#cb19-376"></a><span class="cf">if</span> recognition_results:</span>
<span id="cb19-377"><a href="#cb19-377"></a>    result <span class="op">=</span> recognition_results[<span class="dv">0</span>]</span>
<span id="cb19-378"><a href="#cb19-378"></a>    </span>
<span id="cb19-379"><a href="#cb19-379"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">8</span>))</span>
<span id="cb19-380"><a href="#cb19-380"></a>    </span>
<span id="cb19-381"><a href="#cb19-381"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb19-382"><a href="#cb19-382"></a>    plt.imshow(reference_crop)</span>
<span id="cb19-383"><a href="#cb19-383"></a>    plt.title(<span class="st">"Reference Object"</span>)</span>
<span id="cb19-384"><a href="#cb19-384"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-385"><a href="#cb19-385"></a>    </span>
<span id="cb19-386"><a href="#cb19-386"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb19-387"><a href="#cb19-387"></a>    plt.imshow(img2_rgb)</span>
<span id="cb19-388"><a href="#cb19-388"></a>    plt.title(<span class="ss">f"Scene - Found </span><span class="sc">{</span>result[<span class="st">'matches'</span>]<span class="sc">}</span><span class="ss"> matches"</span>)</span>
<span id="cb19-389"><a href="#cb19-389"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-390"><a href="#cb19-390"></a>    </span>
<span id="cb19-391"><a href="#cb19-391"></a>    plt.tight_layout()</span>
<span id="cb19-392"><a href="#cb19-392"></a>    plt.show()</span>
<span id="cb19-393"><a href="#cb19-393"></a>    </span>
<span id="cb19-394"><a href="#cb19-394"></a>    <span class="bu">print</span>(<span class="ss">f"Recognition Results:"</span>)</span>
<span id="cb19-395"><a href="#cb19-395"></a>    <span class="cf">for</span> result <span class="kw">in</span> recognition_results:</span>
<span id="cb19-396"><a href="#cb19-396"></a>        <span class="bu">print</span>(<span class="ss">f"- Found '</span><span class="sc">{</span>result[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">' with </span><span class="sc">{</span>result[<span class="st">'matches'</span>]<span class="sc">}</span><span class="ss"> matches"</span>)</span>
<span id="cb19-397"><a href="#cb19-397"></a><span class="cf">else</span>:</span>
<span id="cb19-398"><a href="#cb19-398"></a>    <span class="bu">print</span>(<span class="st">"No objects recognized in the scene"</span>)</span>
<span id="cb19-399"><a href="#cb19-399"></a><span class="in">```</span></span>
<span id="cb19-400"><a href="#cb19-400"></a></span>
<span id="cb19-401"><a href="#cb19-401"></a><span class="fu">## Feature Detection Comparison</span></span>
<span id="cb19-402"><a href="#cb19-402"></a></span>
<span id="cb19-403"><a href="#cb19-403"></a>Let's compare different feature detectors to understand their strengths:</span>
<span id="cb19-404"><a href="#cb19-404"></a></span>
<span id="cb19-407"><a href="#cb19-407"></a><span class="in">```{python}</span></span>
<span id="cb19-408"><a href="#cb19-408"></a><span class="co">#| eval: true</span></span>
<span id="cb19-409"><a href="#cb19-409"></a><span class="kw">def</span> compare_feature_detectors(image):</span>
<span id="cb19-410"><a href="#cb19-410"></a>    <span class="co">"""Compare different feature detection algorithms"""</span></span>
<span id="cb19-411"><a href="#cb19-411"></a>    <span class="cf">if</span> <span class="bu">len</span>(image.shape) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb19-412"><a href="#cb19-412"></a>        gray <span class="op">=</span> cv2.cvtColor(image, cv2.COLOR_RGB2GRAY)</span>
<span id="cb19-413"><a href="#cb19-413"></a>    <span class="cf">else</span>:</span>
<span id="cb19-414"><a href="#cb19-414"></a>        gray <span class="op">=</span> image</span>
<span id="cb19-415"><a href="#cb19-415"></a>    </span>
<span id="cb19-416"><a href="#cb19-416"></a>    <span class="co"># Different detectors</span></span>
<span id="cb19-417"><a href="#cb19-417"></a>    detectors <span class="op">=</span> {</span>
<span id="cb19-418"><a href="#cb19-418"></a>        <span class="st">'SIFT'</span>: cv2.SIFT_create(),</span>
<span id="cb19-419"><a href="#cb19-419"></a>        <span class="st">'ORB'</span>: cv2.ORB_create(),</span>
<span id="cb19-420"><a href="#cb19-420"></a>        <span class="st">'FAST'</span>: cv2.FastFeatureDetector_create(),</span>
<span id="cb19-421"><a href="#cb19-421"></a>        <span class="st">'BRISK'</span>: cv2.BRISK_create()</span>
<span id="cb19-422"><a href="#cb19-422"></a>    }</span>
<span id="cb19-423"><a href="#cb19-423"></a>    </span>
<span id="cb19-424"><a href="#cb19-424"></a>    results <span class="op">=</span> {}</span>
<span id="cb19-425"><a href="#cb19-425"></a>    </span>
<span id="cb19-426"><a href="#cb19-426"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">15</span>))</span>
<span id="cb19-427"><a href="#cb19-427"></a>    </span>
<span id="cb19-428"><a href="#cb19-428"></a>    <span class="cf">for</span> i, (name, detector) <span class="kw">in</span> <span class="bu">enumerate</span>(detectors.items()):</span>
<span id="cb19-429"><a href="#cb19-429"></a>        <span class="co"># Detect keypoints</span></span>
<span id="cb19-430"><a href="#cb19-430"></a>        <span class="cf">if</span> name <span class="kw">in</span> [<span class="st">'SIFT'</span>, <span class="st">'ORB'</span>, <span class="st">'BRISK'</span>]:</span>
<span id="cb19-431"><a href="#cb19-431"></a>            keypoints, descriptors <span class="op">=</span> detector.detectAndCompute(gray, <span class="va">None</span>)</span>
<span id="cb19-432"><a href="#cb19-432"></a>        <span class="cf">else</span>:  <span class="co"># FAST doesn't compute descriptors</span></span>
<span id="cb19-433"><a href="#cb19-433"></a>            keypoints <span class="op">=</span> detector.detect(gray, <span class="va">None</span>)</span>
<span id="cb19-434"><a href="#cb19-434"></a>            descriptors <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-435"><a href="#cb19-435"></a>        </span>
<span id="cb19-436"><a href="#cb19-436"></a>        <span class="co"># Draw keypoints</span></span>
<span id="cb19-437"><a href="#cb19-437"></a>        img_with_kp <span class="op">=</span> cv2.drawKeypoints(image, keypoints, <span class="va">None</span>, color<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>))</span>
<span id="cb19-438"><a href="#cb19-438"></a>        </span>
<span id="cb19-439"><a href="#cb19-439"></a>        <span class="co"># Store results</span></span>
<span id="cb19-440"><a href="#cb19-440"></a>        results[name] <span class="op">=</span> {</span>
<span id="cb19-441"><a href="#cb19-441"></a>            <span class="st">'keypoints'</span>: <span class="bu">len</span>(keypoints),</span>
<span id="cb19-442"><a href="#cb19-442"></a>            <span class="st">'has_descriptors'</span>: descriptors <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>,</span>
<span id="cb19-443"><a href="#cb19-443"></a>            <span class="st">'speed'</span>: <span class="st">'Fast'</span> <span class="cf">if</span> name <span class="kw">in</span> [<span class="st">'FAST'</span>, <span class="st">'ORB'</span>] <span class="cf">else</span> <span class="st">'Slow'</span></span>
<span id="cb19-444"><a href="#cb19-444"></a>        }</span>
<span id="cb19-445"><a href="#cb19-445"></a>        </span>
<span id="cb19-446"><a href="#cb19-446"></a>        <span class="co"># Plot</span></span>
<span id="cb19-447"><a href="#cb19-447"></a>        plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb19-448"><a href="#cb19-448"></a>        plt.imshow(img_with_kp)</span>
<span id="cb19-449"><a href="#cb19-449"></a>        plt.title(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(keypoints)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb19-450"><a href="#cb19-450"></a>        plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-451"><a href="#cb19-451"></a>    </span>
<span id="cb19-452"><a href="#cb19-452"></a>    plt.tight_layout()</span>
<span id="cb19-453"><a href="#cb19-453"></a>    plt.show()</span>
<span id="cb19-454"><a href="#cb19-454"></a>    </span>
<span id="cb19-455"><a href="#cb19-455"></a>    <span class="co"># Print comparison table</span></span>
<span id="cb19-456"><a href="#cb19-456"></a>    <span class="bu">print</span>(<span class="st">"Feature Detector Comparison:"</span>)</span>
<span id="cb19-457"><a href="#cb19-457"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb19-458"><a href="#cb19-458"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Detector'</span><span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span><span class="st">'Keypoints'</span><span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span><span class="st">'Descriptors'</span><span class="sc">:&lt;12}</span><span class="ss"> | </span><span class="sc">{</span><span class="st">'Speed'</span><span class="sc">:&lt;8}</span><span class="ss">"</span>)</span>
<span id="cb19-459"><a href="#cb19-459"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb19-460"><a href="#cb19-460"></a>    <span class="cf">for</span> name, data <span class="kw">in</span> results.items():</span>
<span id="cb19-461"><a href="#cb19-461"></a>        desc_info <span class="op">=</span> <span class="st">"✓"</span> <span class="cf">if</span> data[<span class="st">'has_descriptors'</span>] <span class="cf">else</span> <span class="st">"✗"</span></span>
<span id="cb19-462"><a href="#cb19-462"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span>data[<span class="st">'keypoints'</span>]<span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span>desc_info<span class="sc">:&lt;12}</span><span class="ss"> | </span><span class="sc">{</span>data[<span class="st">'speed'</span>]<span class="sc">:&lt;8}</span><span class="ss">"</span>)</span>
<span id="cb19-463"><a href="#cb19-463"></a>    </span>
<span id="cb19-464"><a href="#cb19-464"></a>    <span class="cf">return</span> results</span>
<span id="cb19-465"><a href="#cb19-465"></a></span>
<span id="cb19-466"><a href="#cb19-466"></a><span class="co"># Compare detectors on architectural image</span></span>
<span id="cb19-467"><a href="#cb19-467"></a><span class="bu">print</span>(<span class="st">"Comparing feature detectors on architectural scene:"</span>)</span>
<span id="cb19-468"><a href="#cb19-468"></a>comparison_results <span class="op">=</span> compare_feature_detectors(img_rgb)</span>
<span id="cb19-469"><a href="#cb19-469"></a><span class="in">```</span></span>
<span id="cb19-470"><a href="#cb19-470"></a></span>
<span id="cb19-471"><a href="#cb19-471"></a><span class="fu">## Your Challenge: Build a Panorama Stitcher</span></span>
<span id="cb19-472"><a href="#cb19-472"></a></span>
<span id="cb19-473"><a href="#cb19-473"></a>Now it's your turn! Here's a framework for a panorama stitching system:</span>
<span id="cb19-474"><a href="#cb19-474"></a></span>
<span id="cb19-477"><a href="#cb19-477"></a><span class="in">```{python}</span></span>
<span id="cb19-478"><a href="#cb19-478"></a><span class="co">#| eval: true</span></span>
<span id="cb19-479"><a href="#cb19-479"></a><span class="kw">class</span> PanoramaStitcher:</span>
<span id="cb19-480"><a href="#cb19-480"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb19-481"><a href="#cb19-481"></a>        <span class="va">self</span>.detector <span class="op">=</span> cv2.SIFT_create()</span>
<span id="cb19-482"><a href="#cb19-482"></a>        <span class="va">self</span>.matcher <span class="op">=</span> cv2.BFMatcher()</span>
<span id="cb19-483"><a href="#cb19-483"></a>    </span>
<span id="cb19-484"><a href="#cb19-484"></a>    <span class="kw">def</span> find_homography(<span class="va">self</span>, img1, img2):</span>
<span id="cb19-485"><a href="#cb19-485"></a>        <span class="co">"""Find transformation between two images"""</span></span>
<span id="cb19-486"><a href="#cb19-486"></a>        <span class="co"># Convert to grayscale</span></span>
<span id="cb19-487"><a href="#cb19-487"></a>        gray1 <span class="op">=</span> cv2.cvtColor(img1, cv2.COLOR_RGB2GRAY) <span class="cf">if</span> <span class="bu">len</span>(img1.shape) <span class="op">==</span> <span class="dv">3</span> <span class="cf">else</span> img1</span>
<span id="cb19-488"><a href="#cb19-488"></a>        gray2 <span class="op">=</span> cv2.cvtColor(img2, cv2.COLOR_RGB2GRAY) <span class="cf">if</span> <span class="bu">len</span>(img2.shape) <span class="op">==</span> <span class="dv">3</span> <span class="cf">else</span> img2</span>
<span id="cb19-489"><a href="#cb19-489"></a>        </span>
<span id="cb19-490"><a href="#cb19-490"></a>        <span class="co"># Find keypoints and descriptors</span></span>
<span id="cb19-491"><a href="#cb19-491"></a>        kp1, desc1 <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(gray1, <span class="va">None</span>)</span>
<span id="cb19-492"><a href="#cb19-492"></a>        kp2, desc2 <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(gray2, <span class="va">None</span>)</span>
<span id="cb19-493"><a href="#cb19-493"></a>        </span>
<span id="cb19-494"><a href="#cb19-494"></a>        <span class="cf">if</span> desc1 <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> desc2 <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb19-495"><a href="#cb19-495"></a>            <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span></span>
<span id="cb19-496"><a href="#cb19-496"></a>        </span>
<span id="cb19-497"><a href="#cb19-497"></a>        <span class="co"># Match features</span></span>
<span id="cb19-498"><a href="#cb19-498"></a>        matches <span class="op">=</span> <span class="va">self</span>.matcher.knnMatch(desc1, desc2, k<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-499"><a href="#cb19-499"></a>        </span>
<span id="cb19-500"><a href="#cb19-500"></a>        <span class="co"># Filter good matches using Lowe's ratio test</span></span>
<span id="cb19-501"><a href="#cb19-501"></a>        good_matches <span class="op">=</span> []</span>
<span id="cb19-502"><a href="#cb19-502"></a>        <span class="cf">for</span> match_pair <span class="kw">in</span> matches:</span>
<span id="cb19-503"><a href="#cb19-503"></a>            <span class="cf">if</span> <span class="bu">len</span>(match_pair) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb19-504"><a href="#cb19-504"></a>                m, n <span class="op">=</span> match_pair</span>
<span id="cb19-505"><a href="#cb19-505"></a>                <span class="cf">if</span> m.distance <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">*</span> n.distance:</span>
<span id="cb19-506"><a href="#cb19-506"></a>                    good_matches.append(m)</span>
<span id="cb19-507"><a href="#cb19-507"></a>        </span>
<span id="cb19-508"><a href="#cb19-508"></a>        <span class="cf">if</span> <span class="bu">len</span>(good_matches) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb19-509"><a href="#cb19-509"></a>            <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="bu">len</span>(good_matches)</span>
<span id="cb19-510"><a href="#cb19-510"></a>        </span>
<span id="cb19-511"><a href="#cb19-511"></a>        <span class="co"># Extract matched points</span></span>
<span id="cb19-512"><a href="#cb19-512"></a>        src_pts <span class="op">=</span> np.float32([kp1[m.queryIdx].pt <span class="cf">for</span> m <span class="kw">in</span> good_matches]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb19-513"><a href="#cb19-513"></a>        dst_pts <span class="op">=</span> np.float32([kp2[m.trainIdx].pt <span class="cf">for</span> m <span class="kw">in</span> good_matches]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb19-514"><a href="#cb19-514"></a>        </span>
<span id="cb19-515"><a href="#cb19-515"></a>        <span class="co"># Find homography using RANSAC</span></span>
<span id="cb19-516"><a href="#cb19-516"></a>        homography, mask <span class="op">=</span> cv2.findHomography(src_pts, dst_pts, cv2.RANSAC, <span class="fl">5.0</span>)</span>
<span id="cb19-517"><a href="#cb19-517"></a>        </span>
<span id="cb19-518"><a href="#cb19-518"></a>        <span class="cf">return</span> homography, mask, <span class="bu">len</span>(good_matches)</span>
<span id="cb19-519"><a href="#cb19-519"></a>    </span>
<span id="cb19-520"><a href="#cb19-520"></a>    <span class="kw">def</span> visualize_matches(<span class="va">self</span>, img1, img2):</span>
<span id="cb19-521"><a href="#cb19-521"></a>        <span class="co">"""Visualize feature matches between two images"""</span></span>
<span id="cb19-522"><a href="#cb19-522"></a>        <span class="co"># Find features</span></span>
<span id="cb19-523"><a href="#cb19-523"></a>        gray1 <span class="op">=</span> cv2.cvtColor(img1, cv2.COLOR_RGB2GRAY) <span class="cf">if</span> <span class="bu">len</span>(img1.shape) <span class="op">==</span> <span class="dv">3</span> <span class="cf">else</span> img1</span>
<span id="cb19-524"><a href="#cb19-524"></a>        gray2 <span class="op">=</span> cv2.cvtColor(img2, cv2.COLOR_RGB2GRAY) <span class="cf">if</span> <span class="bu">len</span>(img2.shape) <span class="op">==</span> <span class="dv">3</span> <span class="cf">else</span> img2</span>
<span id="cb19-525"><a href="#cb19-525"></a>        </span>
<span id="cb19-526"><a href="#cb19-526"></a>        kp1, desc1 <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(gray1, <span class="va">None</span>)</span>
<span id="cb19-527"><a href="#cb19-527"></a>        kp2, desc2 <span class="op">=</span> <span class="va">self</span>.detector.detectAndCompute(gray2, <span class="va">None</span>)</span>
<span id="cb19-528"><a href="#cb19-528"></a>        </span>
<span id="cb19-529"><a href="#cb19-529"></a>        <span class="cf">if</span> desc1 <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> desc2 <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb19-530"><a href="#cb19-530"></a>            <span class="bu">print</span>(<span class="st">"Could not find features in one or both images"</span>)</span>
<span id="cb19-531"><a href="#cb19-531"></a>            <span class="cf">return</span></span>
<span id="cb19-532"><a href="#cb19-532"></a>        </span>
<span id="cb19-533"><a href="#cb19-533"></a>        <span class="co"># Match and filter</span></span>
<span id="cb19-534"><a href="#cb19-534"></a>        matches <span class="op">=</span> <span class="va">self</span>.matcher.knnMatch(desc1, desc2, k<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-535"><a href="#cb19-535"></a>        good_matches <span class="op">=</span> []</span>
<span id="cb19-536"><a href="#cb19-536"></a>        <span class="cf">for</span> match_pair <span class="kw">in</span> matches:</span>
<span id="cb19-537"><a href="#cb19-537"></a>            <span class="cf">if</span> <span class="bu">len</span>(match_pair) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb19-538"><a href="#cb19-538"></a>                m, n <span class="op">=</span> match_pair</span>
<span id="cb19-539"><a href="#cb19-539"></a>                <span class="cf">if</span> m.distance <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">*</span> n.distance:</span>
<span id="cb19-540"><a href="#cb19-540"></a>                    good_matches.append(m)</span>
<span id="cb19-541"><a href="#cb19-541"></a>        </span>
<span id="cb19-542"><a href="#cb19-542"></a>        <span class="co"># Draw matches</span></span>
<span id="cb19-543"><a href="#cb19-543"></a>        matched_img <span class="op">=</span> cv2.drawMatches(</span>
<span id="cb19-544"><a href="#cb19-544"></a>            img1, kp1, img2, kp2, good_matches[:<span class="dv">30</span>], <span class="va">None</span>,</span>
<span id="cb19-545"><a href="#cb19-545"></a>            flags<span class="op">=</span>cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS</span>
<span id="cb19-546"><a href="#cb19-546"></a>        )</span>
<span id="cb19-547"><a href="#cb19-547"></a>        </span>
<span id="cb19-548"><a href="#cb19-548"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb19-549"><a href="#cb19-549"></a>        plt.imshow(matched_img)</span>
<span id="cb19-550"><a href="#cb19-550"></a>        plt.title(<span class="ss">f"Feature Matches: </span><span class="sc">{</span><span class="bu">len</span>(good_matches)<span class="sc">}</span><span class="ss"> good matches found"</span>)</span>
<span id="cb19-551"><a href="#cb19-551"></a>        plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-552"><a href="#cb19-552"></a>        plt.show()</span>
<span id="cb19-553"><a href="#cb19-553"></a>        </span>
<span id="cb19-554"><a href="#cb19-554"></a>        <span class="cf">return</span> <span class="bu">len</span>(good_matches)</span>
<span id="cb19-555"><a href="#cb19-555"></a></span>
<span id="cb19-556"><a href="#cb19-556"></a><span class="co"># Test the panorama stitcher</span></span>
<span id="cb19-557"><a href="#cb19-557"></a>stitcher <span class="op">=</span> PanoramaStitcher()</span>
<span id="cb19-558"><a href="#cb19-558"></a></span>
<span id="cb19-559"><a href="#cb19-559"></a><span class="bu">print</span>(<span class="st">"Analyzing feature matches between architectural images:"</span>)</span>
<span id="cb19-560"><a href="#cb19-560"></a>num_matches <span class="op">=</span> stitcher.visualize_matches(img_rgb, img2_rgb)</span>
<span id="cb19-561"><a href="#cb19-561"></a></span>
<span id="cb19-562"><a href="#cb19-562"></a><span class="cf">if</span> num_matches <span class="kw">and</span> num_matches <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb19-563"><a href="#cb19-563"></a>    <span class="bu">print</span>(<span class="ss">f"✅ Great! Found </span><span class="sc">{</span>num_matches<span class="sc">}</span><span class="ss"> matches - perfect for panorama stitching!"</span>)</span>
<span id="cb19-564"><a href="#cb19-564"></a>    <span class="bu">print</span>(<span class="st">"💡 Challenge: Implement the actual image stitching using cv2.warpPerspective"</span>)</span>
<span id="cb19-565"><a href="#cb19-565"></a><span class="cf">else</span>:</span>
<span id="cb19-566"><a href="#cb19-566"></a>    <span class="bu">print</span>(<span class="st">"❌ Not enough matches for reliable stitching"</span>)</span>
<span id="cb19-567"><a href="#cb19-567"></a>    <span class="bu">print</span>(<span class="st">"💡 Try with images that have more overlap or distinctive features"</span>)</span>
<span id="cb19-568"><a href="#cb19-568"></a><span class="in">```</span></span>
<span id="cb19-569"><a href="#cb19-569"></a></span>
<span id="cb19-570"><a href="#cb19-570"></a><span class="fu">## The Magic Behind Feature Matching</span></span>
<span id="cb19-571"><a href="#cb19-571"></a></span>
<span id="cb19-572"><a href="#cb19-572"></a>Understanding what makes feature matching work:</span>
<span id="cb19-573"><a href="#cb19-573"></a></span>
<span id="cb19-574"><a href="#cb19-574"></a><span class="fu">### 1. **Scale Invariance**</span></span>
<span id="cb19-575"><a href="#cb19-575"></a>Features can be detected at different sizes:</span>
<span id="cb19-576"><a href="#cb19-576"></a></span>
<span id="cb19-579"><a href="#cb19-579"></a><span class="in">```{python}</span></span>
<span id="cb19-580"><a href="#cb19-580"></a><span class="co">#| eval: true</span></span>
<span id="cb19-581"><a href="#cb19-581"></a><span class="co"># Demonstrate scale invariance</span></span>
<span id="cb19-582"><a href="#cb19-582"></a><span class="kw">def</span> show_scale_invariance():</span>
<span id="cb19-583"><a href="#cb19-583"></a>    <span class="co"># Create a simple pattern</span></span>
<span id="cb19-584"><a href="#cb19-584"></a>    pattern <span class="op">=</span> np.zeros((<span class="dv">200</span>, <span class="dv">200</span>), dtype<span class="op">=</span>np.uint8)</span>
<span id="cb19-585"><a href="#cb19-585"></a>    cv2.rectangle(pattern, (<span class="dv">50</span>, <span class="dv">50</span>), (<span class="dv">150</span>, <span class="dv">150</span>), <span class="dv">255</span>, <span class="dv">2</span>)</span>
<span id="cb19-586"><a href="#cb19-586"></a>    cv2.circle(pattern, (<span class="dv">100</span>, <span class="dv">100</span>), <span class="dv">30</span>, <span class="dv">255</span>, <span class="dv">2</span>)</span>
<span id="cb19-587"><a href="#cb19-587"></a>    </span>
<span id="cb19-588"><a href="#cb19-588"></a>    <span class="co"># Scale it</span></span>
<span id="cb19-589"><a href="#cb19-589"></a>    small_pattern <span class="op">=</span> cv2.resize(pattern, (<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb19-590"><a href="#cb19-590"></a>    large_pattern <span class="op">=</span> cv2.resize(pattern, (<span class="dv">400</span>, <span class="dv">400</span>))</span>
<span id="cb19-591"><a href="#cb19-591"></a>    </span>
<span id="cb19-592"><a href="#cb19-592"></a>    <span class="co"># Detect features in each</span></span>
<span id="cb19-593"><a href="#cb19-593"></a>    sift <span class="op">=</span> cv2.SIFT_create()</span>
<span id="cb19-594"><a href="#cb19-594"></a>    </span>
<span id="cb19-595"><a href="#cb19-595"></a>    kp_orig, _ <span class="op">=</span> sift.detectAndCompute(pattern, <span class="va">None</span>)</span>
<span id="cb19-596"><a href="#cb19-596"></a>    kp_small, _ <span class="op">=</span> sift.detectAndCompute(small_pattern, <span class="va">None</span>)</span>
<span id="cb19-597"><a href="#cb19-597"></a>    kp_large, _ <span class="op">=</span> sift.detectAndCompute(large_pattern, <span class="va">None</span>)</span>
<span id="cb19-598"><a href="#cb19-598"></a>    </span>
<span id="cb19-599"><a href="#cb19-599"></a>    <span class="co"># Visualize</span></span>
<span id="cb19-600"><a href="#cb19-600"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb19-601"><a href="#cb19-601"></a>    </span>
<span id="cb19-602"><a href="#cb19-602"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb19-603"><a href="#cb19-603"></a>    img_small <span class="op">=</span> cv2.drawKeypoints(cv2.cvtColor(small_pattern, cv2.COLOR_GRAY2RGB), </span>
<span id="cb19-604"><a href="#cb19-604"></a>                                  kp_small, <span class="va">None</span>, flags<span class="op">=</span>cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS)</span>
<span id="cb19-605"><a href="#cb19-605"></a>    plt.imshow(img_small)</span>
<span id="cb19-606"><a href="#cb19-606"></a>    plt.title(<span class="ss">f"Small (100x100): </span><span class="sc">{</span><span class="bu">len</span>(kp_small)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb19-607"><a href="#cb19-607"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-608"><a href="#cb19-608"></a>    </span>
<span id="cb19-609"><a href="#cb19-609"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb19-610"><a href="#cb19-610"></a>    img_orig <span class="op">=</span> cv2.drawKeypoints(cv2.cvtColor(pattern, cv2.COLOR_GRAY2RGB), </span>
<span id="cb19-611"><a href="#cb19-611"></a>                                 kp_orig, <span class="va">None</span>, flags<span class="op">=</span>cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS)</span>
<span id="cb19-612"><a href="#cb19-612"></a>    plt.imshow(img_orig)</span>
<span id="cb19-613"><a href="#cb19-613"></a>    plt.title(<span class="ss">f"Original (200x200): </span><span class="sc">{</span><span class="bu">len</span>(kp_orig)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb19-614"><a href="#cb19-614"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-615"><a href="#cb19-615"></a>    </span>
<span id="cb19-616"><a href="#cb19-616"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb19-617"><a href="#cb19-617"></a>    img_large <span class="op">=</span> cv2.drawKeypoints(cv2.cvtColor(large_pattern, cv2.COLOR_GRAY2RGB), </span>
<span id="cb19-618"><a href="#cb19-618"></a>                                  kp_large, <span class="va">None</span>, flags<span class="op">=</span>cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS)</span>
<span id="cb19-619"><a href="#cb19-619"></a>    plt.imshow(img_large)</span>
<span id="cb19-620"><a href="#cb19-620"></a>    plt.title(<span class="ss">f"Large (400x400): </span><span class="sc">{</span><span class="bu">len</span>(kp_large)<span class="sc">}</span><span class="ss"> keypoints"</span>)</span>
<span id="cb19-621"><a href="#cb19-621"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-622"><a href="#cb19-622"></a>    </span>
<span id="cb19-623"><a href="#cb19-623"></a>    plt.tight_layout()</span>
<span id="cb19-624"><a href="#cb19-624"></a>    plt.show()</span>
<span id="cb19-625"><a href="#cb19-625"></a>    </span>
<span id="cb19-626"><a href="#cb19-626"></a>    <span class="bu">print</span>(<span class="st">"✨ Scale Invariance: SIFT detects similar features at different scales!"</span>)</span>
<span id="cb19-627"><a href="#cb19-627"></a></span>
<span id="cb19-628"><a href="#cb19-628"></a>show_scale_invariance()</span>
<span id="cb19-629"><a href="#cb19-629"></a><span class="in">```</span></span>
<span id="cb19-630"><a href="#cb19-630"></a></span>
<span id="cb19-631"><a href="#cb19-631"></a><span class="fu">### 2. **Rotation Invariance**</span></span>
<span id="cb19-632"><a href="#cb19-632"></a>Features remain detectable when rotated:</span>
<span id="cb19-633"><a href="#cb19-633"></a></span>
<span id="cb19-636"><a href="#cb19-636"></a><span class="in">```{python}</span></span>
<span id="cb19-637"><a href="#cb19-637"></a><span class="co">#| eval: true</span></span>
<span id="cb19-638"><a href="#cb19-638"></a><span class="co"># Demonstrate rotation invariance</span></span>
<span id="cb19-639"><a href="#cb19-639"></a><span class="kw">def</span> show_rotation_invariance():</span>
<span id="cb19-640"><a href="#cb19-640"></a>    <span class="co"># Use a small crop with clear features</span></span>
<span id="cb19-641"><a href="#cb19-641"></a>    <span class="cf">if</span> <span class="st">'img_rgb'</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="cb19-642"><a href="#cb19-642"></a>        test_img <span class="op">=</span> img_rgb[<span class="dv">100</span>:<span class="dv">300</span>, <span class="dv">200</span>:<span class="dv">400</span>]</span>
<span id="cb19-643"><a href="#cb19-643"></a>    <span class="cf">else</span>:</span>
<span id="cb19-644"><a href="#cb19-644"></a>        <span class="co"># Create a test pattern if main image not available</span></span>
<span id="cb19-645"><a href="#cb19-645"></a>        test_img <span class="op">=</span> np.zeros((<span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">3</span>), dtype<span class="op">=</span>np.uint8)</span>
<span id="cb19-646"><a href="#cb19-646"></a>        cv2.rectangle(test_img, (<span class="dv">50</span>, <span class="dv">50</span>), (<span class="dv">150</span>, <span class="dv">150</span>), (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>), <span class="dv">2</span>)</span>
<span id="cb19-647"><a href="#cb19-647"></a>        cv2.circle(test_img, (<span class="dv">100</span>, <span class="dv">100</span>), <span class="dv">30</span>, (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>), <span class="dv">2</span>)</span>
<span id="cb19-648"><a href="#cb19-648"></a>    </span>
<span id="cb19-649"><a href="#cb19-649"></a>    <span class="co"># Rotate the image</span></span>
<span id="cb19-650"><a href="#cb19-650"></a>    center <span class="op">=</span> (test_img.shape[<span class="dv">1</span>]<span class="op">//</span><span class="dv">2</span>, test_img.shape[<span class="dv">0</span>]<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb19-651"><a href="#cb19-651"></a>    rotation_matrix <span class="op">=</span> cv2.getRotationMatrix2D(center, <span class="dv">45</span>, <span class="fl">1.0</span>)</span>
<span id="cb19-652"><a href="#cb19-652"></a>    rotated_img <span class="op">=</span> cv2.warpAffine(test_img, rotation_matrix, (test_img.shape[<span class="dv">1</span>], test_img.shape[<span class="dv">0</span>]))</span>
<span id="cb19-653"><a href="#cb19-653"></a>    </span>
<span id="cb19-654"><a href="#cb19-654"></a>    <span class="co"># Detect features</span></span>
<span id="cb19-655"><a href="#cb19-655"></a>    sift <span class="op">=</span> cv2.SIFT_create()</span>
<span id="cb19-656"><a href="#cb19-656"></a>    </span>
<span id="cb19-657"><a href="#cb19-657"></a>    gray_orig <span class="op">=</span> cv2.cvtColor(test_img, cv2.COLOR_RGB2GRAY)</span>
<span id="cb19-658"><a href="#cb19-658"></a>    gray_rot <span class="op">=</span> cv2.cvtColor(rotated_img, cv2.COLOR_RGB2GRAY)</span>
<span id="cb19-659"><a href="#cb19-659"></a>    </span>
<span id="cb19-660"><a href="#cb19-660"></a>    kp_orig, desc_orig <span class="op">=</span> sift.detectAndCompute(gray_orig, <span class="va">None</span>)</span>
<span id="cb19-661"><a href="#cb19-661"></a>    kp_rot, desc_rot <span class="op">=</span> sift.detectAndCompute(gray_rot, <span class="va">None</span>)</span>
<span id="cb19-662"><a href="#cb19-662"></a>    </span>
<span id="cb19-663"><a href="#cb19-663"></a>    <span class="co"># Match features</span></span>
<span id="cb19-664"><a href="#cb19-664"></a>    <span class="cf">if</span> desc_orig <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> desc_rot <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb19-665"><a href="#cb19-665"></a>        bf <span class="op">=</span> cv2.BFMatcher()</span>
<span id="cb19-666"><a href="#cb19-666"></a>        matches <span class="op">=</span> bf.knnMatch(desc_orig, desc_rot, k<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-667"><a href="#cb19-667"></a>        good_matches <span class="op">=</span> []</span>
<span id="cb19-668"><a href="#cb19-668"></a>        <span class="cf">for</span> match_pair <span class="kw">in</span> matches:</span>
<span id="cb19-669"><a href="#cb19-669"></a>            <span class="cf">if</span> <span class="bu">len</span>(match_pair) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb19-670"><a href="#cb19-670"></a>                m, n <span class="op">=</span> match_pair</span>
<span id="cb19-671"><a href="#cb19-671"></a>                <span class="cf">if</span> m.distance <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">*</span> n.distance:</span>
<span id="cb19-672"><a href="#cb19-672"></a>                    good_matches.append(m)</span>
<span id="cb19-673"><a href="#cb19-673"></a>        </span>
<span id="cb19-674"><a href="#cb19-674"></a>        <span class="co"># Visualize</span></span>
<span id="cb19-675"><a href="#cb19-675"></a>        matched_img <span class="op">=</span> cv2.drawMatches(</span>
<span id="cb19-676"><a href="#cb19-676"></a>            test_img, kp_orig, rotated_img, kp_rot, good_matches, <span class="va">None</span>,</span>
<span id="cb19-677"><a href="#cb19-677"></a>            flags<span class="op">=</span>cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS</span>
<span id="cb19-678"><a href="#cb19-678"></a>        )</span>
<span id="cb19-679"><a href="#cb19-679"></a>        </span>
<span id="cb19-680"><a href="#cb19-680"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">8</span>))</span>
<span id="cb19-681"><a href="#cb19-681"></a>        plt.imshow(matched_img)</span>
<span id="cb19-682"><a href="#cb19-682"></a>        plt.title(<span class="ss">f"Rotation Invariance: </span><span class="sc">{</span><span class="bu">len</span>(good_matches)<span class="sc">}</span><span class="ss"> matches between original and 45° rotated image"</span>)</span>
<span id="cb19-683"><a href="#cb19-683"></a>        plt.axis(<span class="st">'off'</span>)</span>
<span id="cb19-684"><a href="#cb19-684"></a>        plt.show()</span>
<span id="cb19-685"><a href="#cb19-685"></a>        </span>
<span id="cb19-686"><a href="#cb19-686"></a>        <span class="bu">print</span>(<span class="ss">f"🔄 Rotation Invariance: Found </span><span class="sc">{</span><span class="bu">len</span>(good_matches)<span class="sc">}</span><span class="ss"> matching features despite 45° rotation!"</span>)</span>
<span id="cb19-687"><a href="#cb19-687"></a>    <span class="cf">else</span>:</span>
<span id="cb19-688"><a href="#cb19-688"></a>        <span class="bu">print</span>(<span class="st">"Could not detect enough features for matching"</span>)</span>
<span id="cb19-689"><a href="#cb19-689"></a></span>
<span id="cb19-690"><a href="#cb19-690"></a>show_rotation_invariance()</span>
<span id="cb19-691"><a href="#cb19-691"></a><span class="in">```</span></span>
<span id="cb19-692"><a href="#cb19-692"></a></span>
<span id="cb19-693"><a href="#cb19-693"></a><span class="fu">## Key Takeaways</span></span>
<span id="cb19-694"><a href="#cb19-694"></a></span>
<span id="cb19-695"><a href="#cb19-695"></a><span class="ss">- </span>**Features are the "fingerprints"** of images - unique, repeatable points</span>
<span id="cb19-696"><a href="#cb19-696"></a><span class="ss">- </span>**SIFT is more accurate** but slower; **ORB is faster** but less precise</span>
<span id="cb19-697"><a href="#cb19-697"></a><span class="ss">- </span>**Feature matching** enables object recognition, panorama stitching, and 3D reconstruction</span>
<span id="cb19-698"><a href="#cb19-698"></a><span class="ss">- </span>**Lowe's ratio test** filters out ambiguous matches for better accuracy</span>
<span id="cb19-699"><a href="#cb19-699"></a><span class="ss">- </span>**Scale and rotation invariance** make features robust to transformations</span>
<span id="cb19-700"><a href="#cb19-700"></a><span class="ss">- </span>**Real-world applications** include Google Photos, autonomous vehicles, and AR/VR</span>
<span id="cb19-701"><a href="#cb19-701"></a></span>
<span id="cb19-702"><a href="#cb19-702"></a><span class="fu">## What's Coming Next?</span></span>
<span id="cb19-703"><a href="#cb19-703"></a></span>
<span id="cb19-704"><a href="#cb19-704"></a>In our next post, <span class="co">[</span><span class="ot">**"Why Deep Learning? When Classical Methods Hit the Wall"**</span><span class="co">](07-why-deep-learning.qmd)</span>, we'll discover:</span>
<span id="cb19-705"><a href="#cb19-705"></a></span>
<span id="cb19-706"><a href="#cb19-706"></a><span class="ss">- </span>**The limitations** of classical computer vision methods</span>
<span id="cb19-707"><a href="#cb19-707"></a><span class="ss">- </span>**Why neural networks** revolutionized image understanding</span>
<span id="cb19-708"><a href="#cb19-708"></a><span class="ss">- </span>**Your first deep learning model** for image classification</span>
<span id="cb19-709"><a href="#cb19-709"></a><span class="ss">- </span>**Transfer learning** - standing on the shoulders of giants</span>
<span id="cb19-710"><a href="#cb19-710"></a></span>
<span id="cb19-711"><a href="#cb19-711"></a>You've mastered the art of finding and matching features—next, we'll explore how deep learning took computer vision to the next level!</span>
<span id="cb19-712"><a href="#cb19-712"></a></span>
<span id="cb19-713"><a href="#cb19-713"></a>:::{.callout-tip}</span>
<span id="cb19-714"><a href="#cb19-714"></a><span class="fu">## Hands-On Lab</span></span>
<span id="cb19-715"><a href="#cb19-715"></a>Ready to extract and match features in your own images? Try the complete interactive notebook: <span class="co">[</span><span class="ot">**Feature Magic Lab**</span><span class="co">](https://colab.research.google.com/github/hasanpasha/quarto_blog_hasan/blob/main/notebooks/cv-foundations-05-feature-magic.ipynb)</span></span>
<span id="cb19-716"><a href="#cb19-716"></a></span>
<span id="cb19-717"><a href="#cb19-717"></a>Build panoramas, recognize objects, and explore the magic of feature detection!</span>
<span id="cb19-718"><a href="#cb19-718"></a>:::</span>
<span id="cb19-719"><a href="#cb19-719"></a></span>
<span id="cb19-720"><a href="#cb19-720"></a>:::{.callout-note}</span>
<span id="cb19-721"><a href="#cb19-721"></a><span class="fu">## Series Navigation</span></span>
<span id="cb19-722"><a href="#cb19-722"></a><span class="ss">- </span>**Previous**: <span class="co">[</span><span class="ot">Image Segmentation: Dividing and Conquering</span><span class="co">](05-image-segmentation.qmd)</span></span>
<span id="cb19-723"><a href="#cb19-723"></a><span class="ss">- </span>**Next**: <span class="co">[</span><span class="ot">Why Deep Learning? When Classical Methods Hit the Wall</span><span class="co">](07-why-deep-learning.qmd)</span></span>
<span id="cb19-724"><a href="#cb19-724"></a><span class="ss">- </span>**Series Home**: <span class="co">[</span><span class="ot">Computer Vision Foundations</span><span class="co">](../computer-vision-foundations.qmd)</span></span>
<span id="cb19-725"><a href="#cb19-725"></a>:::</span>
<span id="cb19-726"><a href="#cb19-726"></a></span>
<span id="cb19-727"><a href="#cb19-727"></a>---</span>
<span id="cb19-728"><a href="#cb19-728"></a></span>
<span id="cb19-729"><a href="#cb19-729"></a>*You've just learned one of the most powerful techniques in computer vision! Feature matching is used in everything from Google Photos to archaeological site reconstruction. Next, we'll see why deep learning became necessary and how it builds on these foundations.* </span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>